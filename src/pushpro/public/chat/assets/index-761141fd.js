import{L as te,J as as,K as ns,r as _,b as ls,g as We,f as Te,n as st,w as fe,d as de,R as i,S as c,a2 as e,ai as is,a as Ge,e as re,M as cs,p as ds,m as ht,u as us,W as ke,V as Be,k as ce,a3 as se,H as pt,a4 as J,v as io,z as ut,a0 as gs,U as Me,a6 as z,ad as vs,F as ue,a8 as ge,i as co,Q as Qt,a5 as we,c as Z,af as ct,A as hs,a7 as xe,ab as Oe,ac as qe,aj as xt,aa as lt,G as uo,a9 as ps,ak as Ke,j as zt}from"./vue-f337fce5.js";import{u as fs}from"./useBasicLayout-ad7b6f42.js";import{g as De,p as Ee,d as It,m as bt,a as go,K as kt,A as Vt}from"./index-e8e306c5.js";import{f as vo,c as ms,S as ys,g as ks}from"./xhs-06219a15.js";import{b as gt,c as ho,h as Rt,d as _t}from"./vueuse-motion-2f7a1d90.js";import{T as ws,U as xs,d as bs}from"./naive-ui-5426aa23.js";import{_ as He}from"./_plugin-vue_export-helper-c27b6911.js";import"./index-ac008ee1.js";async function _s(o){try{return(await Ee({url:"/user/ai-topic-settings",data:o})).data}catch(a){throw console.error("保存AI选题配置失败:",a),a}}async function $s(){try{return(await De({url:"/user/ai-topic-settings"})).data}catch(o){throw console.error("获取AI选题配置失败:",o),o}}async function Ot(o,a=3){try{const t=await Ee({url:`/chatgpt/generate-topic?count=${a}`,data:o});return{topic:t.data.topic,topicList:t.data.topicList||[t.data.topic],success:t.data.success,message:t.data.message,data:t.data.data}}catch(t){return console.error("生成选题失败:",t),{topic:"",topicList:[],success:!1,message:t instanceof Error?t.message:"生成选题失败"}}}function po(o,a=1e4){let t;const s=new Promise((r,h)=>{t=window.setTimeout(()=>{h(new Error(`请求超时(${a}ms)`))},a)});return Promise.race([o,s]).finally(()=>{clearTimeout(t)})}function wt(o){const a={...o,batchCount:o.batchCount?Number(o.batchCount):1};return Ee({url:"/xhs/product-factory/generate",data:a}).then(t=>{var s,r;if(t&&t.data)return t.data.success===!1&&(t.data.error==="REGULAR_BALANCE_INSUFFICIENT"||(s=t.data.message)!=null&&s.includes("积分不足"))?{success:!1,message:t.data.message||"积分不足，继续体验服务，请按需选购套餐！",error:t.data.error||"REGULAR_BALANCE_INSUFFICIENT",data:t.data}:{success:!0,data:t.data,message:t.message||"提交成功"};if(t){const h=t;return h.success===!1&&(h.error==="REGULAR_BALANCE_INSUFFICIENT"||(r=h.message)!=null&&r.includes("积分不足"))?{success:!1,message:h.message||"积分不足，继续体验服务，请按需选购套餐！",error:h.error||"REGULAR_BALANCE_INSUFFICIENT"}:{success:h.success!==!1,message:h.message||(h.success!==!1?"提交成功":"提交失败"),data:null}}else return{success:!1,message:"服务器响应格式错误"}}).catch(t=>(console.error("生成产品内容请求失败:",t),{success:!1,message:"请求失败: "+(t.message||"未知错误"),error:t.code||t.error||"REQUEST_ERROR"}))}function fo(o){return De({url:"/xhs/product-factory/result",data:{taskId:o}}).then(a=>{var t,s;if(console.log("任务结果原始响应:",a),a){const r=a;if(r.data&&typeof r.data=="object")return r.data;if(r.status==="completed"||r.data&&typeof r.data=="object"&&(r.data.status==="completed"||r.data.success===!0&&r.data.status!=="running"))return console.log("检测到已完成的任务"),{success:!0,status:"completed",message:r.message||"任务已完成",data:r.data||null};if(r.status==="failed"||r.status==="Fail"||r.status==="FAILED"||(t=r.message)!=null&&t.includes("失败")||(s=r.message)!=null&&s.includes("错误")||r.data&&typeof r.data=="object"&&r.data.status==="failed"){console.log("检测到失败的任务");let h=r.message||"任务执行失败";return r.data&&typeof r.data=="object"&&(h=r.data.error||h),{success:!1,status:"failed",message:h,error:h}}return r.status==="running"||r.data&&typeof r.data=="object"&&r.data.status==="running"?(console.log("检测到运行中的任务"),{success:!0,status:"running",message:r.message||"任务运行中",data:r.data||null}):{success:r.success!==!1,message:r.message||"",status:r.status||"",data:r.data||null,error:r.message||""}}else return console.warn("获取任务结果: 响应为空"),{success:!1,message:"获取任务结果失败: 响应为空",status:"error"}}).catch(a=>(console.error("获取任务结果失败:",a),{success:!1,message:"请求失败: "+(a.message||"未知错误"),status:"error"}))}function Is(o){return console.log("getUserTasksAPI被调用，参数:",o||"全部"),po(De({url:"/xhs/product-factory/tasks",data:o?{status:o}:{}})).then(a=>{if(console.log("获取任务API原始响应:",a),!a)return console.warn("getUserTasksAPI: 服务器返回空响应"),[];const t=a;return t&&t.data?Array.isArray(t.data)?(console.log(`getUserTasksAPI: 成功获取${t.data.length}个任务`),t.data):(console.warn("getUserTasksAPI: data字段不是数组"),[]):t&&Array.isArray(t)?(console.log(`getUserTasksAPI: 成功获取${t.length}个任务`),t):t&&t.success!==!1?(console.warn("getUserTasksAPI: 响应格式不包含data字段",t),[]):(console.warn("getUserTasksAPI: 无效响应",t),[])}).catch(a=>(console.error("getUserTasksAPI: 请求异常:",a),[]))}function Cs(o){return console.log("batchGetTaskResultsAPI被调用，参数:",o.length,"个任务"),po(De({url:"/xhs/product-factory/batch-results",data:{taskIds:o.join(",")}}),15e3).then(a=>{if(console.log("批量获取任务状态API原始响应:",a),!a)return console.warn("batchGetTaskResultsAPI: 服务器返回空响应"),{success:!1,results:[]};const t=a;if(t&&t.code===200&&t.data){if(console.log("处理标准API响应格式 code/data/success/message"),t.data.results&&Array.isArray(t.data.results)){console.log(`找到标准嵌套results数组，长度: ${t.data.results.length}`);const r=t.data.results.map(h=>!h.status&&h.success===!0?{...h,status:"completed"}:h);return{success:!0,message:t.data.message||t.message||"成功获取任务状态",results:r}}return Array.isArray(t.data)?(console.log(`找到data数组格式，长度: ${t.data.length}`),{success:!0,results:t.data}):t.data&&t.data.id?(console.log("找到单个任务响应对象"),{success:!0,results:[t.data]}):t.data}if(t.results&&Array.isArray(t.results))return console.log(`找到results字段，长度: ${t.results.length}`),t;if(Array.isArray(t))return console.log(`响应直接是数组，长度: ${t.length}`),{success:!0,results:t};console.warn("无法识别的响应格式，尝试返回合理的数据结构");const s={success:(t==null?void 0:t.success)!==!1,message:(t==null?void 0:t.message)||"获取任务状态",results:[]};return t!=null&&t.data&&(Array.isArray(t.data)?s.results=t.data:typeof t.data=="object"&&t.data!==null&&t.data.id&&(s.results=[t.data])),s}).catch(a=>(console.error("batchGetTaskResultsAPI: 请求异常:",a),{success:!1,results:[],error:a.message}))}function Ss(o){const a=new FormData;return a.append("file",o),Ee({url:"/coze/file/upload",data:a,headers:{"Content-Type":"multipart/form-data"}}).then(t=>t.data)}function Ts(o){return Ee({url:"/xhs/product-factory/retry",data:{taskId:o}}).then(a=>{var t,s;if(console.log("重试任务API响应:",a),a&&a.data)return a.data.success===!1&&(a.data.error==="REGULAR_BALANCE_INSUFFICIENT"||(t=a.data.message)!=null&&t.includes("积分不足"))?{success:!1,message:a.data.message||"积分不足，继续体验服务，请按需选购套餐！",error:a.data.error||"REGULAR_BALANCE_INSUFFICIENT",data:a.data}:{success:!0,data:a.data,message:a.message||"重试任务提交成功"};if(a){const r=a;return r.success===!1&&(r.error==="REGULAR_BALANCE_INSUFFICIENT"||(s=r.message)!=null&&s.includes("积分不足"))?{success:!1,message:r.message||"积分不足，继续体验服务，请按需选购套餐！",error:r.error||"REGULAR_BALANCE_INSUFFICIENT"}:{success:r.success!==!1,message:r.message||(r.success!==!1?"重试任务提交成功":"重试任务提交失败"),data:null}}else return{success:!1,message:"服务器响应格式错误"}}).catch(a=>(console.error("重试任务请求失败:",a),{success:!1,message:"重试任务请求失败: "+(a.message||"未知错误"),error:a.code||a.error||"REQUEST_ERROR"}))}function Ms(o,a=1){return De({url:"/user-function/check-access",data:{functionId:o,amount:a}})}function As(o,a=1){return De({url:"/user-function/check-point",data:{functionId:o,amount:a}})}var qt;const Ze=typeof window<"u",Ls=o=>typeof o=="string",js=()=>{};Ze&&((qt=window==null?void 0:window.navigator)!=null&&qt.userAgent)&&/iP(ad|hone|od)/.test(window.navigator.userAgent);function Ct(o){return typeof o=="function"?o():te(o)}function Ns(o){return o}function St(o){return as()?(ns(o),!0):!1}function Es(o,a=!0){We()?Te(o):a?o():st(o)}function Us(o,a,t={}){const{immediate:s=!0}=t,r=_(!1);let h=null;function x(){h&&(clearTimeout(h),h=null)}function p(){r.value=!1,x()}function $(...R){x(),r.value=!0,h=setTimeout(()=>{r.value=!1,h=null,o(...R)},Ct(a))}return s&&(r.value=!0,Ze&&$()),St(p),{isPending:ls(r),start:$,stop:p}}function mo(o){var a;const t=Ct(o);return(a=t==null?void 0:t.$el)!=null?a:t}const yo=Ze?window:void 0;function Bs(...o){let a,t,s,r;if(Ls(o[0])||Array.isArray(o[0])?([t,s,r]=o,a=yo):[a,t,s,r]=o,!a)return js;Array.isArray(t)||(t=[t]),Array.isArray(s)||(s=[s]);const h=[],x=()=>{h.forEach(I=>I()),h.length=0},p=(I,P,m,N)=>(I.addEventListener(P,m,N),()=>I.removeEventListener(P,m,N)),$=fe(()=>[mo(a),Ct(r)],([I,P])=>{x(),I&&h.push(...t.flatMap(m=>s.map(N=>p(I,m,N,P))))},{immediate:!0,flush:"post"}),R=()=>{$(),x()};return St(R),R}function Ds(o,a=!1){const t=_(),s=()=>t.value=!!o();return s(),Es(s,a),t}const Ht=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Gt="__vueuse_ssr_handlers__";Ht[Gt]=Ht[Gt]||{};var Wt=Object.getOwnPropertySymbols,Fs=Object.prototype.hasOwnProperty,Ps=Object.prototype.propertyIsEnumerable,Qs=(o,a)=>{var t={};for(var s in o)Fs.call(o,s)&&a.indexOf(s)<0&&(t[s]=o[s]);if(o!=null&&Wt)for(var s of Wt(o))a.indexOf(s)<0&&Ps.call(o,s)&&(t[s]=o[s]);return t};function zs(o,a,t={}){const s=t,{window:r=yo}=s,h=Qs(s,["window"]);let x;const p=Ds(()=>r&&"ResizeObserver"in r),$=()=>{x&&(x.disconnect(),x=void 0)},R=fe(()=>mo(o),P=>{$(),p.value&&r&&P&&(x=new ResizeObserver(a),x.observe(P,h))},{immediate:!0,flush:"post"}),I=()=>{$(),R()};return St(I),{isSupported:p,stop:I}}var Jt;(function(o){o.UP="UP",o.RIGHT="RIGHT",o.DOWN="DOWN",o.LEFT="LEFT",o.NONE="NONE"})(Jt||(Jt={}));var Vs=Object.defineProperty,Kt=Object.getOwnPropertySymbols,Rs=Object.prototype.hasOwnProperty,Os=Object.prototype.propertyIsEnumerable,Zt=(o,a,t)=>a in o?Vs(o,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[a]=t,qs=(o,a)=>{for(var t in a||(a={}))Rs.call(a,t)&&Zt(o,t,a[t]);if(Kt)for(var t of Kt(a))Os.call(a,t)&&Zt(o,t,a[t]);return o};const Hs={easeInSine:[.12,0,.39,0],easeOutSine:[.61,1,.88,1],easeInOutSine:[.37,0,.63,1],easeInQuad:[.11,0,.5,0],easeOutQuad:[.5,1,.89,1],easeInOutQuad:[.45,0,.55,1],easeInCubic:[.32,0,.67,0],easeOutCubic:[.33,1,.68,1],easeInOutCubic:[.65,0,.35,1],easeInQuart:[.5,0,.75,0],easeOutQuart:[.25,1,.5,1],easeInOutQuart:[.76,0,.24,1],easeInQuint:[.64,0,.78,0],easeOutQuint:[.22,1,.36,1],easeInOutQuint:[.83,0,.17,1],easeInExpo:[.7,0,.84,0],easeOutExpo:[.16,1,.3,1],easeInOutExpo:[.87,0,.13,1],easeInCirc:[.55,0,1,.45],easeOutCirc:[0,.55,.45,1],easeInOutCirc:[.85,0,.15,1],easeInBack:[.36,0,.66,-.56],easeOutBack:[.34,1.56,.64,1],easeInOutBack:[.68,-.6,.32,1.6]};qs({linear:Ns},Hs);const Gs=o=>o===void 0,ot=o=>typeof o=="number",Ws=o=>typeof Element>"u"?!1:o instanceof Element,Js=o=>gt(o)?!Number.isNaN(Number(o)):!1,Xt=o=>Object.keys(o);function $t(o,a="px"){if(!o)return"";if(ot(o)||Js(o))return`${o}${a}`;if(gt(o))return o}/*! Element Plus Icons Vue v2.3.1 */var Ks=de({name:"CircleCloseFilled",__name:"circle-close-filled",setup(o){return(a,t)=>(i(),c("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[e("path",{fill:"currentColor",d:"M512 64a448 448 0 1 1 0 896 448 448 0 0 1 0-896m0 393.664L407.936 353.6a38.4 38.4 0 1 0-54.336 54.336L457.664 512 353.6 616.064a38.4 38.4 0 1 0 54.336 54.336L512 566.336 616.064 670.4a38.4 38.4 0 1 0 54.336-54.336L566.336 512 670.4 407.936a38.4 38.4 0 1 0-54.336-54.336z"})]))}}),ko=Ks,Zs=de({name:"Close",__name:"close",setup(o){return(a,t)=>(i(),c("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[e("path",{fill:"currentColor",d:"M764.288 214.592 512 466.88 259.712 214.592a31.936 31.936 0 0 0-45.12 45.12L466.752 512 214.528 764.224a31.936 31.936 0 1 0 45.12 45.184L512 557.184l252.288 252.288a31.936 31.936 0 0 0 45.12-45.12L557.12 512.064l252.288-252.352a31.936 31.936 0 1 0-45.12-45.184z"})]))}}),Xs=Zs,Ys=de({name:"InfoFilled",__name:"info-filled",setup(o){return(a,t)=>(i(),c("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[e("path",{fill:"currentColor",d:"M512 64a448 448 0 1 1 0 896.064A448 448 0 0 1 512 64m67.2 275.072c33.28 0 60.288-23.104 60.288-57.344s-27.072-57.344-60.288-57.344c-33.28 0-60.16 23.104-60.16 57.344s26.88 57.344 60.16 57.344M590.912 699.2c0-6.848 2.368-24.64 1.024-34.752l-52.608 60.544c-10.88 11.456-24.512 19.392-30.912 17.28a12.992 12.992 0 0 1-8.256-14.72l87.68-276.992c7.168-35.136-12.544-67.2-54.336-71.296-44.096 0-108.992 44.736-148.48 101.504 0 6.784-1.28 23.68.064 33.792l52.544-60.608c10.88-11.328 23.552-19.328 29.952-17.152a12.8 12.8 0 0 1 7.808 16.128L388.48 728.576c-10.048 32.256 8.96 63.872 55.04 71.04 67.84 0 107.904-43.648 147.456-100.416z"})]))}}),wo=Ys,er=de({name:"SuccessFilled",__name:"success-filled",setup(o){return(a,t)=>(i(),c("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[e("path",{fill:"currentColor",d:"M512 64a448 448 0 1 1 0 896 448 448 0 0 1 0-896m-55.808 536.384-99.52-99.584a38.4 38.4 0 1 0-54.336 54.336l126.72 126.72a38.272 38.272 0 0 0 54.336 0l262.4-262.464a38.4 38.4 0 1 0-54.272-54.336z"})]))}}),xo=er,tr=de({name:"WarningFilled",__name:"warning-filled",setup(o){return(a,t)=>(i(),c("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[e("path",{fill:"currentColor",d:"M512 64a448 448 0 1 1 0 896 448 448 0 0 1 0-896m0 192a58.432 58.432 0 0 0-58.24 63.744l23.36 256.384a35.072 35.072 0 0 0 69.76 0l23.296-256.384A58.432 58.432 0 0 0 512 256m0 512a51.2 51.2 0 1 0 0-102.4 51.2 51.2 0 0 0 0 102.4"})]))}}),bo=tr;const _o="__epPropKey",Re=o=>o,or=o=>ho(o)&&!!o[_o],$o=(o,a)=>{if(!ho(o)||or(o))return o;const{values:t,required:s,default:r,type:h,validator:x}=o,$={type:h,required:!!s,validator:t||x?R=>{let I=!1,P=[];if(t&&(P=Array.from(t),Rt(o,"default")&&P.push(r),I||(I=P.includes(R))),x&&(I||(I=x(R))),!I&&P.length>0){const m=[...new Set(P)].map(N=>JSON.stringify(N)).join(", ");is(`Invalid prop: validation failed${a?` for prop "${a}"`:""}. Expected one of [${m}], got value ${JSON.stringify(R)}.`)}return I}:void 0,[_o]:!0};return Rt(o,"default")&&($.default=r),$},Tt=o=>ws(Object.entries(o).map(([a,t])=>[a,$o(t,a)])),sr=Re([String,Object,Function]),rr={Close:Xs,SuccessFilled:xo,InfoFilled:wo,WarningFilled:bo,CircleCloseFilled:ko},Yt={success:xo,warning:bo,error:ko,info:wo},Io=(o,a)=>{if(o.install=t=>{for(const s of[o,...Object.values(a??{})])t.component(s.name,s)},a)for(const[t,s]of Object.entries(a))o[t]=s;return o},ar=(o,a)=>(o.install=t=>{o._context=t._context,t.config.globalProperties[a]=o},o),nr={tab:"Tab",enter:"Enter",space:"Space",left:"ArrowLeft",up:"ArrowUp",right:"ArrowRight",down:"ArrowDown",esc:"Escape",delete:"Delete",backspace:"Backspace",numpadEnter:"NumpadEnter",pageUp:"PageUp",pageDown:"PageDown",home:"Home",end:"End"},lr=["","default","small","large"],ir=o=>o,eo=({from:o,replacement:a,scope:t,version:s,ref:r,type:h="API"},x)=>{fe(()=>te(x),p=>{},{immediate:!0})};var cr={name:"en",el:{breadcrumb:{label:"Breadcrumb"},colorpicker:{confirm:"OK",clear:"Clear",defaultLabel:"color picker",description:"current color is {color}. press enter to select a new color."},datepicker:{now:"Now",today:"Today",cancel:"Cancel",clear:"Clear",confirm:"OK",dateTablePrompt:"Use the arrow keys and enter to select the day of the month",monthTablePrompt:"Use the arrow keys and enter to select the month",yearTablePrompt:"Use the arrow keys and enter to select the year",selectedDate:"Selected date",selectDate:"Select date",selectTime:"Select time",startDate:"Start Date",startTime:"Start Time",endDate:"End Date",endTime:"End Time",prevYear:"Previous Year",nextYear:"Next Year",prevMonth:"Previous Month",nextMonth:"Next Month",year:"",month1:"January",month2:"February",month3:"March",month4:"April",month5:"May",month6:"June",month7:"July",month8:"August",month9:"September",month10:"October",month11:"November",month12:"December",week:"week",weeks:{sun:"Sun",mon:"Mon",tue:"Tue",wed:"Wed",thu:"Thu",fri:"Fri",sat:"Sat"},weeksFull:{sun:"Sunday",mon:"Monday",tue:"Tuesday",wed:"Wednesday",thu:"Thursday",fri:"Friday",sat:"Saturday"},months:{jan:"Jan",feb:"Feb",mar:"Mar",apr:"Apr",may:"May",jun:"Jun",jul:"Jul",aug:"Aug",sep:"Sep",oct:"Oct",nov:"Nov",dec:"Dec"}},inputNumber:{decrease:"decrease number",increase:"increase number"},select:{loading:"Loading",noMatch:"No matching data",noData:"No data",placeholder:"Select"},dropdown:{toggleDropdown:"Toggle Dropdown"},cascader:{noMatch:"No matching data",loading:"Loading",placeholder:"Select",noData:"No data"},pagination:{goto:"Go to",pagesize:"/page",total:"Total {total}",pageClassifier:"",page:"Page",prev:"Go to previous page",next:"Go to next page",currentPage:"page {pager}",prevPages:"Previous {pager} pages",nextPages:"Next {pager} pages",deprecationWarning:"Deprecated usages detected, please refer to the el-pagination documentation for more details"},dialog:{close:"Close this dialog"},drawer:{close:"Close this dialog"},messagebox:{title:"Message",confirm:"OK",cancel:"Cancel",error:"Illegal input",close:"Close this dialog"},upload:{deleteTip:"press delete to remove",delete:"Delete",preview:"Preview",continue:"Continue"},slider:{defaultLabel:"slider between {min} and {max}",defaultRangeStartLabel:"pick start value",defaultRangeEndLabel:"pick end value"},table:{emptyText:"No Data",confirmFilter:"Confirm",resetFilter:"Reset",clearFilter:"All",sumText:"Sum"},tour:{next:"Next",previous:"Previous",finish:"Finish"},tree:{emptyText:"No Data"},transfer:{noMatch:"No matching data",noData:"No data",titles:["List 1","List 2"],filterPlaceholder:"Enter keyword",noCheckedFormat:"{total} items",hasCheckedFormat:"{checked}/{total} checked"},image:{error:"FAILED"},pageHeader:{title:"Back"},popconfirm:{confirmButtonText:"Yes",cancelButtonText:"No"},carousel:{leftArrow:"Carousel arrow left",rightArrow:"Carousel arrow right",indicator:"Carousel switch to index {index}"}}};const dr=o=>(a,t)=>ur(a,t,te(o)),ur=(o,a,t)=>xs(t,o,o).replace(/\{(\w+)\}/g,(s,r)=>{var h;return`${(h=a==null?void 0:a[r])!=null?h:`{${r}}`}`}),gr=o=>{const a=re(()=>te(o).name),t=cs(o)?o:_(o);return{lang:a,locale:t,t:dr(o)}},Co=Symbol("localeContextKey"),vr=o=>{const a=o||Ge(Co,_());return gr(re(()=>a.value||cr))},dt="el",hr="is-",Ve=(o,a,t,s,r)=>{let h=`${o}-${a}`;return t&&(h+=`-${t}`),s&&(h+=`__${s}`),r&&(h+=`--${r}`),h},So=Symbol("namespaceContextKey"),pr=o=>{const a=o||(We()?Ge(So,_(dt)):_(dt));return re(()=>te(a)||dt)},Mt=(o,a)=>{const t=pr(a);return{namespace:t,b:(H="")=>Ve(t.value,o,H,"",""),e:H=>H?Ve(t.value,o,"",H,""):"",m:H=>H?Ve(t.value,o,"","",H):"",be:(H,q)=>H&&q?Ve(t.value,o,H,q,""):"",em:(H,q)=>H&&q?Ve(t.value,o,"",H,q):"",bm:(H,q)=>H&&q?Ve(t.value,o,H,"",q):"",bem:(H,q,w)=>H&&q&&w?Ve(t.value,o,H,q,w):"",is:(H,...q)=>{const w=q.length>=1?q[0]:!0;return H&&w?`${hr}${H}`:""},cssVar:H=>{const q={};for(const w in H)H[w]&&(q[`--${t.value}-${w}`]=H[w]);return q},cssVarName:H=>`--${t.value}-${H}`,cssVarBlock:H=>{const q={};for(const w in H)H[w]&&(q[`--${t.value}-${o}-${w}`]=H[w]);return q},cssVarBlockName:H=>`--${t.value}-${o}-${H}`}},to={current:0},oo=_(0),To=2e3,so=Symbol("elZIndexContextKey"),Mo=Symbol("zIndexContextKey"),fr=o=>{const a=We()?Ge(so,to):to,t=o||(We()?Ge(Mo,void 0):void 0),s=re(()=>{const x=te(t);return ot(x)?x:To}),r=re(()=>s.value+oo.value),h=()=>(a.current++,oo.value=a.current,r.value);return!Ze&&Ge(so),{initialZIndex:s,currentZIndex:r,nextZIndex:h}};$o({type:String,values:lr,required:!1});const mr=Symbol("size"),Ao=Symbol(),vt=_();function Lo(o,a=void 0){const t=We()?Ge(Ao,vt):vt;return o?re(()=>{var s,r;return(r=(s=t.value)==null?void 0:s[o])!=null?r:a}):t}function yr(o,a){const t=Lo(),s=Mt(o,re(()=>{var p;return((p=t.value)==null?void 0:p.namespace)||dt})),r=vr(re(()=>{var p;return(p=t.value)==null?void 0:p.locale})),h=fr(re(()=>{var p;return((p=t.value)==null?void 0:p.zIndex)||To})),x=re(()=>{var p;return te(a)||((p=t.value)==null?void 0:p.size)||""});return kr(re(()=>te(t)||{})),{ns:s,locale:r,zIndex:h,size:x}}const kr=(o,a,t=!1)=>{var s;const r=!!We(),h=r?Lo():void 0,x=(s=a==null?void 0:a.provide)!=null?s:r?ds:void 0;if(!x)return;const p=re(()=>{const $=te(o);return h!=null&&h.value?wr(h.value,$):$});return x(Ao,p),x(Co,re(()=>p.value.locale)),x(So,re(()=>p.value.namespace)),x(Mo,re(()=>p.value.zIndex)),x(mr,{size:re(()=>p.value.size||"")}),(t||!vt.value)&&(vt.value=p.value),p},wr=(o,a)=>{const t=[...new Set([...Xt(o),...Xt(a)])],s={};for(const r of t)s[r]=a[r]!==void 0?a[r]:o[r];return s},ro={};var At=(o,a)=>{const t=o.__vccOpts||o;for(const[s,r]of a)t[s]=r;return t};const xr=Tt({size:{type:Re([Number,String])},color:{type:String}}),br=de({name:"ElIcon",inheritAttrs:!1}),_r=de({...br,props:xr,setup(o){const a=o,t=Mt("icon"),s=re(()=>{const{size:r,color:h}=a;return!r&&!h?{}:{fontSize:Gs(r)?void 0:$t(r),"--color":h}});return(r,h)=>(i(),c("i",us({class:te(t).b(),style:te(s)},r.$attrs),[ht(r.$slots,"default")],16))}});var $r=At(_r,[["__file","icon.vue"]]);const ao=Io($r),Ir=Tt({value:{type:[String,Number],default:""},max:{type:Number,default:99},isDot:Boolean,hidden:Boolean,type:{type:String,values:["primary","success","warning","info","danger"],default:"danger"},showZero:{type:Boolean,default:!0},color:String,dotStyle:{type:Re([String,Object,Array])},badgeStyle:{type:Re([String,Object,Array])},offset:{type:Re(Array),default:[0,0]},dotClass:{type:String},badgeClass:{type:String}}),Cr=["textContent"],Sr=de({name:"ElBadge"}),Tr=de({...Sr,props:Ir,setup(o,{expose:a}){const t=o,s=Mt("badge"),r=re(()=>t.isDot?"":ot(t.value)&&ot(t.max)?t.max<t.value?`${t.max}+`:t.value===0&&!t.showZero?"":`${t.value}`:`${t.value}`),h=re(()=>{var x,p,$,R,I,P;return[{backgroundColor:t.color,marginRight:$t(-((p=(x=t.offset)==null?void 0:x[0])!=null?p:0)),marginTop:$t((R=($=t.offset)==null?void 0:$[1])!=null?R:0)},(I=t.dotStyle)!=null?I:{},(P=t.badgeStyle)!=null?P:{}]});return eo({from:"dot-style",replacement:"badge-style",version:"2.8.0",scope:"el-badge",ref:"https://element-plus.org/en-US/component/badge.html"},re(()=>!!t.dotStyle)),eo({from:"dot-class",replacement:"badge-class",version:"2.8.0",scope:"el-badge",ref:"https://element-plus.org/en-US/component/badge.html"},re(()=>!!t.dotClass)),a({content:r}),(x,p)=>(i(),c("div",{class:se(te(s).b())},[ht(x.$slots,"default"),ke(ut,{name:`${te(s).namespace.value}-zoom-in-center`,persisted:""},{default:Be(()=>[ce(e("sup",{class:se([te(s).e("content"),te(s).em("content",x.type),te(s).is("fixed",!!x.$slots.default),te(s).is("dot",x.isDot),x.dotClass,x.badgeClass]),style:pt(te(h)),textContent:J(te(r))},null,14,Cr),[[io,!x.hidden&&(te(r)||x.isDot)]])]),_:1},8,["name"])],2))}});var Mr=At(Tr,[["__file","badge.vue"]]);const Ar=Io(Mr),jo=["success","info","warning","error"],_e=ir({customClass:"",center:!1,dangerouslyUseHTMLString:!1,duration:3e3,icon:void 0,id:"",message:"",onClose:void 0,showClose:!1,type:"info",plain:!1,offset:16,zIndex:0,grouping:!1,repeatNum:1,appendTo:Ze?document.body:void 0}),Lr=Tt({customClass:{type:String,default:_e.customClass},center:{type:Boolean,default:_e.center},dangerouslyUseHTMLString:{type:Boolean,default:_e.dangerouslyUseHTMLString},duration:{type:Number,default:_e.duration},icon:{type:sr,default:_e.icon},id:{type:String,default:_e.id},message:{type:Re([String,Object,Function]),default:_e.message},onClose:{type:Re(Function),default:_e.onClose},showClose:{type:Boolean,default:_e.showClose},type:{type:String,values:jo,default:_e.type},plain:{type:Boolean,default:_e.plain},offset:{type:Number,default:_e.offset},zIndex:{type:Number,default:_e.zIndex},grouping:{type:Boolean,default:_e.grouping},repeatNum:{type:Number,default:_e.repeatNum}}),jr={destroy:()=>!0},Ae=gs([]),Nr=o=>{const a=Ae.findIndex(r=>r.id===o),t=Ae[a];let s;return a>0&&(s=Ae[a-1]),{current:t,prev:s}},Er=o=>{const{prev:a}=Nr(o);return a?a.vm.exposed.bottom.value:0},Ur=(o,a)=>Ae.findIndex(s=>s.id===o)>0?16:a,Br=["id"],Dr=["innerHTML"],Fr=de({name:"ElMessage"}),Pr=de({...Fr,props:Lr,emits:jr,setup(o,{expose:a}){const t=o,{Close:s}=rr,{ns:r,zIndex:h}=yr("message"),{currentZIndex:x,nextZIndex:p}=h,$=_(),R=_(!1),I=_(0);let P;const m=re(()=>t.type?t.type==="error"?"danger":t.type:"info"),N=re(()=>{const E=t.type;return{[r.bm("icon",E)]:E&&Yt[E]}}),Y=re(()=>t.icon||Yt[t.type]||""),H=re(()=>Er(t.id)),q=re(()=>Ur(t.id,t.offset)+H.value),w=re(()=>I.value+q.value),b=re(()=>({top:`${q.value}px`,zIndex:x.value}));function D(){t.duration!==0&&({stop:P}=Us(()=>{K()},t.duration))}function G(){P==null||P()}function K(){R.value=!1}function Q({code:E}){E===nr.esc&&K()}return Te(()=>{D(),p(),R.value=!0}),fe(()=>t.repeatNum,()=>{G(),D()}),Bs(document,"keydown",Q),zs($,()=>{I.value=$.value.getBoundingClientRect().height}),a({visible:R,bottom:w,close:K}),(E,ee)=>(i(),Me(ut,{name:te(r).b("fade"),onBeforeLeave:E.onClose,onAfterLeave:ee[0]||(ee[0]=ne=>E.$emit("destroy")),persisted:""},{default:Be(()=>[ce(e("div",{id:E.id,ref_key:"messageRef",ref:$,class:se([te(r).b(),{[te(r).m(E.type)]:E.type},te(r).is("center",E.center),te(r).is("closable",E.showClose),te(r).is("plain",E.plain),E.customClass]),style:pt(te(b)),role:"alert",onMouseenter:G,onMouseleave:D},[E.repeatNum>1?(i(),Me(te(Ar),{key:0,value:E.repeatNum,type:te(m),class:se(te(r).e("badge"))},null,8,["value","type","class"])):z("v-if",!0),te(Y)?(i(),Me(te(ao),{key:1,class:se([te(r).e("icon"),te(N)])},{default:Be(()=>[(i(),Me(vs(te(Y))))]),_:1},8,["class"])):z("v-if",!0),ht(E.$slots,"default",{},()=>[E.dangerouslyUseHTMLString?(i(),c(ue,{key:1},[z(" Caution here, message could've been compromised, never use user's input as message "),e("p",{class:se(te(r).e("content")),innerHTML:E.message},null,10,Dr)],2112)):(i(),c("p",{key:0,class:se(te(r).e("content"))},J(E.message),3))]),E.showClose?(i(),Me(te(ao),{key:2,class:se(te(r).e("closeBtn")),onClick:ge(K,["stop"])},{default:Be(()=>[ke(te(s))]),_:1},8,["class","onClick"])):z("v-if",!0)],46,Br),[[io,R.value]])]),_:3},8,["name","onBeforeLeave"]))}});var Qr=At(Pr,[["__file","message.vue"]]);let zr=1;const No=o=>{const a=!o||gt(o)||co(o)||_t(o)?{message:o}:o,t={..._e,...a};if(!t.appendTo)t.appendTo=document.body;else if(gt(t.appendTo)){let s=document.querySelector(t.appendTo);Ws(s)||(s=document.body),t.appendTo=s}return t},Vr=o=>{const a=Ae.indexOf(o);if(a===-1)return;Ae.splice(a,1);const{handler:t}=o;t.close()},Rr=({appendTo:o,...a},t)=>{const s=`message_${zr++}`,r=a.onClose,h=document.createElement("div"),x={...a,id:s,onClose:()=>{r==null||r(),Vr(I)},onDestroy:()=>{Qt(null,h)}},p=ke(Qr,x,_t(x.message)||co(x.message)?{default:_t(x.message)?x.message:()=>x.message}:null);p.appContext=t||Je._context,Qt(p,h),o.appendChild(h.firstElementChild);const $=p.component,I={id:s,vnode:p,vm:$,handler:{close:()=>{$.exposed.visible.value=!1}},props:p.component.props};return I},Je=(o={},a)=>{if(!Ze)return{close:()=>{}};if(ot(ro.max)&&Ae.length>=ro.max)return{close:()=>{}};const t=No(o);if(t.grouping&&Ae.length){const r=Ae.find(({vnode:h})=>{var x;return((x=h.props)==null?void 0:x.message)===t.message});if(r)return r.props.repeatNum+=1,r.props.type=t.type,r.handler}const s=Rr(t,a);return Ae.push(s),s.handler};jo.forEach(o=>{Je[o]=(a={},t)=>{const s=No(a);return Je({...s,type:o},t)}});function Or(o){for(const a of Ae)(!o||o===a.props.type)&&a.handler.close()}Je.closeAll=Or;Je._context=null;const je=ar(Je,"$message");function Lt(){const o=It(),a=o.token,t=o.isLogin;return console.log("身份验证状态检查:",{isLoggedIn:t,hasToken:!!a,tokenLength:a?a.length:0,tokenPrefix:a?a.substring(0,10)+"...":"null",userInfo:o.userInfo?"已加载":"未加载"}),{isLoggedIn:t,hasToken:!!a,token:a}}const qr=(o="")=>{const a=Date.now().toString().slice(-6),t=Math.random().toString(36).substring(2,7);return o?`${o}_${a}${t}`:`${a}${t}`};function Hr(o){return o.length>200?o.substring(0,200)+"...":o}function Gr(o,a){return!!o[a]}function it(o){if(o.length===0)return{total:0,completed:0,failed:0,inProgress:0};const a=o.filter(r=>r.status==="completed").length,t=o.filter(r=>r.status==="failed").length,s=o.length;return{total:s,completed:a,failed:t,inProgress:s-a-t}}function Wr(o,a){const t=o.filter(r=>r.batchId===a),s=new Set(t.map(r=>r.status));return s.size===1?t[0].status:s.has("failed")&&s.size>1?"mixed":s.has("pending")||s.has("running")?"running":"mixed"}const Jr=o=>{const a=[],t={},s=[];return o.forEach(r=>{r.batchId?(t[r.batchId]||(t[r.batchId]=[]),t[r.batchId].push(r)):s.push(r)}),Object.keys(t).forEach(r=>{if(!r)return;const h=t[r].sort(($,R)=>($.batchIndex||1)-(R.batchIndex||1)),x=h[0],p=new Date(x.createTime).getTime();a.push({type:"batch",id:r,tasks:h,createTime:p})}),s.forEach(r=>{a.push({type:"single",id:r.id,tasks:[r],createTime:new Date(r.createTime).getTime()})}),a.sort((r,h)=>h.createTime-r.createTime),a};async function Kr(o){var a,t,s;try{if(!Lt().isLoggedIn)return console.warn(`功能检查失败: 用户未登录，functionId=${o}`),je.warning("请先登录后再使用该功能"),!1;console.log(`开始检查功能可用性: ${o}`);const h=await Ms(o);if(console.log("功能可用性检查响应:",h),!((a=h.data)!=null&&a.isAvailable)){const p={xhs_materials:"素材库",ai_title:"AI选题"}[o]||"该功能";return je.warning(`${p}当前不可用，请升级套餐`),!1}return!0}catch(r){return console.error(`检查功能${o}权限失败:`,r),r.response&&console.error("错误响应:",r.response),((t=r.response)==null?void 0:t.status)===401||(s=r.message)!=null&&s.includes("401")?je.warning("请先登录后再使用该功能"):je.error(`功能检查失败: ${r.message||"未知错误"}`),!1}}async function Zr(o){var a,t,s;try{if(!Lt().isLoggedIn)return console.warn(`积分检查失败: 用户未登录，functionId=${o}`),je.warning("请先登录后再使用该功能"),!1;console.log(`开始检查功能积分: ${o}`);const h=await As(o);if(console.log("功能积分检查响应:",h),!((a=h.data)!=null&&a.hasEnoughPoint)){const p={xhs_materials:"素材库",ai_title:"AI选题"}[o]||"该功能";return je.warning(`积分不足，无法使用${p}功能，请升级套餐`),!1}return!0}catch(r){return console.error(`检查功能${o}积分是否足够失败:`,r),r.response&&console.error("错误响应:",r.response),((t=r.response)==null?void 0:t.status)===401||(s=r.message)!=null&&s.includes("401")?je.warning("请先登录后再使用该功能"):je.error(`积分检查失败: ${r.message||"未知错误"}`),!1}}function tt(o){return o?o.error==="REGULAR_BALANCE_INSUFFICIENT"||o.code==="REGULAR_BALANCE_INSUFFICIENT"||o.message&&o.message.includes("积分不足")?o.message||"积分不足，继续体验服务，请按需选购套餐！":o.data&&(o.data.error==="REGULAR_BALANCE_INSUFFICIENT"||o.data.code==="REGULAR_BALANCE_INSUFFICIENT"||o.data.message&&o.data.message.includes("积分不足"))?o.data.message||"积分不足，继续体验服务，请按需选购套餐！":o.data&&o.data.data&&(o.data.data.error==="REGULAR_BALANCE_INSUFFICIENT"||o.data.data.code==="REGULAR_BALANCE_INSUFFICIENT"||o.data.data.message&&o.data.data.message.includes("积分不足"))?o.data.data.message||"积分不足，继续体验服务，请按需选购套餐！":null:null}function Eo(o){var a,t,s,r;console.error("API请求失败:",o),(((a=o==null?void 0:o.response)==null?void 0:a.status)===401||(t=o==null?void 0:o.message)!=null&&t.includes("401")||(s=o==null?void 0:o.message)!=null&&s.includes("认证")||(r=o==null?void 0:o.message)!=null&&r.includes("登录"))&&console.error("认证错误，需要重新登录")}const rt=o=>{var a;if(!o||o.error)throw new Error(((a=o==null?void 0:o.error)==null?void 0:a.message)||"请求失败");return o};async function Xr(o){try{console.log(`上传文件: ${o.name}, 大小: ${o.size} 字节`);const a=await Ss(o);return console.log(`文件上传成功，获取到fileId: ${a}`),a}catch(a){throw console.error(`上传文件 ${o.name} 失败:`,a),a}}async function Uo(){var o;try{console.log("请求素材库文件夹列表");const a=await De({url:"/material/folders"});if(console.log("素材库文件夹API响应:",a),!a)return console.error("响应为空"),{success:!0,data:[]};let t=[];return a.data&&Array.isArray(a.data)?t=a.data:a.data&&typeof a.data=="object"?t=[a.data]:Array.isArray(a)&&(t=a),console.log(`处理后获取到 ${t.length} 个文件夹`),{success:!0,data:t}}catch(a){return console.error("获取素材库文件夹列表失败:",a),((o=a==null?void 0:a.response)==null?void 0:o.status)===401&&Eo(a),{success:!0,data:[]}}}async function Yr(o){var a;try{console.log("创建素材库文件夹:",o);const t=await Ee({url:"/material/folders",data:{name:o}});return console.log("创建文件夹API响应:",t),rt(t)}catch(t){throw console.error("创建素材库文件夹失败:",t),((a=t==null?void 0:t.response)==null?void 0:a.status)===401&&Eo(t),t}}async function Bo(o){try{console.log("请求素材库文件列表, 文件夹ID:",o);const a=await De({url:"/material/files",data:{folderId:o}});return console.log("素材列表API响应:",a),rt(a)}catch(a){return console.error("获取素材库文件列表失败:",a),{success:!0,data:[]}}}async function ea(o,a){try{const t=new FormData;t.append("file",o),t.append("folderId",a);const s=await Ee({url:"/material/upload",data:t,headers:{"Content-Type":"multipart/form-data"}});return rt(s)}catch(t){throw console.error("上传素材失败:",t),t}}async function ta(o){try{const a=await Ee({url:"/material/files/delete",data:{id:o}});return rt(a)}catch(a){throw console.error("删除素材失败:",a),a}}async function oa(o){try{if(console.log("发送删除文件夹请求, ID:",o),!o)throw console.error("文件夹ID为空"),new Error("文件夹ID不能为空");const a={id:o};console.log("发送的请求数据:",a);const s=await Ee({url:"/material/folders/delete",data:a,headers:{"Content-Type":"application/json"},beforeRequest:()=>{console.log("准备发送删除文件夹请求...")},afterRequest:()=>{console.log("删除文件夹请求处理完成")}});return console.log("删除文件夹请求发送成功，响应:",s),rt(s)}catch(a){if(console.error("删除素材文件夹失败:",a),a.response&&(console.error("错误响应状态:",a.response.status),console.error("错误响应数据:",a.response.data),a.response.status===302)){console.error("请求被重定向，可能是认证问题，尝试重新登录");const t=window.useAuthStore&&window.useAuthStore();t&&(t.removeToken(),t.setLoginDialog&&t.setLoginDialog(!0))}throw a}}const sa={class:"mb-6"},ra=e("label",{class:"block text-gray-700 dark:text-gray-300 mb-2 font-medium"},[Z(" 品牌产品 "),e("span",{class:"text-red-500"},"*")],-1),aa=de({__name:"BrandProductInput",props:{modelValue:{}},emits:["update:modelValue"],setup(o,{emit:a}){const t=o,s=a,r=re({get:()=>t.modelValue,set:h=>s("update:modelValue",h)});return(h,x)=>(i(),c("div",sa,[ra,ce(e("input",{"onUpdate:modelValue":x[0]||(x[0]=p=>r.value=p),type:"text",placeholder:"输入品牌和产品名称（如：欧诗漫OSM光感小白瓶）",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-700 dark:bg-gray-800 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500 dark:text-white transition-all duration-200",required:""},null,512),[[we,r.value]])]))}}),Se=o=>(Oe("data-v-2167a7af"),o=o(),qe(),o),na={class:"mb-6"},la=Se(()=>e("label",{class:"block text-gray-700 dark:text-gray-300 mb-2 font-medium"},[Z(" 产品选题 "),e("span",{class:"text-red-500"},"*")],-1)),ia={class:"flex items-center"},ca={class:"relative flex-1"},da=["disabled"],ua=Se(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1)),ga=Se(()=>e("span",null,"添加",-1)),va=[ua,ga],ha=["title"],pa=Se(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1)),fa=Se(()=>e("span",{class:"hidden sm:inline"},"AI生成选题",-1)),ma=Se(()=>e("span",{class:"sm:hidden"},"AI选题",-1)),ya=[pa,fa,ma],ka={class:"mt-3 border border-gray-200 dark:border-gray-700 rounded-md p-2 min-h-[100px] max-h-[300px] overflow-y-auto"},wa={key:0,class:"flex flex-col items-center justify-center h-full py-6 text-gray-400 dark:text-gray-500"},xa=Se(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-10 w-10",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})],-1)),ba=Se(()=>e("p",{class:"mt-2 text-sm"},"请添加至少一个选题",-1)),_a=[xa,ba],$a={key:0,class:"flex-1 flex"},Ia=Se(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)),Ca=[Ia],Sa=Se(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)),Ta=[Sa],Ma=["title"],Aa={class:"inline-flex items-center justify-center flex-shrink-0 w-6 h-6 bg-pink-100 dark:bg-pink-900/50 text-pink-600 dark:text-pink-400 rounded-full text-xs font-medium mr-2"},La={class:"truncate"},ja=["onClick"],Na=Se(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)),Ea=[Na],Ua=["onClick"],Ba=Se(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)),Da=[Ba],Fa={class:"mt-2 text-xs text-gray-500 dark:text-gray-400 flex items-center justify-between px-2"},Pa=Se(()=>e("span",{class:"flex items-center text-pink-500"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3.5 w-3.5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]),Z(" 鼠标悬停可查看编辑和删除选项 ")],-1)),Qa=de({__name:"TitleManager",props:{modelValue:{}},emits:["update:modelValue","request-ai-topic"],setup(o,{emit:a}){const t=o,s=a,r=_(""),h=_(t.modelValue||[]),x=_(null),p=_(""),$=_(null),R=_(!0);Te(()=>{I()});async function I(){R.value=await Zr("ai_title")}function P(){const w=r.value.trim();if(w)if(h.value.includes(w))r.value="";else{const b=[...h.value,w];h.value=b,s("update:modelValue",b),r.value=""}}function m(w,b){x.value=w,p.value=b,st(()=>{$.value&&$.value.focus()})}function N(){if(x.value!==null){const w=p.value.trim();if(w){const b=[...h.value];b[x.value]=w,h.value=b,s("update:modelValue",b)}x.value=null,p.value=""}}function Y(){x.value=null,p.value=""}function H(w){const b=[...h.value];b.splice(w,1),h.value=b,s("update:modelValue",b)}function q(w){if(w==null||w.preventDefault(),w==null||w.stopPropagation(),!R.value){je.warning("积分不足，无法使用AI选题功能，请升级套餐");return}s("request-ai-topic")}return(w,b)=>(i(),c("div",null,[e("div",na,[la,e("div",ia,[e("div",ca,[ce(e("input",{"onUpdate:modelValue":b[0]||(b[0]=D=>r.value=D),onKeyup:ct(P,["enter"]),type:"text",placeholder:"输入产品选题（如：适合初学者的手工DIY耳环制作）",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-700 dark:bg-gray-800 rounded-l-md focus:outline-none focus:ring-2 focus:ring-pink-500 dark:text-white transition-all duration-200"},null,544),[[we,r.value]])]),e("button",{onClick:ge(P,["stop","prevent"]),class:"px-4 py-2 bg-pink-500 text-white rounded-r-md hover:bg-pink-600 transition-all duration-200 flex items-center",disabled:!r.value.trim(),type:"button"},va,8,da),e("button",{onClick:ge(q,["stop","prevent"]),class:se(["ml-2 px-3 py-2 bg-purple-500 text-white rounded-md hover:bg-purple-600 transition-all duration-200 flex items-center",{"opacity-50 cursor-not-allowed":!R.value}]),title:R.value?"AI智能生成选题":"积分不足，无法使用AI选题功能，请升级套餐",type:"button"},ya,10,ha)]),e("div",ka,[h.value.length===0?(i(),c("div",wa,_a)):z("",!0),ke(hs,{name:"list",tag:"div",class:"space-y-2"},{default:Be(()=>[(i(!0),c(ue,null,xe(h.value,(D,G)=>(i(),c("div",{key:G,class:"flex items-center py-2 px-3 rounded-md bg-gray-50 dark:bg-gray-800 group hover:bg-gray-100 dark:hover:bg-gray-750 transition-all duration-200"},[x.value===G?(i(),c("div",$a,[ce(e("input",{"onUpdate:modelValue":b[1]||(b[1]=K=>p.value=K),ref_for:!0,ref_key:"editInput",ref:$,onKeyup:[ct(N,["enter"]),ct(Y,["esc"])],type:"text",class:"w-full px-3 py-1 border border-gray-300 dark:border-gray-700 dark:bg-gray-900 rounded focus:outline-none focus:ring-2 focus:ring-pink-500 dark:text-white transition-all duration-200"},null,544),[[we,p.value]]),e("div",{class:"flex"},[e("button",{onClick:N,class:"ml-2 text-xs px-2 py-1 text-green-600 hover:text-green-700 hover:bg-green-50 dark:text-green-400 dark:hover:text-green-300 dark:hover:bg-green-900/20 rounded transition-all duration-200",title:"保存"},Ca),e("button",{onClick:Y,class:"text-xs px-2 py-1 text-red-600 hover:text-red-700 hover:bg-red-50 dark:text-red-400 dark:hover:text-red-300 dark:hover:bg-red-900/20 rounded transition-all duration-200",title:"取消"},Ta)])])):(i(),c("div",{key:1,class:"flex-1 text-gray-700 dark:text-gray-300 truncate flex items-center",title:D},[e("span",Aa,J(G+1),1),e("span",La,J(D),1)],8,Ma)),x.value!==G?(i(),c(ue,{key:2},[e("button",{onClick:ge(K=>m(G,D),["stop","prevent"]),class:"opacity-0 group-hover:opacity-100 text-xs px-2 py-1 text-blue-600 hover:text-blue-700 hover:bg-blue-50 dark:text-blue-400 dark:hover:text-blue-300 dark:hover:bg-blue-900/20 rounded transition-all duration-200",title:"编辑"},Ea,8,ja),e("button",{onClick:ge(K=>H(G),["stop","prevent"]),class:"opacity-0 group-hover:opacity-100 text-xs px-2 py-1 text-red-600 hover:text-red-700 hover:bg-red-50 dark:text-red-400 dark:hover:text-red-300 dark:hover:bg-red-900/20 rounded transition-all duration-200",title:"删除"},Da,8,Ua)],64)):z("",!0)]))),128))]),_:1}),e("div",Fa,[Pa,e("span",null," 共 "+J(h.value.length)+" 个选题 ",1)])])])]))}});const za=He(Qa,[["__scopeId","data-v-2167a7af"]]),Va={class:"mb-6"},Ra=e("label",{class:"block text-gray-700 dark:text-gray-300 mb-2 font-medium"}," 选择活动 ",-1),Oa={class:"flex flex-col sm:flex-row sm:items-center space-y-2 sm:space-y-0 sm:space-x-2"},qa={class:"relative flex-1"},Ha=["disabled"],Ga=["value"],Wa=e("div",{class:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})])],-1),Ja=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),Ka=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})],-1),Za=["disabled"],Xa=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1),Ya=[Xa],en={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-75 backdrop-blur-sm"},tn={class:"bg-white dark:bg-gray-800 rounded-xl p-6 max-w-md w-full shadow-2xl transform transition-all duration-300 scale-100"},on={class:"flex justify-between items-center mb-4"},sn=e("h3",{class:"text-lg font-bold text-gray-800 dark:text-gray-200"}," 创建新活动 ",-1),rn=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),an=[rn],nn={class:"mb-4"},ln=e("label",{class:"block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium"},[Z(" 活动名称 "),e("span",{class:"text-red-500"},"*")],-1),cn={class:"mb-4"},dn=e("label",{class:"block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium"}," 活动类型 ",-1),un={class:"flex space-x-4"},gn={class:"flex items-center"},vn=e("span",{class:"ml-2 text-gray-700 dark:text-gray-300"},"普通活动",-1),hn={class:"flex items-center"},pn=e("span",{class:"ml-2 text-gray-700 dark:text-gray-300"},"特殊活动",-1),fn={class:"mb-4"},mn=e("label",{class:"block text-gray-700 dark:text-gray-300 mb-2 text-sm font-medium"}," 活动状态 ",-1),yn={class:"flex space-x-4"},kn={class:"flex items-center"},wn=e("span",{class:"ml-2 text-gray-700 dark:text-gray-300"},"活跃",-1),xn={class:"flex items-center"},bn=e("span",{class:"ml-2 text-gray-700 dark:text-gray-300"},"非活跃",-1),_n={class:"flex justify-end space-x-2 mt-6"},$n=["disabled"],In={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Cn=e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),Sn=e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1),Tn=[Cn,Sn],Mn=de({__name:"ActivityManager",props:{modelValue:{}},emits:["update:modelValue","error"],setup(o,{expose:a,emit:t}){bt();const s=go(),r=o,h=t,x=_([]),p=_(!1),$=_(!1),R=_(!1),I=_({name:"",type:"normal",status:"active"}),P=_(r.modelValue||"");fe(P,b=>{h("update:modelValue",b)}),fe(()=>r.modelValue,b=>{P.value=b});const m=(b="")=>{const D=Date.now().toString().slice(-6),G=Math.random().toString(36).substring(2,7);return b?`${b}_${D}${G}`:`${D}${G}`},N=()=>{if(!x.value.some(D=>D.isDefault)){const D={id:m("d"),name:"日常使用",type:"normal",status:"active",totalNotes:0,availableNotes:0,publishedNotes:0,isDefault:!0};x.value.push(D),P.value||(P.value=D.id,h("update:modelValue",D.id))}};async function Y(){try{p.value=!0,console.log("开始获取活动列表...");const b=await vo();console.log("获取到活动列表数据:",b);let D=[];if(b){if(Array.isArray(b))console.log("响应是数组格式"),D=b;else if(typeof b=="object"){const K=b;K.data&&Array.isArray(K.data)?(console.log("响应的data字段是数组"),D=K.data):K.data&&typeof K.data=="object"?(console.log("响应的data字段是对象"),D=[K.data]):K.items&&Array.isArray(K.items)?(console.log("响应的items字段是数组"),D=K.items):(console.log("尝试将响应转为数组"),D=Object.values(K).filter(Q=>Q&&typeof Q=="object"))}}console.log("解析后的活动数据:",D);const G=D.map(K=>({id:K.id||m("a"),name:K.name||"未命名活动",type:K.type||"normal",status:K.status||"active",isDefault:!!K.isDefault,totalNotes:K.totalNotes||0,availableNotes:K.availableNotes||0,publishedNotes:K.publishedNotes||0}));x.value=G,console.log("已更新活动列表数组:",x.value),(!P.value||!x.value.find(K=>K.id===P.value))&&x.value.length>0&&(P.value=x.value[0].id,h("update:modelValue",P.value),console.log("自动选择第一个活动:",P.value)),N()}catch(b){console.error("获取活动列表失败:",b),h("error",b.message||"获取活动列表失败"),x.value=[],N()}finally{p.value=!1}}async function H(){if(I.value.name)try{$.value=!0,console.log("开始创建活动:",I.value);const b=await ms({name:I.value.name,type:I.value.type,status:I.value.status});if(console.log("创建活动API响应:",b),b&&b.data&&b.data.id){const D={id:b.data.id,name:I.value.name,type:I.value.type,status:I.value.status,isDefault:!1,totalNotes:0,availableNotes:0,publishedNotes:0};x.value.push(D),console.log("新活动已添加到列表:",D),P.value=D.id,h("update:modelValue",D.id),I.value={name:"",type:"normal",status:"active"},R.value=!1}else throw console.error("创建活动失败，响应无效:",b),new Error("创建活动失败，服务器未返回有效数据")}catch(b){console.error("创建活动失败:",b),h("error",b.message||"创建活动失败")}finally{$.value=!1}}function q(){Y()}function w(){localStorage.removeItem("currentActivityId"),s.showApp({id:"xhs-activities-app",name:"活动类型",type:"built-in",path:"xhs-activities"})}return Te(()=>{Y()}),a({refreshActivities:q,viewActivities:w}),(b,D)=>(i(),c("div",null,[e("div",Va,[Ra,e("div",Oa,[e("div",qa,[ce(e("select",{"onUpdate:modelValue":D[0]||(D[0]=G=>P.value=G),class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-700 dark:bg-gray-800 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500 dark:text-white transition-all duration-200 appearance-none",disabled:p.value},[(i(!0),c(ue,null,xe(x.value,G=>(i(),c("option",{key:G.id,value:G.id},[Z(J(G.name)+" ",1),G.isDefault?(i(),c(ue,{key:0},[Z("(默认)")],64)):z("",!0),G.totalNotes>0?(i(),c(ue,{key:1},[Z(" (可用:"+J(G.availableNotes)+"/总数:"+J(G.totalNotes)+") ",1)],64)):z("",!0)],8,Ga))),128))],8,Ha),[[xt,P.value]]),Wa]),e("button",{onClick:D[1]||(D[1]=G=>R.value=!0),class:"px-4 py-2 bg-purple-500 text-white rounded-md hover:bg-purple-600 transition-all duration-200 flex items-center justify-center"},[Ja,Z(" 新建活动 ")]),e("button",{onClick:w,class:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-all duration-200 flex items-center justify-center",title:"查看所有活动"},[Ka,Z(" 查看活动 ")]),e("button",{onClick:q,class:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600 transition-all duration-200 flex items-center justify-center",title:"刷新活动列表",disabled:p.value},[(i(),c("svg",{xmlns:"http://www.w3.org/2000/svg",class:se(["h-5 w-5",{"animate-spin":p.value}]),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Ya,2))],8,Za)])]),R.value?(i(),c("div",en,[e("div",tn,[e("div",on,[sn,e("button",{onClick:D[2]||(D[2]=G=>R.value=!1),class:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"},an)]),e("div",nn,[ln,ce(e("input",{"onUpdate:modelValue":D[3]||(D[3]=G=>I.value.name=G),type:"text",placeholder:"例如：双11促销活动",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-700 dark:bg-gray-800 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500 dark:text-white transition-all duration-200"},null,512),[[we,I.value.name]])]),e("div",cn,[dn,e("div",un,[e("label",gn,[ce(e("input",{"onUpdate:modelValue":D[4]||(D[4]=G=>I.value.type=G),type:"radio",value:"normal",class:"form-radio h-4 w-4 text-pink-500 focus:ring-pink-500"},null,512),[[lt,I.value.type]]),vn]),e("label",hn,[ce(e("input",{"onUpdate:modelValue":D[5]||(D[5]=G=>I.value.type=G),type:"radio",value:"special",class:"form-radio h-4 w-4 text-pink-500 focus:ring-pink-500"},null,512),[[lt,I.value.type]]),pn])])]),e("div",fn,[mn,e("div",yn,[e("label",kn,[ce(e("input",{"onUpdate:modelValue":D[6]||(D[6]=G=>I.value.status=G),type:"radio",value:"active",class:"form-radio h-4 w-4 text-pink-500 focus:ring-pink-500"},null,512),[[lt,I.value.status]]),wn]),e("label",xn,[ce(e("input",{"onUpdate:modelValue":D[7]||(D[7]=G=>I.value.status=G),type:"radio",value:"inactive",class:"form-radio h-4 w-4 text-pink-500 focus:ring-pink-500"},null,512),[[lt,I.value.status]]),bn])])]),e("div",_n,[e("button",{onClick:D[8]||(D[8]=G=>R.value=!1),class:"px-4 py-2 border border-gray-300 dark:border-gray-700 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-50 dark:hover:bg-gray-750 transition-all duration-200"}," 取消 "),e("button",{onClick:H,class:"px-4 py-2 bg-pink-500 text-white rounded-md hover:bg-pink-600 transition-all duration-200 flex items-center",disabled:!I.value.name||$.value},[$.value?(i(),c("svg",In,Tn)):z("",!0),Z(" "+J($.value?"创建中...":"创建活动"),1)],8,$n)])])])):z("",!0)]))}}),An={class:"mb-6"},Ln={class:"flex justify-between items-center mb-2"},jn={class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},Nn={class:"text-sm text-gray-500 dark:text-gray-400"},En={key:0},Un={key:0,class:"py-6"},Bn=e("div",{class:"mx-auto h-12 w-12 animate-spin rounded-full border-4 border-gray-300 dark:border-gray-700 border-t-pink-500"},null,-1),Dn=e("p",{class:"mt-2 text-sm text-gray-500 dark:text-gray-400"},"上传中，请稍候...",-1),Fn=[Bn,Dn],Pn={key:1,class:"py-6"},Qn=e("svg",{class:"mx-auto h-12 w-12 text-gray-400 dark:text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})],-1),zn=e("p",{class:"mt-2 text-sm text-gray-500 dark:text-gray-400"},"拖放文件到此处或点击上传",-1),Vn=e("p",{class:"mt-1 text-xs text-gray-400 dark:text-gray-500"},"支持 PNG, JPG, JPEG 格式",-1),Rn=[Qn,zn,Vn],On={key:1,class:"py-6"},qn=e("svg",{class:"mx-auto h-12 w-12 text-gray-400 dark:text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),Hn=e("p",{class:"mt-2 text-sm text-gray-500 dark:text-gray-400"},"已达到最大上传数量",-1),Gn=e("p",{class:"mt-1 text-xs text-gray-400 dark:text-gray-500"},"请删除部分图片后继续上传",-1),Wn=[qn,Hn,Gn],Jn={key:2,class:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-2 my-2"},Kn=["src"],Zn={key:1,class:"w-full h-full flex items-center justify-center"},Xn=e("svg",{class:"h-8 w-8 text-gray-400 dark:text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),Yn=[Xn],el={key:2,class:"absolute inset-0 flex items-center justify-center bg-white bg-opacity-80 dark:bg-gray-900 dark:bg-opacity-80"},tl=e("div",{class:"h-8 w-8 animate-spin rounded-full border-4 border-gray-300 dark:border-gray-700 border-t-pink-500"},null,-1),ol=[tl],sl={key:3,class:"absolute top-1 left-1 bg-green-500 text-white text-xs px-1.5 py-0.5 rounded z-10"},rl={key:4,class:"absolute inset-0 flex items-center justify-center bg-white bg-opacity-80 dark:bg-gray-900 dark:bg-opacity-80"},al={class:"text-center"},nl=e("svg",{class:"mx-auto h-8 w-8 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),ll={class:"mt-1 text-xs text-red-500"},il=["onClick"],cl=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),dl=[cl],ul={class:"absolute inset-x-0 bottom-0 bg-black bg-opacity-60 text-white p-1 text-xs opacity-0 group-hover:opacity-100 transition-opacity"},gl=["src"],vl=e("div",{class:"absolute top-1 left-1 flex flex-col gap-1"},[e("div",{class:"bg-pink-500 text-white text-xs px-1.5 py-0.5 rounded"}," 素材库 ")],-1),hl={class:"absolute inset-x-0 bottom-0 bg-black bg-opacity-60 text-white p-1 text-xs opacity-0 group-hover:opacity-100 transition-opacity truncate"},pl=["onClick"],fl=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),ml=[fl],yl={class:"flex justify-center mt-4 space-x-2"},kl=["disabled"],wl=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})],-1),xl=["disabled","title"],bl=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})],-1),_l={key:0,class:"mt-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-md border border-blue-200 dark:border-blue-800/50"},$l={class:"flex items-center text-blue-600 dark:text-blue-300 mb-2"},Il=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})],-1),Cl={class:"font-medium"},Sl={key:0,class:"ml-2 text-xs bg-pink-500 text-white px-2 py-0.5 rounded-full"},Tl={class:"mt-2 flex flex-wrap gap-2"},Ml=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})],-1),Al=["title"],Ll=["onClick"],jl=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),Nl=[jl],El={key:0,class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},Ul=e("span",{class:"italic"},'提示：选择"全部文件夹"将获取该用户下的所有素材，不限于特定文件夹',-1),Bl=[Ul],Dl=de({__name:"FileUploader",props:{productForm:{},uploadedFiles:{},maxFileCount:{},selectedMaterialFolders:{},selectedFolderNames:{},materialNames:{},materials:{},folderIds:{},folderNames:{}},emits:["update:uploadedFiles","update:productForm","showStatusMessage","openMaterialLibrary","update:selectedMaterialFolders","update:selectedFolderNames","update:folderIds","update:folderNames","update:materialNames"],setup(o,{emit:a}){const t=o,s=a,r=re(()=>t.uploadedFiles.length),h=t.maxFileCount||20,x=_({});re(()=>sessionStorage.getItem("materialLibraryMaterialSelection")==="true"),re(()=>sessionStorage.getItem("materialLibraryFolderSelection")==="true");const p=re(()=>{if(!t.selectedMaterialFolders)return[];const S=sessionStorage.getItem("materialSelectionInfo");if(S)try{const j=JSON.parse(S);if(j&&j.materials&&Array.isArray(j.materials))return j.materials}catch(j){console.error("解析素材选择信息失败:",j)}return sessionStorage.getItem("materialLibraryMaterialSelection")==="true"?t.selectedMaterialFolders.filter(j=>!t.folderIds||!t.folderIds.includes(j)):[]}),$=re(()=>{if(sessionStorage.getItem("materialLibraryFolderSelection")!=="true")return[];const S=sessionStorage.getItem("materialSelectionInfo");if(S)try{const j=JSON.parse(S);if(j&&j.folders&&Array.isArray(j.folders)&&j.folders.length>0&&j.folders.every(C=>typeof C=="string"||typeof C=="number"))return j.folders}catch(j){console.error("解析文件夹选择信息失败:",j)}return t.folderIds&&Array.isArray(t.folderIds)&&t.folderIds.length>0?t.folderIds:[]}),R=re(()=>{const S=Array.isArray(I.value)&&I.value.includes("1"),j=$.value.includes("1");return S||j});re(()=>{const S={};if(S[1]="全部文件夹",t.folderIds&&Array.isArray(t.folderIds)&&t.folderNames&&Array.isArray(t.folderNames)&&t.folderIds.forEach((j,C)=>{if(C<t.folderNames.length){const T=t.folderNames[C];T&&T.trim()&&j!=="1"&&(S[j]=T)}}),sessionStorage.getItem("materialLibraryFolderSelection")==="true"){const j=sessionStorage.getItem("materialSelectionInfo");if(j)try{const C=JSON.parse(j);C&&C.folders&&C.folders.length>0&&(C.folderNames&&typeof C.folderNames=="object"?Object.entries(C.folderNames).forEach(([T,L])=>{L&&typeof L=="string"&&T!=="1"&&(S[T]=L)}):C.folders.forEach((T,L)=>{S[T]||T!=="1"&&(S[T]=`文件夹 ${L+1}`)}))}catch(C){console.error("解析文件夹选择信息失败:",C)}}return console.log("folderNamesMap结果:",S),S});const I=_(t.folderIds&&t.folderIds.length>0?[...t.folderIds]:[]),P=_(t.folderNames&&t.folderNames.length>0?[...t.folderNames]:[]),m=re(()=>{console.log("检查是否有选择文件夹:");const S=Array.isArray(I.value)&&I.value.length>0;console.log("本地文件夹IDs:",S?I.value:"无");const j=sessionStorage.getItem("materialLibraryFolderSelection")==="true";return console.log("文件夹选择标记:",j),S&&j});async function N(){var S;if(!(!t.selectedMaterialFolders||t.selectedMaterialFolders.length===0))try{const j=await Bo();console.log("getMaterials返回数据:",j);let C=[];(S=j==null?void 0:j.data)!=null&&S.data&&Array.isArray(j.data.data)?C=j.data.data:j!=null&&j.data&&Array.isArray(j.data)?C=j.data:Array.isArray(j)&&(C=j),C.length>0&&(C.forEach(T=>{T.id&&(x.value[T.id]=T)}),console.log("加载了素材数据, 缓存数量:",Object.keys(x.value).length))}catch(j){console.error("无法加载素材数据:",j)}}function Y(S,j){if(console.log("getMaterialPreviewUrl - 参数:",S,j),S&&(S.startsWith("http://")||S.startsWith("https://")))return S;if(S&&x.value[S]){const C=x.value[S];if(C.previewUrl)return console.log("从缓存找到素材预览URL:",C.previewUrl),C.previewUrl;if(C.fileId)return console.log("使用素材fileId作为预览URL:",C.fileId),C.fileId}if(t.materials&&t.materials.length>0){const C=t.materials.find(T=>T.id===S);if(C&&C.previewUrl)return C.previewUrl}if(Object.keys(x.value).length||setTimeout(()=>{N().then(()=>{console.log("延迟加载素材数据完成，缓存数量:",Object.keys(x.value).length)})},0),S&&t.selectedFolderNames&&t.selectedFolderNames.length>j&&t.selectedFolderNames[j]){const T=Date.now(),L=S.substring(0,4);return`http://127.0.0.1:9520/file/material/${T}_${L}.jpeg`}return console.warn("无法获取素材预览URL，使用随机图片替代",S),`https://picsum.photos/seed/${S||"material"+j}/300/300`}const H=_(!1),q=_(null),w="xhs-file-input-"+Date.now(),b=_(!1),D=_(!0),G=async()=>{if(!D.value){je.warning("素材库功能不可用，请升级套餐");return}s("openMaterialLibrary")};Te(()=>{N(),console.log("组件挂载，检查选择信息"),console.log("materialLibraryFolderSelection:",sessionStorage.getItem("materialLibraryFolderSelection")),console.log("materialSelectionInfo:",sessionStorage.getItem("materialSelectionInfo")),t.folderIds&&t.folderIds.length>0?(console.log("挂载时初始化本地文件夹IDs:",t.folderIds),I.value=[...t.folderIds]):(console.log("挂载时无文件夹IDs"),I.value=[]),t.folderNames&&t.folderNames.length>0?(console.log("挂载时初始化本地文件夹Names:",t.folderNames),P.value=[...t.folderNames]):(console.log("挂载时无文件夹Names"),P.value=[]),ne()}),fe(()=>t.folderIds,S=>{S&&S.length>0?(console.log("接收到新的文件夹IDs:",S),I.value=[...S]):(console.log("清空本地文件夹IDs"),I.value=[])},{deep:!0}),fe(()=>t.folderNames,S=>{S&&S.length>0?(console.log("接收到新的文件夹Names:",S),P.value=[...S]):(console.log("清空本地文件夹Names"),P.value=[])},{deep:!0}),fe(()=>t.selectedMaterialFolders,()=>{N()},{deep:!0});async function K(S){const C=S.target.files;if(b.value=!1,!C||C.length===0)return;const T=r.value,L=h-T;C.length>L&&s("showStatusMessage",`最多只能上传${h}个文件，当前还可上传${L}个`,"error");const X=Array.from(C).slice(0,L);if(X.length===0)return;H.value=!0;const u=[...t.uploadedFiles],y=[...t.productForm.materials];for(const l of X){const n=qr("file"),v=new FileReader,f={id:n,fileId:"",name:l.name,size:l.size,type:l.type,previewUrl:"",status:"uploading"};u.push(f),s("update:uploadedFiles",u),v.onload=U=>{var O;const V=u.findIndex(A=>A.id===n);V!==-1&&(u[V].previewUrl=(O=U.target)==null?void 0:O.result,s("update:uploadedFiles",u))},v.readAsDataURL(l);try{const U=await Xr(l),V=u.findIndex(O=>O.id===f.id);if(V!==-1){u[V].fileId=U,u[V].status="success",s("update:uploadedFiles",u),y.push(U);const O={...t.productForm,materials:y};s("update:productForm",O)}}catch(U){console.error(`上传文件 ${l.name} 失败:`,U);const V=u.findIndex(O=>O.id===f.id);V!==-1&&(u[V].status="error",u[V].error=U.message||"上传失败",s("update:uploadedFiles",u))}}H.value=!1,q.value&&(q.value.value="")}function Q(S){const j=t.uploadedFiles.findIndex(C=>C.id===S);if(j!==-1){const C=t.uploadedFiles[j].fileId,T=[...t.uploadedFiles];if(T.splice(j,1),s("update:uploadedFiles",T),C){const L=t.productForm.materials.indexOf(C);if(L!==-1){const X=[...t.productForm.materials];X.splice(L,1);const u={...t.productForm,materials:X};s("update:productForm",u)}}}}function E(S){if(b.value)return;b.value=!0,S==null||S.preventDefault(),S==null||S.stopPropagation();let j=q.value;j||(j=document.getElementById(w)),j||(j=document.createElement("input"),j.type="file",j.multiple=!0,j.accept="image/*",j.style.display="none",j.onchange=C=>{K(C),b.value=!1},document.body.appendChild(j),setTimeout(()=>{j&&document.body.contains(j)&&document.body.removeChild(j),b.value=!1},5e3)),j?st(()=>{j.click(),window.addEventListener("focus",function C(){setTimeout(()=>{b.value=!1,window.removeEventListener("focus",C)},300)},{once:!0})}):(s("showStatusMessage","无法打开文件选择器，请刷新页面后重试","error"),b.value=!1)}function ee(S){if(console.log("removeFolder 被调用，索引:",S),S>=0&&S<I.value.length){const j=I.value[S];console.log("将要删除的文件夹ID:",j);const C=P.value[S]||`文件夹 ${S+1}`;console.log("将要删除的文件夹名称:",C);const T=[...I.value];T.splice(S,1);const L=[...P.value];L.length>S&&L.splice(S,1),console.log("更新后的文件夹IDs:",T),console.log("更新后的文件夹名称:",L),I.value=T,P.value=L,s("update:folderIds",T),s("update:folderNames",L);try{console.log("开始全面同步更新素材库选择状态");const X=window.sessionStorage.getItem("materialSelectionInfo");if(console.log("当前的materialSelectionInfo:",X),X){let u;try{u=JSON.parse(X)}catch(l){console.error("解析materialSelectionInfo失败，创建新对象",l),u={folders:[],materials:[],folderNames:{}}}let y=!1;if(u&&u.folders){console.log("原始选择的文件夹:",u.folders);const l=u.folders.length;u.folders=u.folders.filter(n=>n!==j),l!==u.folders.length&&(y=!0),console.log("更新后选择的文件夹:",u.folders),u.folderNames&&u.folderNames[j]&&(delete u.folderNames[j],y=!0)}y?(console.log("选择状态有变化，更新会话存储"),window.sessionStorage.setItem("materialSelectionInfo",JSON.stringify(u)),!u.folders||u.folders.length===0?(console.log("文件夹列表为空，移除materialLibraryFolderSelection标记"),window.sessionStorage.removeItem("materialLibraryFolderSelection"),u.materials&&u.materials.length>0?(console.log("只有素材被选择，设置materialLibrarySelectionType为materials"),window.sessionStorage.setItem("materialLibrarySelectionType","materials"),window.sessionStorage.setItem("materialLibraryMaterialSelection","true")):(console.log("没有任何选择，清除所有标记"),window.sessionStorage.removeItem("materialLibrarySelectionType"),window.sessionStorage.removeItem("materialLibraryMaterialSelection"),window.sessionStorage.removeItem("materialSelectionInfo"))):(console.log("仍有文件夹被选择，维持materialLibraryFolderSelection标记"),window.sessionStorage.setItem("materialLibraryFolderSelection","true"),u.materials&&u.materials.length>0?(console.log("文件夹和素材都被选择，设置materialLibrarySelectionType为both"),window.sessionStorage.setItem("materialLibrarySelectionType","both"),window.sessionStorage.setItem("materialLibraryMaterialSelection","true")):(console.log("只有文件夹被选择，设置materialLibrarySelectionType为folders"),window.sessionStorage.setItem("materialLibrarySelectionType","folders"),window.sessionStorage.removeItem("materialLibraryMaterialSelection")))):console.log("选择状态未变化，无需更新")}else console.log("没有找到materialSelectionInfo，清除所有相关标记"),window.sessionStorage.removeItem("materialLibrarySelectionType"),window.sessionStorage.removeItem("materialLibraryFolderSelection"),window.sessionStorage.removeItem("materialLibraryMaterialSelection")}catch(X){console.error("更新文件夹选择信息失败:",X)}s("showStatusMessage",`已移除文件夹: ${C}`,"info")}else console.error("无效的文件夹索引:",S,"当前文件夹数量:",I.value.length)}async function ne(){D.value=await Kr("xhs_materials")}return(S,j)=>(i(),c("div",An,[e("div",Ln,[e("label",jn," 素材上传 (最多 "+J(te(h))+" 张) ",1),e("div",null,[e("span",Nn,J(r.value)+"/"+J(te(h)),1)])]),e("div",{class:se(["border-2 border-dashed border-gray-300 dark:border-gray-700 rounded-lg p-4 text-center hover:border-gray-400 dark:hover:border-gray-600 transition-colors",{"cursor-pointer":r.value<te(h),"bg-gray-50 dark:bg-gray-900/20":r.value<te(h)}]),onClick:j[1]||(j[1]=C=>r.value<te(h)?E(C):null)},[e("input",{id:w,ref_key:"fileInputRef",ref:q,type:"file",multiple:"",accept:"image/*",class:"hidden",onChange:K},null,544),r.value===0&&(!t.selectedMaterialFolders||t.selectedMaterialFolders.length===0)&&I.value.length===0?(i(),c("div",En,[H.value?(i(),c("div",Un,Fn)):(i(),c("div",Pn,Rn))])):r.value>=te(h)?(i(),c("div",On,Wn)):(i(),c("div",Jn,[(i(!0),c(ue,null,xe(S.uploadedFiles,C=>(i(),c("div",{key:C.id,class:"relative group aspect-square bg-gray-100 dark:bg-gray-800 rounded-lg overflow-hidden shadow-sm"},[C.previewUrl?(i(),c("img",{key:0,src:C.previewUrl,class:se(["w-full h-full object-cover",{"opacity-50":C.status==="error"}]),alt:"预览图"},null,10,Kn)):(i(),c("div",Zn,Yn)),C.status==="uploading"?(i(),c("div",el,ol)):z("",!0),C.status==="success"?(i(),c("div",sl," 已上传 ")):z("",!0),C.status==="error"?(i(),c("div",rl,[e("div",al,[nl,e("p",ll,J(C.error||"上传失败"),1)])])):z("",!0),e("button",{onClick:ge(T=>Q(C.id),["stop"]),class:"absolute top-1 right-1 p-1 bg-red-500 hover:bg-red-600 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity",title:"删除文件"},dl,8,il),e("div",ul,J(C.name),1)]))),128)),(i(!0),c(ue,null,xe(p.value,(C,T)=>(i(),c("div",{key:`material-${C}-${T}`,class:"relative group aspect-square bg-gray-100 dark:bg-gray-800 rounded-lg overflow-hidden shadow-sm"},[e("img",{src:Y(C,T),class:"w-full h-full object-cover",alt:"素材预览"},null,8,gl),vl,e("div",hl,J(t.materialNames&&T<t.materialNames.length?t.materialNames[T]:`素材 ${T+1}`),1),e("button",{onClick:L=>{L.stopPropagation(),L.preventDefault();const X=t.selectedMaterialFolders?t.selectedMaterialFolders.indexOf(C):-1;if(X>=0){const u=[...t.selectedMaterialFolders||[]],y=[...t.materialNames||[]];u.splice(X,1),y.length>X&&y.splice(X,1);let l=[...t.productForm.materials];const n=l.indexOf(C);n!==-1&&(l.splice(n,1),s("update:productForm",{...t.productForm,materials:l})),s("update:selectedMaterialFolders",u),s("update:materialNames",y),s("showStatusMessage","已移除素材","info"),console.log("删除后的素材文件夹:",u),console.log("删除后的素材名称:",y)}},class:"absolute top-1 right-1 p-1 bg-red-500 hover:bg-red-600 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity z-10",title:"删除素材",type:"button"},ml,8,pl)]))),128))])),e("div",yl,[e("button",{type:"button",class:se(["px-3 py-1.5 text-sm bg-pink-500 hover:bg-pink-600 text-white rounded-md flex items-center",{"opacity-50 cursor-not-allowed":r.value>=te(h)||H.value}]),onClick:j[0]||(j[0]=ge(C=>E(C),["stop"])),disabled:r.value>=te(h)||H.value},[wl,Z(" 上传素材 ")],10,kl),e("button",{type:"button",class:se(["px-3 py-1.5 text-sm bg-blue-500 hover:bg-blue-600 text-white rounded-md flex items-center",{"opacity-50 cursor-not-allowed":!D.value}]),onClick:ge(G,["stop"]),disabled:!D.value,title:D.value?"打开素材库":"素材库功能不可用，请升级套餐"},[bl,Z(" 素材库 ")],10,xl),ht(S.$slots,"actions")])],2),m.value&&I.value.length>0?(i(),c("div",_l,[e("div",$l,[Il,e("span",Cl,"已从素材库选择 "+J((I.value||[]).length)+" 个文件夹",1),R.value?(i(),c("span",Sl," 获取所有素材 ")):z("",!0)]),e("div",Tl,[(i(!0),c(ue,null,xe(I.value,(C,T)=>(i(),c("div",{key:`folder-${C}`,class:se(["inline-flex items-center px-3 py-1 rounded-full text-sm group relative",[C==="1"?"bg-pink-100 dark:bg-pink-800 text-pink-800 dark:text-pink-200":"bg-blue-100 dark:bg-blue-800 text-blue-800 dark:text-blue-200"]])},[Ml,e("span",{class:"truncate",title:C==="1"?"全部文件夹 (所有素材)":P.value[T]||`文件夹 ${T+1}`},J(C==="1"?"全部文件夹":P.value[T]||`文件夹 ${T+1}`),9,Al),e("button",{onClick:L=>ee(T),class:se(["ml-1 p-0.5 rounded-full transition-colors",C==="1"?"hover:bg-pink-200 dark:hover:bg-pink-700":"hover:bg-blue-200 dark:hover:bg-blue-700"]),title:"移除文件夹"},Nl,10,Ll)],2))),128))]),R.value?(i(),c("div",El,Bl)):z("",!0)])):z("",!0)]))}}),Fl={class:"mb-6"},Pl=e("label",{class:"block text-gray-700 dark:text-gray-300 mb-2 font-medium"}," 批量生成设置 ",-1),Ql={class:"flex items-center"},zl=e("span",{class:"text-sm text-gray-600 dark:text-gray-400 mr-2"},"生成数量:",-1),Vl=e("span",{class:"ml-2 text-xs text-gray-500 dark:text-gray-400 flex items-center"},[e("svg",{class:"h-3 w-3 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]),Z(" 设置批量生成文章的数量 ")],-1),Rl=de({__name:"BatchSettings",props:{modelValue:{}},emits:["update:modelValue"],setup(o,{emit:a}){const t=o,s=a,r=re({get:()=>t.modelValue,set:h=>s("update:modelValue",h)});return(h,x)=>(i(),c("div",Fl,[Pl,e("div",Ql,[zl,ce(e("input",{"onUpdate:modelValue":x[0]||(x[0]=p=>r.value=p),type:"number",min:"1",max:"10",class:"px-3 py-2 rounded-md border border-gray-300 dark:border-gray-700 dark:bg-gray-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-pink-500 transition-all duration-200 w-24"},null,512),[[we,r.value]]),Vl])]))}}),Ol={class:"task-item p-3 transition-all duration-200 hover:bg-gray-50 dark:hover:bg-gray-800/50"},ql={class:"flex flex-col sm:flex-row sm:justify-between sm:items-center"},Hl={class:"flex items-center flex-grow mb-2 sm:mb-0"},Gl={class:"text-sm text-gray-600 dark:text-gray-400 mr-2 flex-shrink"},Wl={class:"task-actions flex flex-wrap gap-2"},Jl=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"})],-1),Kl=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1),Zl=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),Xl={class:"text-sm font-medium text-red-500 truncate max-w-full sm:max-w-xs"},Do=de({__name:"TaskItem",props:{task:{},isBatchTask:{type:Boolean},activities:{}},emits:["refresh","viewQrCode","viewNoteDetail","viewActivity","viewActivityQrCode","editNote","retryTask"],setup(o,{emit:a}){const t=o,s=a,r=I=>{switch(I){case"pending":return"bg-yellow-400 dark:bg-yellow-600";case"running":return"bg-blue-500 dark:bg-blue-600";case"completed":return"bg-green-500 dark:bg-green-600";case"failed":return"bg-red-500 dark:bg-red-600";default:return"bg-gray-500 dark:bg-gray-600"}},h=I=>{switch(I){case"pending":return"等待处理";case"running":return"处理中";case"completed":return"已完成";case"failed":return"失败";default:return"未知"}};function x(){s("refresh",t.task.id)}function p(){s("viewQrCode",t.task)}function $(){s("viewNoteDetail",t.task)}function R(){s("retryTask",t.task)}return(I,P)=>(i(),c("div",Ol,[e("div",ql,[e("div",Hl,[e("p",Gl,J(I.task.title),1),e("span",{class:se([r(I.task.status),"text-white text-xs px-2 py-0.5 rounded-full whitespace-nowrap ml-2"])},J(h(I.task.status)),3)]),e("div",Wl,[I.task.status==="pending"||I.task.status==="running"?(i(),c("button",{key:0,onClick:x,class:"text-sm font-medium px-3 py-1 bg-gray-200 dark:bg-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600"}," 刷新 ")):z("",!0),I.task.status==="completed"?(i(),c(ue,{key:1},[e("button",{onClick:p,class:"text-sm font-medium px-3 py-1 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-all duration-200 flex items-center"},[Jl,Z(" 二维码 ")]),I.task.result?(i(),c("button",{key:0,onClick:$,class:"text-sm font-medium px-3 py-1 bg-green-500 text-white rounded-md hover:bg-green-600 transition-all duration-200 flex items-center",title:"查看笔记详情"},[Kl,Z(" 详情 ")])):z("",!0)],64)):I.task.status==="failed"?(i(),c(ue,{key:2},[e("button",{onClick:R,class:"text-sm font-medium px-3 py-1 bg-orange-500 text-white rounded-md hover:bg-orange-600 transition-all duration-200 flex items-center",title:"重试任务"},[Zl,Z(" 重试 ")]),e("p",Xl,J(te(Hr)(I.task.error||"处理失败")),1)],64)):z("",!0)])])]))}}),Yl={class:"batch-group border border-purple-200 dark:border-purple-800 rounded-lg overflow-hidden mb-4"},ei={class:"flex items-center mb-2 sm:mb-0"},ti=e("path",{"fill-rule":"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z","clip-rule":"evenodd"},null,-1),oi=[ti],si={class:"font-bold text-purple-800 dark:text-purple-200"},ri={class:"flex items-center"},ai={key:0,class:"text-sm text-gray-600 dark:text-gray-400 truncate max-w-xs sm:max-w-md"},ni={class:"flex flex-wrap gap-2 items-center"},li={class:"mr-2"},ii={class:"flex items-center text-xs"},ci={class:"text-green-600 dark:text-green-400 font-medium mr-1"},di=e("span",{class:"text-gray-500 dark:text-gray-400"},"/",-1),ui={class:"text-gray-600 dark:text-gray-400 ml-1"},gi=e("span",{class:"ml-1 text-gray-500 dark:text-gray-400"},"完成",-1),vi={class:"w-20 sm:w-24 bg-gray-200 dark:bg-gray-700 rounded-full h-1.5 mt-1"},hi=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})],-1),pi={key:0,class:"batch-content divide-y divide-gray-100 dark:divide-gray-800"},fi=de({__name:"TaskBatchGroup",props:{batchId:{},tasks:{},activities:{}},emits:["refresh","viewQrCode","viewNoteDetail","viewActivity","viewActivityQrCode","editNote","retryTask"],setup(o,{emit:a}){const t=o,s=a,r=_({});function h(){r.value[t.batchId]?r.value[t.batchId]=!r.value[t.batchId]:r.value[t.batchId]=!0}function x(){return Gr(r.value,t.batchId)}function p(){return Wr(t.tasks,t.batchId)}function $(){switch(p()){case"pending":return"bg-yellow-400 dark:bg-yellow-600";case"running":return"bg-blue-500 dark:bg-blue-600";case"completed":return"bg-green-500 dark:bg-green-600";case"failed":return"bg-red-500 dark:bg-red-600";case"mixed":return"bg-purple-500 dark:bg-purple-600";default:return"bg-gray-500 dark:bg-gray-600"}}function R(){switch(p()){case"pending":return"等待处理";case"running":return"处理中";case"completed":return"已完成";case"failed":return"失败";case"mixed":return"部分完成";default:return"未知"}}function I(b){s("refresh",b)}function P(b){console.log("批次组内 - 查看二维码:",b),s("viewQrCode",b)}function m(b){s("viewNoteDetail",b)}function N(b){console.log("批次组内 - 编辑笔记:",b),b.noteId?s("editNote",{...b,id:b.noteId}):console.error("无法编辑笔记：缺少noteId")}function Y(b){s("viewActivity",b)}function H(b,D){console.log("批次组内 - 查看活动二维码:",b),D&&D.stopPropagation(),s("viewActivityQrCode",b,D)}function q(b){if(!b||!t.activities||t.activities.length===0)return"";const D=t.activities.find(G=>G.id===b);return D?D.name:""}function w(b){console.log("批次组内 - 重试任务:",b),s("retryTask",b)}return(b,D)=>(i(),c("div",Yl,[e("div",{onClick:h,class:"batch-header flex flex-col sm:flex-row sm:justify-between sm:items-center p-4 bg-purple-50 dark:bg-purple-900/30 cursor-pointer hover:bg-purple-100 dark:hover:bg-purple-800/40 transition-colors"},[e("div",ei,[(i(),c("svg",{xmlns:"http://www.w3.org/2000/svg",class:se([{"transform rotate-90":!x()},"h-5 w-5 mr-2 text-purple-600 dark:text-purple-400 transition-transform duration-200"]),viewBox:"0 0 20 20",fill:"currentColor"},oi,2)),e("div",null,[e("h3",si,J(b.tasks[0].brandProduct),1),e("div",ri,[b.tasks[0].activityId&&q(b.tasks[0].activityId)?(i(),c("p",ai," 活动名称: "+J(q(b.tasks[0].activityId)),1)):z("",!0)])])]),e("div",ni,[e("div",li,[e("div",ii,[e("span",ci,J(te(it)(b.tasks).completed),1),di,e("span",ui,J(te(it)(b.tasks).total),1),gi]),e("div",vi,[e("div",{class:"bg-green-500 h-1.5 rounded-full",style:pt({width:`${te(it)(b.tasks).completed/te(it)(b.tasks).total*100}%`})},null,4)])]),e("span",{class:se([$(),"text-white text-xs px-2 py-1 rounded-full"])},J(R()),3),b.tasks[0].activityId?(i(),c("button",{key:0,onClick:D[0]||(D[0]=ge(G=>Y(b.tasks[0].activityId),["stop"])),class:"text-sm font-medium px-3 py-1.5 bg-purple-500 text-white rounded-md hover:bg-purple-600 transition-all duration-200 flex items-center"},[hi,Z(" 活动 ")])):z("",!0),b.tasks[0].activityId?(i(),c("button",{key:1,onClick:D[1]||(D[1]=ge(G=>H(b.tasks[0].activityId,G),["stop"])),class:"text-sm font-medium px-3 py-1.5 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-all duration-200 flex items-center",title:"查看活动笔记二维码"},[ke(te(ys),{theme:"outline",size:"18",class:"mr-1.5"}),Z(" 活动码 ")])):z("",!0)])]),x()?z("",!0):(i(),c("div",pi,[(i(!0),c(ue,null,xe(b.tasks,G=>(i(),Me(Do,{key:G.id,task:G,"is-batch-task":!0,activities:b.activities,onRefresh:I,onViewQrCode:P,onViewNoteDetail:m,onViewActivity:Y,onViewActivityQrCode:H,onEditNote:N,onRetryTask:w},null,8,["task","activities"]))),128))]))]))}}),mi={class:"task-list mt-8"},yi={class:"flex justify-between items-center mb-4"},ki=e("h2",{class:"text-xl font-bold text-gray-800 dark:text-gray-200 flex items-center"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 mr-2 text-pink-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})]),Z(" 生成任务列表 ")],-1),wi=["disabled"],xi=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),bi={key:0,class:"flex justify-center items-center py-8"},_i=e("div",{class:"flex flex-col items-center"},[e("div",{class:"h-10 w-10 border-4 border-t-pink-500 rounded-full animate-spin mb-4"}),e("p",{class:"text-gray-600 dark:text-gray-400"},"加载任务中...")],-1),$i=[_i],Ii={key:1,class:"bg-white dark:bg-gray-800 rounded-lg p-6 text-center shadow-sm border border-gray-200 dark:border-gray-700"},Ci=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-12 w-12 mx-auto text-gray-400 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})],-1),Si=e("p",{class:"text-gray-600 dark:text-gray-400 mb-4"},"暂无生成任务",-1),Ti=e("p",{class:"text-gray-500 dark:text-gray-500 text-sm"},'填写表单并点击"生成笔记"按钮开始创建笔记',-1),Mi=[Ci,Si,Ti],Ai={key:2,class:"space-y-4"},Li=de({__name:"TaskList",props:{tasks:{},activities:{},loadingTasks:{type:Boolean},autoRefreshEnabled:{type:Boolean}},emits:["refresh","refreshAll","viewQrCode","viewNoteDetail","viewActivity","viewActivityQrCode","error","editNote","retryTask"],setup(o,{expose:a,emit:t}){const s=o,r=t;re(()=>Jr(s.tasks));const h=_([]),x=_(!1),p=_(null),$=_([]),R=re(()=>{const Q={},E={};for(const ee of h.value)if(ee.batchId)E[ee.batchId]||(E[ee.batchId]=[]),E[ee.batchId].push(ee);else{const ne=`task_${ee.id}`;Q[ne]={brandProduct:ee.brandProduct,createTime:ee.createTime,tasks:[ee]}}for(const ee in E)if(E[ee].length>0){const ne=E[ee],S=ne[0],j=`batch_${ee}`;Q[j]={brandProduct:S.brandProduct,createTime:S.createTime,tasks:ne.sort((C,T)=>(C.batchIndex||0)-(T.batchIndex||0))}}return Object.values(Q).sort((ee,ne)=>new Date(ne.createTime).getTime()-new Date(ee.createTime).getTime())});async function I(){try{x.value=!0,console.log("开始获取任务列表...");const Q=await Is();console.log(`获取到 ${Q.length} 个任务`,Q);const E=new Map;for(const ee of Q)E.has(ee.id)||E.set(ee.id,ee);h.value=Array.from(E.values()),console.log(`去重后剩余 ${h.value.length} 个任务`),P()}catch(Q){console.error("获取任务列表失败:",Q),r("error",Q.message||"获取任务列表失败")}finally{x.value=!1}}function P(){$.value=h.value.filter(Q=>Q.status==="pending"||Q.status==="running").map(Q=>Q.id),console.log(`检测到 ${$.value.length} 个待处理任务`),$.value.length>0&&s.autoRefreshEnabled?m():$.value.length===0&&N()}function m(){N(),console.log("启动自动刷新定时器, 间隔5秒"),p.value=setInterval(async()=>{var Q;if($.value.length===0){N();return}console.log(`自动刷新: 更新 ${$.value.length} 个任务状态`);try{const E=await Cs($.value);console.log("获取到任务结果:",E);let ee=!1,ne=[];E&&E.results&&Array.isArray(E.results)?ne=E.results:E&&E.data&&E.data.results&&Array.isArray(E.data.results)?ne=E.data.results:Array.isArray(E)?ne=E:E&&E.data&&Array.isArray(E.data)&&(ne=E.data),console.log(`处理 ${ne.length} 个任务状态更新`);for(const S of ne){if(!S||!S.id){console.warn("收到无效的任务结果项:",S);continue}const j=h.value.findIndex(C=>C.id===S.id);if(j!==-1){console.log(`找到任务 ${S.id}，当前状态: ${h.value[j].status}, 新状态: ${S.status}`);const C=h.value[j].status,T={...h.value[j]};if(S.status&&["pending","running","completed","failed"].includes(S.status)&&(T.status=S.status),S.noteId)T.noteId=S.noteId;else if(S.data&&typeof S.data=="string"&&S.data.includes("id="))try{const L=(Q=S.data.split("id=")[1])==null?void 0:Q.split("&")[0];L&&(T.noteId=L)}catch(L){console.warn("从URL提取noteId失败:",L)}S.data&&(T.result={qrCode:S.data}),S.status==="failed"&&S.message&&(T.error=S.message),h.value[j]=T,C!==T.status&&(console.log(`任务 ${S.id} 状态已更新: ${C} -> ${T.status}`),ee=!0)}else console.warn(`找不到匹配的任务: ${S.id}`)}ee?(console.log("检测到任务状态变更，重新检查待处理任务"),P()):console.log("没有检测到任务状态变更")}catch(E){console.error("自动刷新任务状态失败:",E);try{console.log("尝试完整刷新任务列表"),await I()}catch(ee){console.error("完整刷新任务列表失败:",ee)}}},5e3)}function N(){p.value&&(console.log("停止自动刷新定时器"),clearInterval(p.value),p.value=null)}function Y(){I()}function H(Q){r("refresh",Q)}function q(Q){console.log("查看二维码, 任务:",Q),r("viewQrCode",Q)}function w(Q){r("viewNoteDetail",Q)}function b(Q){console.log("编辑笔记, 任务:",Q),r("editNote",Q)}function D(Q){r("viewActivity",Q)}function G(Q,E){console.log("查看活动二维码, 活动ID:",Q),r("viewActivityQrCode",Q,E)}function K(Q){console.log("TaskList - 重试任务:",Q),r("retryTask",Q)}return Te(()=>{I()}),uo(()=>{N()}),fe(()=>s.autoRefreshEnabled,Q=>{Q&&$.value.length>0?m():N()}),a({refreshTasks:Y,tasks:h}),(Q,E)=>(i(),c("div",mi,[e("div",yi,[ki,e("button",{onClick:Y,class:"px-3 py-1 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600 transition-all duration-200 flex items-center text-sm",disabled:x.value},[xi,Z(" 刷新 ")],8,wi)]),x.value?(i(),c("div",bi,$i)):h.value.length===0?(i(),c("div",Ii,Mi)):(i(),c("div",Ai,[(i(!0),c(ue,null,xe(R.value,(ee,ne)=>(i(),c("div",{key:`group-${ne}`,class:"task-group bg-white dark:bg-gray-800 rounded-lg overflow-hidden shadow-sm border border-gray-200 dark:border-gray-700"},[ee.tasks.length>1&&ee.tasks[0].batchId?(i(),Me(fi,{key:0,batchId:ee.tasks[0].batchId,tasks:ee.tasks,activities:Q.activities,onRefresh:H,onViewQrCode:q,onViewNoteDetail:w,onViewActivity:D,onViewActivityQrCode:G,onEditNote:b,onRetryTask:K},null,8,["batchId","tasks","activities"])):ee.tasks.length===1?(i(),Me(Do,{key:1,task:ee.tasks[0],activities:Q.activities,onRefresh:H,onViewQrCode:q,onViewNoteDetail:w,onViewActivity:D,onViewActivityQrCode:G,onEditNote:b,onRetryTask:K},null,8,["task","activities"])):z("",!0)]))),128))]))]))}}),ji={class:"mr-3 flex-shrink-0"},Ni={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-green-500 dark:text-green-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Ei=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1),Ui=[Ei],Bi={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-red-500 dark:text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Di=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1),Fi=[Di],Pi={key:2,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-blue-500 dark:text-blue-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Qi=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1),zi=[Qi],Vi={class:"flex-1 text-sm"},Ri=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),Oi=[Ri],qi=de({__name:"StatusNotification",props:{message:{},type:{}},emits:["clear"],setup(o,{emit:a}){const t=o,s=a,r=re(()=>{switch(t.type){case"success":return"bg-green-50 text-green-800 dark:bg-green-900/30 dark:text-green-200";case"error":return"bg-red-50 text-red-800 dark:bg-red-900/30 dark:text-red-200";case"info":return"bg-blue-50 text-blue-800 dark:bg-blue-900/30 dark:text-blue-200";default:return"bg-gray-50 text-gray-800 dark:bg-gray-800 dark:text-gray-200"}});function h(){s("clear")}return(x,p)=>(i(),c("div",null,[x.message?(i(),c("div",{key:0,class:se(["fixed top-4 left-1/2 transform -translate-x-1/2 max-w-md w-full px-4 py-3 rounded-lg shadow-lg z-50 flex items-center",r.value])},[e("div",ji,[x.type==="success"?(i(),c("svg",Ni,Ui)):x.type==="error"?(i(),c("svg",Bi,Fi)):(i(),c("svg",Pi,zi))]),e("div",Vi,J(x.message),1),e("button",{onClick:h,class:"ml-3 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"},Oi)],2)):z("",!0)]))}}),Hi={key:0,class:"fixed inset-0 z-[9999] flex items-center justify-center p-4 bg-black bg-opacity-75 backdrop-blur-sm"},Gi={class:"bg-white dark:bg-gray-800 rounded-xl p-4 sm:p-6 max-w-lg w-full shadow-2xl transform transition-all duration-300 scale-100"},Wi={class:"flex justify-between items-center mb-4"},Ji={class:"text-lg font-bold text-gray-800 dark:text-gray-200 flex items-center"},Ki=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2 text-pink-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"})],-1),Zi={key:0},Xi={key:1},Yi={key:2},ec=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),tc=[ec],oc={class:"flex flex-col items-center"},sc={key:0,class:"w-full flex justify-center space-x-2 mb-4"},rc={key:1,class:"w-full bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-3 mb-4"},ac=Ke('<div class="flex items-start"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-500 mr-2 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg><div><p class="text-sm font-medium text-blue-700 dark:text-blue-300">仅限手机访问</p><p class="text-xs text-blue-600 dark:text-blue-400 mt-1">此分享页面需要在手机端访问，请使用手机扫描二维码或在手机浏览器中打开链接。</p></div></div>',1),nc=[ac],lc={key:2,class:"w-72 h-72 bg-white p-2 rounded-lg shadow-inner flex items-center justify-center relative"},ic={key:0,class:"absolute inset-0 flex items-center justify-center bg-white"},cc=e("div",{class:"h-10 w-10 border-4 border-t-pink-500 rounded-full animate-spin"},null,-1),dc=[cc],uc={key:1,class:"absolute inset-0 flex items-center justify-center bg-white"},gc=e("div",{class:"text-center"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-12 w-12 mx-auto mb-2 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})]),e("p",{class:"text-sm text-gray-600"},"加载失败")],-1),vc=[gc],hc=["src"],pc={key:3,class:"w-full mt-4 bg-gray-50 dark:bg-gray-700 p-3 rounded-lg shadow-inner"},fc={class:"flex flex-col"},mc=Ke('<div class="flex items-center justify-between mb-2"><span class="text-xs font-medium text-gray-600 dark:text-gray-400 flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 015.656 0l4 4a4 4 0 01-5.656 5.656l-1.102-1.101"></path></svg> 分享链接: </span></div>',1),yc={class:"relative"},kc={class:"px-3 py-2 bg-white dark:bg-gray-800 rounded border border-gray-200 dark:border-gray-600 text-xs break-all text-gray-700 dark:text-gray-300 overflow-hidden pr-20"},wc={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},xc=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2"},null,-1),bc=[xc],_c={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},$c=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1),Ic=[$c],Cc={key:4,class:"w-full bg-gray-50 dark:bg-gray-700 p-4 rounded-lg shadow-inner mt-2"},Sc=e("h4",{class:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 text-center flex items-center justify-center"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1 text-yellow-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})]),Z(" 二维码无法加载，请使用直接链接 ")],-1),Tc={class:"flex flex-col"},Mc=Ke('<div class="flex items-center justify-between mb-2"><span class="text-xs font-medium text-gray-600 dark:text-gray-400 flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 015.656 0l4 4a4 4 0 01-5.656 5.656l-1.102-1.101"></path></svg> 分享链接: </span></div>',1),Ac={class:"relative"},Lc={class:"px-3 py-2 bg-white dark:bg-gray-800 rounded border border-gray-200 dark:border-gray-600 text-xs break-all text-gray-700 dark:text-gray-300 overflow-hidden pr-20"},jc={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Nc=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2"},null,-1),Ec=[Nc],Uc={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Bc=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1),Dc=[Bc],Fc={key:5,class:"mt-2 text-sm text-gray-600 dark:text-gray-400 text-center"},Pc=e("span",{class:"font-bold text-pink-600 dark:text-pink-400"},"仅支持手机端访问",-1),Qc={key:6,class:"mt-2 text-sm text-gray-600 dark:text-gray-400 text-center"},zc={key:7,class:"mt-4 text-sm text-gray-600 dark:text-gray-400 text-center"},Vc={class:"mt-4 flex items-center justify-center"},Rc={class:"relative inline-flex items-center cursor-pointer"},Oc=e("div",{class:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-pink-300 dark:peer-focus:ring-pink-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-pink-600"},null,-1),qc=e("span",{class:"ml-3 text-sm font-medium text-gray-700 dark:text-gray-300"},"立即发布",-1),Hc=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1),Gc=e("span",{class:"text-sm"},"保存二维码",-1),Wc=[Hc,Gc],Jc=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})],-1),Kc=e("span",{class:"text-sm"},"打开页面",-1),Zc=[Jc,Kc],Xc=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2"})],-1),Yc=e("span",{class:"text-sm"},"复制链接",-1),ed=[Xc,Yc],td=e("span",{class:"text-sm"},"关闭",-1),od=[td],sd={key:1,class:"fixed inset-0 z-[9999] flex items-center justify-center p-4 bg-black bg-opacity-75 backdrop-blur-sm"},rd={class:"bg-white dark:bg-gray-800 rounded-xl p-6 max-w-4xl w-full h-3/4 shadow-2xl flex flex-col"},ad=e("h3",{class:"text-lg font-bold text-gray-800 dark:text-gray-200 flex items-center"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2 text-pink-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})]),Z(" 笔记详情 ")],-1),nd=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),ld=[nd],id={class:"flex-1 overflow-auto"},cd={key:0,class:"h-full flex items-center justify-center"},dd=e("div",{class:"h-10 w-10 border-4 border-t-pink-500 rounded-full animate-spin"},null,-1),ud=[dd],gd={key:1,class:"h-full flex items-center justify-center"},vd={class:"text-red-500 text-center"},hd=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-12 w-12 mx-auto mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),pd={key:2,class:"divide-y divide-gray-200 dark:divide-gray-700"},fd={class:"pb-4"},md={class:"text-xl font-bold text-gray-800 dark:text-gray-200 mb-2"},yd={class:"flex flex-wrap gap-2 mt-2"},kd=e("span",{class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-pink-100 text-pink-800 dark:bg-pink-900/30 dark:text-pink-300"}," 小红书笔记 ",-1),wd={key:0,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300"},xd={class:"py-4"},bd=e("h4",{class:"text-md font-medium text-gray-700 dark:text-gray-300 mb-2"},"笔记正文",-1),_d={class:"bg-gray-50 dark:bg-gray-800 p-4 rounded-md whitespace-pre-wrap text-gray-700 dark:text-gray-300"},$d={key:0,class:"py-4"},Id=e("h4",{class:"text-md font-medium text-gray-700 dark:text-gray-300 mb-2"},"笔记图片",-1),Cd={class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3"},Sd=["src"],Td={class:"flex justify-end space-x-2 mt-4 pt-4 border-t border-gray-200 dark:border-gray-700"},Md=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})],-1),Ad=de({__name:"ModalDialogs",props:{showQrModal:{type:Boolean},currentQrUrl:{},currentQrTask:{},showNoteDetailModal:{type:Boolean},currentNoteId:{},noteDetailLoading:{type:Boolean},noteDetailError:{}},emits:["close-qr-modal","close-note-detail-modal","view-note-detail","iframe-loaded","iframe-error","error","qr-load-error","change-platform","share-to-xhs"],setup(o,{expose:a,emit:t}){const s=o,r=t;function h(){r("close-qr-modal")}function x(){r("close-note-detail-modal")}function p(){console.error("二维码图片加载失败:",s.currentQrUrl),setTimeout(()=>{var U;const n="https://xhs.aivip1.top/api/html-render/qrcode?data=";if(s.currentQrUrl&&!s.currentQrUrl.startsWith("http")&&(console.error("二维码URL缺少http前缀:",s.currentQrUrl),s.currentQrUrl.includes("/chat#/xhs-auto-api"))){const V=s.currentQrUrl,O=encodeURIComponent(V);r("error","正在修复二维码URL格式");const A=`${n}${O}`;if(console.log("修复后的二维码URL:",A),s.currentQrTask){s.currentQrTask.result=s.currentQrTask.result||{},s.currentQrTask.result.qrCode=A,r("qr-load-error",s.currentQrTask);return}}if(s.currentQrUrl&&s.currentQrUrl.includes("api.qrserver.com"))try{if(s.currentQrUrl.split("data=")[1]&&(r("error","二维码加载失败，正在尝试使用备用服务"),s.currentQrTask)){r("qr-load-error",s.currentQrTask);return}}catch(V){console.error("处理备用二维码服务失败:",V)}const v=typeof window<"u"?window.location.origin:"";let f="";if(s.currentQrTask){if(s.currentQrTask.noteId)f=`${v}/chat#/xhs-auto-api?id=${s.currentQrTask.noteId}`;else if(s.currentQrTask.activityId)f=`${v}/chat#/xhs-auto-api?identifier=${s.currentQrTask.activityId}`;else if((U=s.currentQrTask.id)!=null&&U.startsWith("activity_")){const V=s.currentQrTask.id.replace("activity_","");f=`${v}/chat#/xhs-auto-api?identifier=${V}`}f&&T(f)}},100)}const $=_(!1),R=_(""),I=_(null),P=_(!1),m=_(null);_("");const N=_(!1),Y=_(""),H=_(""),q=_(!1),w=_(!1),b=_(!1),D=_(!0),G=_(!1),K=_(0),Q=_("all"),E=_(!1);Te(()=>{E.value=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),console.log("设备类型检测：",E.value?"移动设备":"电脑设备")});function ee(n){var v,f;if(Q.value=n,s.currentQrTask&&s.currentQrTask.result&&(s.currentQrTask.result.platform=n),s.currentQrTask&&(s.currentQrTask.qrCodeType==="note"?s.currentQrTask.title=n==="all"?"扫码查看笔记":n==="xhs"?"扫码查看小红书笔记":"扫码查看抖音笔记":s.currentQrTask.qrCodeType==="activity"&&(s.currentQrTask.title=n==="all"?"扫码查看活动笔记":n==="xhs"?"扫码查看小红书活动笔记":"扫码查看抖音活动笔记")),s.currentQrTask){const U=typeof window<"u"?window.location.origin:"";let V="";const O=s.currentQrTask.qrCodeType;if(O==="note"&&s.currentQrTask.noteId)V=`${U}/chat#/xhs-auto-api?id=${s.currentQrTask.noteId}`,n!=="all"&&(V+=`&platform=${n}`);else if((O==="activity"||!O&&s.currentQrTask.activityId)&&s.currentQrTask.activityId)V=`${U}/chat#/xhs-auto-api?identifier=${s.currentQrTask.activityId}`,n!=="all"&&(V+=`&platform=${n}`);else if((v=s.currentQrTask.id)!=null&&v.startsWith("activity_")){const A=s.currentQrTask.id.replace("activity_","");V=`${U}/chat#/xhs-auto-api?identifier=${A}`,n!=="all"&&(V+=`&platform=${n}`)}else try{if(s.currentQrUrl&&s.currentQrUrl.includes("data=")){const A=(f=s.currentQrUrl.split("data=")[1])==null?void 0:f.split("&")[0];if(A){const ie=decodeURIComponent(A);if(ie.includes("id=")||ie.includes("identifier=")){let $e=ie.replace(/&platform=[^&]+/,"");n!=="all"&&($e+=`&platform=${n}`),b.value&&!$e.includes("publish=1")&&($e+="&publish=1"),V=$e}}}}catch(A){console.error("解析二维码URL失败:",A)}if(b.value&&!V.includes("publish=1")&&(V+="&publish=1"),V){const A=encodeURIComponent(V);r("error",`二维码已切换到${n==="all"?"全平台":n==="xhs"?"小红书":"抖音"}模式`);const $e=`https://xhs.aivip1.top/api/html-render/qrcode?data=${A}`;s.currentQrTask.result&&(s.currentQrTask.result.qrCode=$e,r("qr-load-error",s.currentQrTask),K.value++,D.value=!0,G.value=!1),r("change-platform",n)}}else r("change-platform",n)}function ne(n,v){I.value=n,R.value=v,$.value=!0}function S(){if(!s.currentQrUrl)return;const n=document.createElement("a");n.href=s.currentQrUrl,n.download=`小红书笔记_${Date.now()}.png`,document.body.appendChild(n),n.click(),document.body.removeChild(n)}async function j(n){P.value=!0,N.value=!0,Y.value="",m.value=null;try{if(n.result)m.value={title:n.title,content:n.result.content||"无内容",noteId:n.result.noteId,images:n.result.images||[],qrCode:n.result.qrCode};else if(n.id){const v=await fo(n.id);if(v)m.value={title:n.title,content:v.content||"无内容",noteId:v.noteId,images:v.images||[],qrCode:v.qrCode};else throw new Error("获取笔记详情失败")}else throw new Error("笔记ID不存在")}catch(v){console.error("获取笔记详情失败:",v),Y.value=v.message||"获取笔记详情失败",r("error",Y.value)}finally{N.value=!1}}function C(){if(!(!m.value||!m.value.noteId))if(m.value.qrCode)I.value&&ne(I.value,m.value.qrCode);else{const n=`https://www.xiaohongshu.com/discovery/item/${m.value.noteId}`;window.open(n,"_blank")}}function T(n){n&&(H.value=n,q.value=!0,I.value&&(I.value.textShareLink=n,I.value.qrLoadFailed=!0))}function L(){var v,f;if(H.value)return H.value;if(s.currentQrTask){const U=typeof window<"u"?window.location.origin:"",V=s.currentQrTask.qrCodeType;if(V==="note"||!V&&s.currentQrTask.noteId&&!(s.currentQrTask.id||"").startsWith("activity_")){let O=`${U}/chat#/xhs-auto-api?id=${s.currentQrTask.noteId}`;return console.log("生成笔记二维码链接（使用id参数）:",O),Q.value==="xhs"?O+="&platform=xhs":Q.value==="douyin"&&(O+="&platform=douyin"),b.value&&(O+="&publish=1"),O}else if(V==="activity"||(v=s.currentQrTask.id)!=null&&v.startsWith("activity_")||!s.currentQrTask.noteId&&s.currentQrTask.activityId){let O=`${U}/chat#/xhs-auto-api?identifier=${s.currentQrTask.activityId}`;return console.log("生成活动二维码链接（使用identifier参数）:",O),Q.value==="xhs"?O+="&platform=xhs":Q.value==="douyin"&&(O+="&platform=douyin"),b.value&&(O+="&publish=1"),O}else if(s.currentQrTask.id&&s.currentQrTask.id.startsWith("activity_")){const O=s.currentQrTask.id.replace("activity_","");let A=`${U}/chat#/xhs-auto-api?identifier=${O}`;return console.log("生成活动二维码链接（从ID提取）:",A),Q.value==="xhs"?A+="&platform=xhs":Q.value==="douyin"&&(A+="&platform=douyin"),b.value&&(A+="&publish=1"),A}else if(s.currentQrUrl&&s.currentQrUrl.includes("data="))try{const O=(f=s.currentQrUrl.split("data=")[1])==null?void 0:f.split("&")[0];if(O){const A=decodeURIComponent(O);if(A.includes("id=")){console.log("从二维码URL中检测到笔记ID");let ie=A;return ie=ie.replace(/&platform=[^&]+/,""),ie=ie.replace(/&publish=1/,""),Q.value!=="all"&&(ie+=`&platform=${Q.value}`),b.value&&(ie+="&publish=1"),ie}else if(A.includes("identifier=")){console.log("从二维码URL中检测到活动ID");let ie=A;return ie=ie.replace(/&platform=[^&]+/,""),ie=ie.replace(/&publish=1/,""),Q.value!=="all"&&(ie+=`&platform=${Q.value}`),b.value&&(ie+="&publish=1"),ie}}}catch(O){console.error("解析二维码URL失败:",O)}}console.log("无法确定链接类型，使用默认URL");let n=window.location.origin+"/chat#/xhs-auto-api";return Q.value!=="all"&&(n+=`?platform=${Q.value}`),b.value&&(n+=n.includes("?")?"&publish=1":"?publish=1"),n}function X(){const n=L();if(n)try{navigator.clipboard.writeText(n).then(()=>{w.value=!0,setTimeout(()=>{w.value=!1},3e3),r("error","链接已复制到剪贴板")}).catch(v=>{console.error("复制到剪贴板失败:",v),u(n)})}catch(v){console.error("复制到剪贴板出错:",v),u(n)}}function u(n){const v=document.createElement("textarea");v.value=n,v.style.position="fixed",v.style.left="-999999px",v.style.top="-999999px",document.body.appendChild(v),v.focus(),v.select();try{document.execCommand("copy")?(w.value=!0,setTimeout(()=>{w.value=!1},3e3),r("error","链接已复制到剪贴板")):r("error","复制失败，请手动复制链接")}catch(f){console.error("Fallback: 复制到剪贴板失败",f),r("error","复制失败，请手动复制链接")}document.body.removeChild(v)}function y(){const n=H.value||L();if(n){window.location.href=n;try{if(console.log("尝试打开链接:",n),/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){console.log("检测到移动设备, 使用特殊处理");try{r("error","正在打开分享页面..."),localStorage.setItem("lastSharedLink",n),setTimeout(()=>{const U=document.createElement("a");U.href=n,U.target="_blank",U.rel="noopener noreferrer",U.style.position="absolute",U.style.top="0",U.style.left="0",U.style.opacity="0",U.style.pointerEvents="all",U.style.zIndex="9999",U.style.width="100%",U.style.height="100%",U.addEventListener("click",V=>{if(console.log("链接被点击"),V.preventDefault(),n.includes("douyin.com")||n.includes("xiaohongshu.com")||n.includes("xhs-auto-api"))window.location.href=n;else{const O=window.open(n,"_blank");(!O||O.closed||typeof O.closed>"u")&&(console.log("弹窗被拦截，使用location.href"),window.location.href=n)}}),document.body.appendChild(U),U.click(),setTimeout(()=>{document.body.contains(U)&&document.body.removeChild(U)},1e3)},100);return}catch(U){console.error("移动设备特殊处理失败:",U)}}const f=window.open(n,"_blank");(!f||f.closed||typeof f.closed>"u")&&(console.log("window.open被拦截，尝试备用方法"),r("error","弹窗被拦截，正在尝试其他方式打开..."),setTimeout(()=>{try{const U=document.createElement("a");U.href=n,U.target="_blank",U.rel="noopener noreferrer",U.style.display="none",document.body.appendChild(U),U.click(),document.body.removeChild(U)}catch(U){console.error("使用a标签打开链接失败:",U),setTimeout(()=>{window.location.href=n},100)}},300))}catch(v){console.error("打开链接失败:",v),r("error","无法自动打开链接，已复制到剪贴板，请手动打开");try{X()}catch{r("error","自动打开和复制都失败，请手动复制链接")}}}}fe(()=>s.showQrModal,n=>{n&&!$.value?($.value=!0,R.value=s.currentQrUrl,I.value=s.currentQrTask):!n&&$.value&&($.value=!1)}),fe(()=>s.currentQrUrl,n=>{n&&(R.value=n)}),fe(()=>s.currentQrTask,n=>{n&&(I.value=n)}),fe(()=>Q.value,n=>{if(s.currentQrTask&&!q.value){const v=typeof window<"u"?window.location.origin:"";let f="";const U=s.currentQrTask.qrCodeType;if(U==="note"&&s.currentQrTask.noteId)f=`${v}/chat#/xhs-auto-api?id=${s.currentQrTask.noteId}`,n!=="all"&&(f+=`&platform=${n}`);else if((U==="activity"||!U&&s.currentQrTask.activityId)&&s.currentQrTask.activityId)f=`${v}/chat#/xhs-auto-api?identifier=${s.currentQrTask.activityId}`,n!=="all"&&(f+=`&platform=${n}`);else if(s.currentQrTask.id&&s.currentQrTask.id.startsWith("activity_")){const V=s.currentQrTask.id.replace("activity_","");f=`${v}/chat#/xhs-auto-api?identifier=${V}`,n!=="all"&&(f+=`&platform=${n}`)}if(b.value&&(f+="&publish=1"),f){const A=`https://xhs.aivip1.top/api/html-render/qrcode?data=${encodeURIComponent(f)}`;s.currentQrTask.result&&(s.currentQrTask.result.qrCode=A,r("qr-load-error",s.currentQrTask)),K.value++,D.value=!0,G.value=!1}}}),fe(()=>b.value,n=>{if(s.currentQrTask&&!q.value){const v=typeof window<"u"?window.location.origin:"";let f="";const U=s.currentQrTask.qrCodeType;if(U==="note"&&s.currentQrTask.noteId)f=`${v}/chat#/xhs-auto-api?id=${s.currentQrTask.noteId}`,Q.value!=="all"&&(f+=`&platform=${Q.value}`);else if((U==="activity"||!U&&s.currentQrTask.activityId)&&s.currentQrTask.activityId)f=`${v}/chat#/xhs-auto-api?identifier=${s.currentQrTask.activityId}`,Q.value!=="all"&&(f+=`&platform=${Q.value}`);else if(s.currentQrTask.id&&s.currentQrTask.id.startsWith("activity_")){const V=s.currentQrTask.id.replace("activity_","");f=`${v}/chat#/xhs-auto-api?identifier=${V}`,Q.value!=="all"&&(f+=`&platform=${Q.value}`)}if(n&&(f+="&publish=1"),f){const A=`https://xhs.aivip1.top/api/html-render/qrcode?data=${encodeURIComponent(f)}`;s.currentQrTask.result&&(s.currentQrTask.result.qrCode=A,r("qr-load-error",s.currentQrTask)),K.value++,D.value=!0,G.value=!1}}});function l(){K.value++,D.value=!0,G.value=!1,q.value=!1,console.log("强制刷新二维码图片")}return a({openQrModal:ne,closeQrModal:h,openNoteDetailModal:j,closeNoteDetailModal:x,showTextLink:T,refreshQrImage:l}),(n,v)=>{var f,U,V,O,A,ie,$e,Fe,Pe,Qe,ze,Ue,Ne,Le;return i(),c(ue,null,[s.showQrModal?(i(),c("div",Hi,[e("div",Gi,[e("div",Wi,[e("h3",Ji,[Ki,((f=s.currentQrTask)==null?void 0:f.qrCodeType)==="note"||(U=s.currentQrTask)!=null&&U.noteId&&!(((V=s.currentQrTask)==null?void 0:V.id)||"").startsWith("activity_")?(i(),c("span",Zi,"扫码查看笔记")):((O=s.currentQrTask)==null?void 0:O.qrCodeType)==="activity"||(ie=(A=s.currentQrTask)==null?void 0:A.id)!=null&&ie.startsWith("activity_")||!(($e=s.currentQrTask)!=null&&$e.noteId)&&((Fe=s.currentQrTask)!=null&&Fe.activityId)?(i(),c("span",Xi,"扫码查看活动笔记")):(i(),c("span",Yi,"扫码查看"))]),e("button",{onClick:h,class:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"},tc)]),e("div",oc,[!q.value&&((Pe=s.currentQrTask)!=null&&Pe.activityId||(Qe=s.currentQrTask)!=null&&Qe.noteId)?(i(),c("div",sc,[e("button",{onClick:v[0]||(v[0]=Ie=>ee("all")),class:se(["px-3 py-1.5 rounded-md text-sm font-medium transition-all duration-200",[Q.value==="all"?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"]])}," 全平台 ",2),e("button",{onClick:v[1]||(v[1]=Ie=>ee("xhs")),class:se(["px-3 py-1.5 rounded-md text-sm font-medium transition-all duration-200",[Q.value==="xhs"?"bg-pink-500 text-white":"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"]])}," 小红书 ",2),e("button",{onClick:v[2]||(v[2]=Ie=>ee("douyin")),class:se(["px-3 py-1.5 rounded-md text-sm font-medium transition-all duration-200",[Q.value==="douyin"?"bg-black text-white dark:bg-gray-900":"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"]])}," 抖音 ",2)])):z("",!0),(Ue=(ze=s.currentQrTask)==null?void 0:ze.result)!=null&&Ue.mobileOnly?(i(),c("div",rc,nc)):z("",!0),q.value?z("",!0):(i(),c("div",lc,[!s.currentQrUrl||D.value?(i(),c("div",ic,dc)):z("",!0),G.value?(i(),c("div",uc,vc)):z("",!0),s.currentQrUrl?(i(),c("img",{src:s.currentQrUrl,key:"qr-image-"+K.value,alt:"二维码",class:"max-w-full max-h-full",style:pt({opacity:D.value||G.value?0:1}),onLoad:v[3]||(v[3]=()=>{D.value=!1,G.value=!1,console.log("二维码图片加载成功")}),onError:v[4]||(v[4]=()=>{D.value=!1,G.value=!0,p()})},null,44,hc)):z("",!0)])),q.value?(i(),c("div",Cc,[Sc,e("div",Tc,[Mc,e("div",Ac,[e("div",Lc,J(H.value),1),e("button",{onClick:X,class:se(["absolute top-0 right-0 h-full px-3 py-2 rounded-r transition-all duration-200 flex items-center justify-center text-xs",w.value?"bg-green-500 text-white":"bg-blue-500 text-white hover:bg-blue-600"])},[w.value?(i(),c("svg",Uc,Dc)):(i(),c("svg",jc,Ec)),Z(" "+J(w.value?"已复制":"复制"),1)],2)])])])):(i(),c("div",pc,[e("div",fc,[mc,e("div",yc,[e("div",kc,J(L()),1),e("button",{onClick:X,class:se(["absolute top-0 right-0 h-full px-3 py-2 rounded-r transition-all duration-200 flex items-center justify-center text-xs",w.value?"bg-green-500 text-white":"bg-blue-500 text-white hover:bg-blue-600"])},[w.value?(i(),c("svg",_c,Ic)):(i(),c("svg",wc,bc)),Z(" "+J(w.value?"已复制":"复制"),1)],2)])])])),!q.value&&((Le=(Ne=s.currentQrTask)==null?void 0:Ne.result)!=null&&Le.mobileOnly)?(i(),c("p",Fc,[Z(" 此页面"),Pc,Z("，请使用手机扫描二维码 ")])):q.value?(i(),c("p",zc," 复制链接或直接点击打开，在手机中浏览 ")):(i(),c("p",Qc," 请使用手机扫描上方二维码查看笔记 ")),e("div",Vc,[e("label",Rc,[ce(e("input",{type:"checkbox","onUpdate:modelValue":v[5]||(v[5]=Ie=>b.value=Ie),class:"sr-only peer"},null,512),[[ps,b.value]]),Oc,qc])]),e("div",{class:se(["mt-6 grid",[E.value?"grid-cols-2 sm:grid-cols-4":"grid-cols-2 sm:grid-cols-3","gap-2"]])},[q.value?z("",!0):(i(),c("button",{key:0,onClick:S,class:"px-2 py-2 bg-pink-500 text-white rounded-md hover:bg-pink-600 transition-all duration-200 flex items-center justify-center"},Wc)),E.value?(i(),c("button",{key:1,onClick:y,class:"px-2 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-all duration-200 flex items-center justify-center"},Zc)):z("",!0),e("button",{onClick:X,class:"px-2 py-2 bg-green-500 text-white rounded-md hover:bg-green-600 transition-all duration-200 flex items-center justify-center"},ed),e("button",{onClick:h,class:"px-2 py-2 border border-gray-300 dark:border-gray-700 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-50 dark:hover:bg-gray-750 transition-all duration-200 flex items-center justify-center"},od)],2)])])])):z("",!0),P.value?(i(),c("div",sd,[e("div",rd,[e("div",{class:"flex justify-between items-center mb-4"},[ad,e("button",{onClick:x,class:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"},ld)]),e("div",id,[N.value?(i(),c("div",cd,ud)):Y.value?(i(),c("div",gd,[e("div",vd,[hd,e("p",null,J(Y.value),1)])])):m.value?(i(),c("div",pd,[e("div",fd,[e("h3",md,J(m.value.title),1),e("div",yd,[kd,m.value.noteId?(i(),c("span",wd," 已发布 ")):z("",!0)])]),e("div",xd,[bd,e("div",_d,J(m.value.content),1)]),m.value.images&&m.value.images.length>0?(i(),c("div",$d,[Id,e("div",Cd,[(i(!0),c(ue,null,xe(m.value.images,(Ie,mt)=>(i(),c("div",{key:mt,class:"aspect-square rounded-md overflow-hidden shadow-sm hover:shadow-md transition-all duration-200"},[e("img",{src:Ie,class:"w-full h-full object-cover"},null,8,Sd)]))),128))])])):z("",!0)])):z("",!0)]),e("div",Td,[m.value&&m.value.noteId?(i(),c("button",{key:0,onClick:C,class:"px-4 py-2 bg-pink-500 text-white rounded-md hover:bg-pink-600 transition-all duration-200 flex items-center"},[Md,Z(" 在小红书中查看 ")])):z("",!0),e("button",{onClick:x,class:"px-4 py-2 border border-gray-300 dark:border-gray-700 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-50 dark:hover:bg-gray-750 transition-all duration-200"}," 关闭 ")])])])):z("",!0)],64)}}}),ye=o=>(Oe("data-v-eaeb4c61"),o=o(),qe(),o),Ld={key:0,class:"fixed inset-0 flex items-center justify-center z-50 p-4 sm:p-6"},jd={class:"relative w-full max-w-2xl mx-auto bg-white dark:bg-gray-800 rounded-lg shadow-xl overflow-hidden flex flex-col max-h-[85vh] sm:max-h-[90vh] md:max-h-[85vh]"},Nd={class:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700 sticky top-0 z-10 bg-white dark:bg-gray-800"},Ed=ye(()=>e("h3",{class:"text-lg font-semibold text-gray-800 dark:text-gray-200 flex items-center"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2 text-pink-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})]),Z(" AI选题生成 ")],-1)),Ud=ye(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)),Bd=[Ud],Dd={key:0,class:"p-4 bg-red-50 dark:bg-red-900/30 border-b border-red-200 dark:border-red-800"},Fd={class:"flex items-center"},Pd=ye(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-red-500 mr-2 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),Qd={class:"text-sm text-red-600 dark:text-red-300"},zd={key:0,class:"absolute top-0 inset-x-0 p-4 bg-green-50 dark:bg-green-900/30 border-b border-green-200 dark:border-green-800 z-10"},Vd={class:"flex items-center"},Rd=ye(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-green-500 mr-2 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)),Od={class:"text-sm text-green-600 dark:text-green-300"},qd={key:1,class:"p-4 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700"},Hd={class:"flex justify-between items-center mb-3"},Gd=ye(()=>e("h4",{class:"text-sm font-semibold text-gray-700 dark:text-gray-300"}," 选择一个或多个选题: ",-1)),Wd={class:"flex items-center space-x-2"},Jd=["disabled"],Kd={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-3.5 w-3.5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Zd=ye(()=>e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"},null,-1)),Xd=[Zd],Yd={key:1,class:"animate-spin h-3.5 w-3.5 mr-1",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},e0=ye(()=>e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1)),t0=ye(()=>e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)),o0=[e0,t0],s0={class:"space-y-2 max-h-[calc(50vh)] sm:max-h-[50vh] md:max-h-[55vh] lg:max-h-[60vh] overflow-y-auto"},r0=["onClick"],a0={class:"flex-shrink-0 mt-0.5"},n0=["checked","onClick"],l0={class:"flex-grow"},i0={class:"text-sm font-medium text-gray-800 dark:text-gray-200 select-none mb-1"},c0={key:0,class:"mt-1 text-xs text-gray-600 dark:text-gray-400 bg-gray-50 dark:bg-gray-900/50 rounded p-1.5"},d0={key:0,class:"mt-0"},u0={class:"whitespace-pre-line"},g0={key:0,class:"flex items-center mb-0.5 text-yellow-500 font-medium"},v0={key:1,class:"mb-0.5 text-blue-500"},h0={key:2,class:"mb-0.5 text-green-500"},p0={key:3,class:"mb-0.5 text-purple-500"},f0={key:4,class:"mb-0.5 text-gray-500"},m0={key:0,class:"mb-1"},y0={class:"font-medium"},k0={class:"mt-4 flex justify-center sticky bottom-0 pb-4 pt-2 bg-white dark:bg-gray-800 border-t border-gray-100 dark:border-gray-700"},w0=["disabled"],x0={key:0,class:"flex items-center justify-center"},b0=ye(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)),_0={key:1,class:"flex items-center justify-center"},$0=ye(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)),I0={key:2,class:"p-4 overflow-y-auto max-h-[75vh] sm:max-h-[80vh] md:max-h-[75vh]"},C0=ye(()=>e("div",{class:"bg-blue-50 dark:bg-blue-900/30 p-3 rounded-lg mb-4 border border-blue-100 dark:border-blue-800"},[e("p",{class:"text-sm text-blue-800 dark:text-blue-200 flex items-start"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2 flex-shrink-0 text-blue-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]),e("span",null," 填写以下信息，AI将根据您提供的内容生成更有针对性的选题。所有字段均为选填，填写越详细，生成的选题越精准。您的设置将保存到本地，下次使用时自动加载。 ")])],-1)),S0=ye(()=>e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," 行业/领域 ",-1)),T0=ye(()=>e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," 目标人群 ",-1)),M0=ye(()=>e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," 核心产品/服务/主题 ",-1)),A0=ye(()=>e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," 地点 ",-1)),L0=ye(()=>e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," 独特卖点/核心痛点 ",-1)),j0={class:"flex justify-between mt-6"},N0=["disabled"],E0={key:0},U0={key:1,class:"flex items-center"},B0=ye(()=>e("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),D0=["disabled"],F0={key:0},P0={key:1,class:"flex items-center"},Q0=ye(()=>e("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),z0={key:3,class:"p-4 flex justify-center items-center min-h-[200px]"},V0=ye(()=>e("div",{class:"flex flex-col items-center"},[e("svg",{class:"animate-spin h-8 w-8 text-pink-500 mb-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]),e("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"加载中...")],-1)),R0=[V0],no=5,lo="ai_topic_gen_form_data",O0=de({__name:"AiTopicGenModal",props:{visible:{type:Boolean}},emits:["update:visible","generate","generateMultiple"],setup(o,{emit:a}){const t=a,s=_({industry:"",audience:"",product:"",location:"",painPoint:""}),r=_(!1),h=_(!1),x=_(!1),p=_([]),$=_(0),R=_([]),I=_([]),P=_(""),m=()=>{t("update:visible",!1),p.value=[],$.value=0,R.value=[]},N=async()=>{try{h.value=!0,P.value="",localStorage.setItem(lo,JSON.stringify(s.value));try{await _s(s.value),q()}catch(T){console.error("API保存设置失败，使用本地备份:",T),q("API保存失败，已备份到本地")}}catch(T){console.error("保存设置时出错:",T),P.value="保存设置失败，请重试"}finally{h.value=!1}},Y=_(!1),H=_("设置已保存"),q=(T="设置已保存")=>{H.value=T,Y.value=!0,setTimeout(()=>{Y.value=!1},2e3)},w=async()=>{try{x.value=!0,P.value="";let T=!1;try{const L=await $s();L&&(s.value=L,console.log("从API加载设置成功",L),T=!0)}catch(L){console.error("API加载设置失败，尝试本地存储:",L),P.value="从服务器加载设置失败，尝试本地备份"}if(!T){const L=localStorage.getItem(lo);if(L)try{const X=JSON.parse(L);s.value={...X},console.log("从本地存储加载设置成功"),T=!0}catch(X){console.error("无法解析本地存储的表单数据:",X)}}T||(P.value="无法加载任何保存的设置，使用默认值")}finally{x.value=!1}},b=()=>{const T=Object.entries(s.value).filter(([L,X])=>X.trim()!=="").map(([L,X])=>`${{industry:"行业/领域",audience:"目标人群",product:"核心产品/服务/主题",location:"地点",painPoint:"独特卖点/核心痛点"}[L]}: ${X.trim()}`);return T.length>0?T.join("，"):"生成选题"},D=T=>{$.value=T},G=T=>{const L=R.value.indexOf(T);L===-1?R.value.push(T):R.value.splice(L,1)},K=T=>{G(T),D(T)},Q=T=>R.value.includes(T),E=()=>{p.value.length>0&&$.value>=0&&$.value<p.value.length&&(t("generate",p.value[$.value]),m())},ee=()=>{if(R.value.length>0){const T=R.value.map(L=>p.value[L]);t("generateMultiple",T),m()}},ne=()=>{R.value.length===p.value.length?R.value=[]:R.value=[...Array(p.value.length).keys()]},S=async()=>{try{r.value=!0,P.value="",p.value=[],I.value=[],$.value=0,R.value=[];const T=b();try{const L=await Ot(s.value,no);console.log("AI选题生成响应:",L),L.success&&L.topicList&&L.topicList.length>0?(p.value=L.topicList,L.data?(console.log("结构化数据:",L.data),I.value=Array.isArray(L.data)?L.data:[L.data]):console.warn("没有接收到结构化数据")):(console.warn("API返回无效选题列表，使用备用选题",L),p.value=[T])}catch(L){console.error("调用AI选题生成API时出错:",L),p.value=[T]}}catch(T){console.error("生成选题时出错:",T),P.value="生成选题失败，请重试"}finally{r.value=!1}},j=async()=>{try{r.value=!0,P.value="";const T=b();try{const L=await Ot(s.value,no);if(L.success&&L.topicList&&L.topicList.length>0){const X=[...R.value],u=p.value.length;if(p.value=[...p.value,...L.topicList],L.data){const y=Array.isArray(L.data)?L.data:[L.data];I.value=[...I.value,...y]}R.value=X}else console.warn("API返回无效选题列表，使用备用选题",L),p.value.push(T)}catch(L){console.error("调用AI选题生成API时出错:",L),p.value.push(T)}}catch(T){console.error("生成更多选题时出错:",T),P.value="生成更多选题失败，请重试"}finally{r.value=!1}},C=T=>I.value&&I.value[T]?I.value[T]:null;return Te(()=>{w()}),(T,L)=>(i(),Me(ut,{name:"fade"},{default:Be(()=>[T.visible?(i(),c("div",Ld,[e("div",{class:"absolute inset-0 bg-black bg-opacity-50 backdrop-blur-sm",onClick:m}),e("div",jd,[e("div",Nd,[Ed,e("button",{onClick:ge(m,["stop","prevent"]),class:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 focus:outline-none"},Bd)]),P.value?(i(),c("div",Dd,[e("div",Fd,[Pd,e("p",Qd,J(P.value),1)])])):z("",!0),ke(ut,{name:"fade"},{default:Be(()=>[Y.value?(i(),c("div",zd,[e("div",Vd,[Rd,e("p",Od,J(H.value),1)])])):z("",!0)]),_:1}),p.value.length>0?(i(),c("div",qd,[e("div",Hd,[Gd,e("div",Wd,[e("button",{onClick:ne,class:"text-xs text-blue-500 hover:text-blue-600 dark:text-blue-400 dark:hover:text-blue-300"},J(R.value.length===p.value.length?"取消全选":"全选"),1),e("button",{onClick:j,class:"text-xs flex items-center text-green-500 hover:text-green-600 dark:text-green-400 dark:hover:text-green-300",disabled:r.value},[r.value?(i(),c("svg",Yd,o0)):(i(),c("svg",Kd,Xd)),Z(" "+J(r.value?"生成中...":"生成更多"),1)],8,Jd)])]),e("div",s0,[(i(!0),c(ue,null,xe(p.value,(X,u)=>{var y,l,n,v,f,U,V,O,A,ie,$e,Fe,Pe,Qe,ze,Ue,Ne;return i(),c("div",{key:u,class:se(["p-3 border rounded-md cursor-pointer transition-all duration-200 flex items-start gap-3 hover:bg-blue-50 dark:hover:bg-blue-900/20",{"bg-blue-50 dark:bg-blue-900/30 border-blue-300 dark:border-blue-700":Q(u)||u===$.value,"bg-gray-50 dark:bg-gray-900/30 border-gray-200 dark:border-gray-700":!Q(u)&&u!==$.value}]),onClick:Le=>K(u)},[e("div",a0,[e("input",{type:"checkbox",checked:Q(u),onClick:ge(Le=>G(u),["stop"]),class:"h-4 w-4 text-pink-600 focus:ring-pink-500 rounded border-gray-300 dark:border-gray-600"},null,8,n0)]),e("div",l0,[e("p",i0,J(X),1),C(u)?(i(),c("div",c0,[(l=(y=C(u))==null?void 0:y.desc)!=null&&l.includes(`
`)?(i(),c("div",d0,[e("div",u0,[(v=(n=C(u))==null?void 0:n.desc)!=null&&v.includes("爆款指数")?(i(),c("div",g0,[e("span",null,J((f=C(u))==null?void 0:f.desc.split(`
`)[0]),1)])):z("",!0),(V=(U=C(u))==null?void 0:U.desc)!=null&&V.includes("评分参数")?(i(),c("div",v0,[e("span",null,J((O=C(u))==null?void 0:O.desc.split(`
`)[1]),1)])):z("",!0),(ie=(A=C(u))==null?void 0:A.desc)!=null&&ie.includes("词根")?(i(),c("div",h0,[e("span",null,J(($e=C(u))==null?void 0:$e.desc.split(`
`)[2]),1)])):z("",!0),(Pe=(Fe=C(u))==null?void 0:Fe.desc)!=null&&Pe.includes("搜索匹配")?(i(),c("div",p0,[e("span",null,J((Qe=C(u))==null?void 0:Qe.desc.split(`
`)[3]),1)])):z("",!0),(Ue=(ze=C(u))==null?void 0:ze.desc)!=null&&Ue.includes("SEO")?(i(),c("div",f0,[e("span",null,J((Ne=C(u))==null?void 0:Ne.desc.split(`
`)[4]),1)])):z("",!0)])])):z("",!0),(i(!0),c(ue,null,xe(C(u)||{},(Le,Ie)=>(i(),c(ue,{key:String(Ie)},[typeof Ie=="string"&&Ie!=="title"&&Ie!=="desc"?(i(),c("div",m0,[e("span",y0,J(Ie)+":",1),Z(" "+J(typeof Le=="object"?JSON.stringify(Le):Le),1)])):z("",!0)],64))),128))])):z("",!0)])],10,r0)}),128))]),e("div",k0,[e("button",{onClick:L[0]||(L[0]=X=>R.value.length>0?ee():E()),class:"w-full sm:w-auto px-6 py-3 sm:py-2 bg-gradient-to-r from-pink-500 to-pink-600 text-white rounded-md hover:from-pink-600 hover:to-pink-700 transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-pink-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed shadow-sm",disabled:p.value.length===0},[R.value.length>0?(i(),c("span",x0,[b0,Z(" 使用已选择的 "+J(R.value.length)+" 个选题 ",1)])):(i(),c("span",_0,[$0,Z(" 使用当前选中选题 ")]))],8,w0)])])):z("",!0),!x.value&&p.value.length===0?(i(),c("div",I0,[C0,e("form",{onSubmit:ge(S,["prevent"]),class:"space-y-4"},[e("div",null,[S0,ce(e("input",{"onUpdate:modelValue":L[1]||(L[1]=X=>s.value.industry=X),type:"text",placeholder:"例如：英语教育, 本地餐饮(火锅), 美妆护肤, 家居软装",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-pink-500 dark:bg-gray-800 dark:text-white"},null,512),[[we,s.value.industry]])]),e("div",null,[T0,ce(e("input",{"onUpdate:modelValue":L[2]||(L[2]=X=>s.value.audience=X),type:"text",placeholder:"例如：K12学生家长, 25-35岁都市丽人, 租房党, 考研学生",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-pink-500 dark:bg-gray-800 dark:text-white"},null,512),[[we,s.value.audience]])]),e("div",null,[M0,ce(e("input",{"onUpdate:modelValue":L[3]||(L[3]=X=>s.value.product=X),type:"text",placeholder:"例如：在线英语课程, 水果捞, 防晒霜, 小户型收纳",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-pink-500 dark:bg-gray-800 dark:text-white"},null,512),[[we,s.value.product]])]),e("div",null,[A0,ce(e("input",{"onUpdate:modelValue":L[4]||(L[4]=X=>s.value.location=X),type:"text",placeholder:"例如：北京, 深圳, 上海, 成都",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-pink-500 dark:bg-gray-800 dark:text-white"},null,512),[[we,s.value.location]])]),e("div",null,[L0,ce(e("input",{"onUpdate:modelValue":L[5]||(L[5]=X=>s.value.painPoint=X),type:"text",placeholder:"例如：高效学习, 性价比高, 适合敏感肌, 增大收纳空间",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-pink-500 dark:bg-gray-800 dark:text-white"},null,512),[[we,s.value.painPoint]])]),e("div",j0,[e("button",{type:"button",onClick:N,class:"px-4 py-2 border border-gray-300 dark:border-gray-700 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-50 dark:hover:bg-gray-750 focus:outline-none focus:ring-2 focus:ring-gray-500 dark:focus:ring-gray-400",disabled:h.value},[h.value?(i(),c("span",U0,[B0,Z(" 保存中... ")])):(i(),c("span",E0,"保存设置"))],8,N0),e("button",{type:"submit",class:"px-4 py-2 bg-gradient-to-r from-pink-500 to-pink-600 text-white rounded-md hover:from-pink-600 hover:to-pink-700 focus:outline-none focus:ring-2 focus:ring-pink-500 focus:ring-offset-2",disabled:r.value},[r.value?(i(),c("span",P0,[Q0,Z(" 生成中... ")])):(i(),c("span",F0,"生成选题"))],8,D0)])],32)])):z("",!0),x.value?(i(),c("div",z0,R0)):z("",!0)])])):z("",!0)]),_:1}))}});const q0=He(O0,[["__scopeId","data-v-eaeb4c61"]]),he=o=>(Oe("data-v-2f577c52"),o=o(),qe(),o),H0={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70 backdrop-blur-sm p-2 sm:p-0"},G0={class:"w-full max-w-6xl h-[90vh] sm:h-[80vh] flex flex-col bg-white dark:bg-gray-900 rounded-lg overflow-hidden shadow-xl"},W0={class:"flex justify-between items-center p-3 sm:p-4 border-b border-gray-200 dark:border-gray-700"},J0={class:"flex items-center"},K0={class:"text-base sm:text-lg font-bold text-gray-800 dark:text-gray-200"},Z0={class:"ml-2 text-xs sm:text-sm font-normal text-gray-500 dark:text-gray-400 hidden sm:inline"},X0=he(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)),Y0=[X0],eu={class:"sm:hidden px-3 py-2 bg-blue-50 dark:bg-blue-900/20 text-xs"},tu={class:"flex flex-col md:flex-row flex-1 overflow-hidden"},ou={class:"w-full md:w-64 overflow-y-auto p-4 border-b md:border-b-0 md:border-r border-gray-200 dark:border-gray-700"},su={class:"mb-4"},ru=he(()=>e("div",{class:"flex justify-between items-center mb-2"},[e("h4",{class:"font-medium text-gray-700 dark:text-gray-300"},"文件夹"),e("span",{class:"text-xs text-blue-600 dark:text-blue-400"}," (单击选择/浏览) ")],-1)),au=he(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})],-1)),nu={key:0,class:"mb-3"},lu={class:"flex space-x-2"},iu=["disabled"],cu={class:"flex justify-end mt-1"},du={class:"space-y-1 max-h-[30vh] md:max-h-none overflow-y-auto"},uu={class:"flex items-center"},gu={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3 text-white",viewBox:"0 0 20 20",fill:"currentColor"},vu=he(()=>e("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"},null,-1)),hu=[vu],pu=he(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})],-1)),fu={key:0,class:"text-xs bg-blue-100 dark:bg-blue-800 text-blue-700 dark:text-blue-300 px-1.5 py-0.5 rounded-full"},mu=["onClick"],yu={class:"flex items-center"},ku=["onClick"],wu={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3 text-white",viewBox:"0 0 20 20",fill:"currentColor"},xu=he(()=>e("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"},null,-1)),bu=[xu],_u=he(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})],-1)),$u={class:"truncate max-w-[120px]"},Iu={class:"flex items-center"},Cu={key:0,class:"text-xs bg-blue-100 dark:bg-blue-800 text-blue-700 dark:text-blue-300 px-1.5 py-0.5 rounded-full mr-2"},Su={class:"text-xs bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400 px-1.5 rounded-full"},Tu=["onClick"],Mu=he(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)),Au=[Mu],Lu={class:"flex-1 flex flex-col overflow-hidden"},ju={class:"flex flex-col sm:flex-row justify-between items-start sm:items-center p-4 border-b border-gray-200 dark:border-gray-600"},Nu={class:"font-medium text-gray-700 dark:text-gray-300 mb-2 sm:mb-0"},Eu={class:"block sm:inline text-xs text-gray-500 dark:text-gray-400 mt-1 sm:mt-0 sm:ml-2"},Uu={class:"flex space-x-2 w-full sm:w-auto"},Bu=["disabled"],Du={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Fu=he(()=>e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"},null,-1)),Pu=[Fu],Qu={key:1,class:"animate-spin h-4 w-4 mr-1 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},zu=he(()=>e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1)),Vu=he(()=>e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)),Ru=[zu,Vu],Ou={key:0,class:"px-4 py-2 bg-blue-50 dark:bg-blue-900/20 border-b border-blue-100 dark:border-blue-800/30"},qu=he(()=>e("div",{class:"flex items-center text-blue-600 dark:text-blue-300"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]),e("span",{class:"text-sm"},[Z("当前处于"),e("strong",null,"全部文件夹"),Z("视图，您可以浏览所有素材，但要上传素材请从左侧选择一个具体的文件夹")])],-1)),Hu=[qu],Gu={class:"flex-1 overflow-y-auto p-2 sm:p-4"},Wu={key:0,class:"mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-md border border-blue-200 dark:border-blue-800/50"},Ju={class:"flex flex-col"},Ku={key:0,class:"flex items-center text-blue-600 dark:text-blue-300 mb-2"},Zu=he(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})],-1)),Xu={class:"font-medium"},Yu={key:1,class:"flex items-center text-pink-600 dark:text-pink-300"},eg=he(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),tg={class:"font-medium"},og={key:1,class:"h-full flex items-center justify-center"},sg=he(()=>e("div",{class:"flex flex-col items-center"},[e("div",{class:"h-10 w-10 border-4 border-t-pink-500 rounded-full animate-spin mb-4"}),e("p",{class:"text-gray-500 dark:text-gray-400"},"加载中...")],-1)),rg=[sg],ag={key:2,class:"h-full flex items-center justify-center"},ng={class:"text-center p-4"},lg=he(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-16 w-16 mx-auto text-gray-300 dark:text-gray-600 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),ig=he(()=>e("p",{class:"text-gray-500 dark:text-gray-400 mb-4"},"暂无素材",-1)),cg=he(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1)),dg={key:1,class:"text-gray-500 dark:text-gray-400 mt-2"},ug={key:3,class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-2 sm:gap-4"},gg=["onClick"],vg={key:0,class:"absolute top-1 left-1 sm:top-2 sm:left-2 z-10 px-1 sm:px-1.5 py-0.5 bg-red-500 text-white text-xs font-medium rounded"},hg={key:1,class:"absolute top-1 left-1 sm:top-2 sm:left-2 z-10 px-1 sm:px-1.5 py-0.5 bg-green-500 text-white text-xs font-medium rounded"},pg=["src"],fg={class:"absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center md:opacity-0 opacity-100 md:group-hover:opacity-100 transition-opacity"},mg={class:"flex space-x-2"},yg=["onClick"],kg=he(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)),wg=[kg],xg=["onClick","title"],bg={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},_g=he(()=>e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"},null,-1)),$g=[_g],Ig={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Cg=he(()=>e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)),Sg=[Cg],Tg={key:2,class:"absolute top-1 right-1 sm:top-2 sm:right-2 h-5 w-5 sm:h-6 sm:w-6 bg-pink-500 rounded-full flex items-center justify-center"},Mg=he(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3 sm:h-4 sm:w-4 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)),Ag=[Mg],Lg={class:"flex justify-end items-center p-3 sm:p-4 border-t border-gray-200 dark:border-gray-700"},jg=he(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)),Ng=["disabled"],Eg=he(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)),Ug=de({__name:"MaterialLibrary",props:{visible:{type:Boolean},selectedMaterials:{}},emits:["update:visible","select","error"],setup(o,{emit:a}){const t=o,s=a,r=_(!1),h=_([]),x=_([]),p=_(""),$=_([...t.selectedMaterials]),R=_(""),I=_(!1),P=_(!1),m=_(null),N=_([]);_(!0),_(!0);const Y=bs(),H=re(()=>{if(!h.value||!Array.isArray(h.value))return"全部素材";if(p.value==="1")return"全部文件夹（仅浏览模式）";const u=h.value.find(y=>y.id===p.value);return u?u.name:"全部素材"}),q=re(()=>{let u="";return N.value.length>0?(u+=`已选择 ${N.value.length} 个文件夹`,$.value.length>0&&(u+=`, ${$.value.length} 个素材`)):$.value.length>0?u=`已选择 ${$.value.length} 个素材`:u="请选择文件夹或素材",u});fe(()=>t.selectedMaterials,u=>{$.value=[...u]},{deep:!0}),fe(()=>t.visible,u=>{if(u){N.value=[],$.value=[...t.selectedMaterials];const y=sessionStorage.getItem("materialSelectionInfo");if(y)try{const l=JSON.parse(y);l&&l.folders&&Array.isArray(l.folders)&&l.folders.length>0?(N.value=[...l.folders],sessionStorage.getItem("materialLibraryFolderSelection")!=="true"&&sessionStorage.setItem("materialLibraryFolderSelection","true")):sessionStorage.removeItem("materialLibraryFolderSelection"),l&&l.materials&&Array.isArray(l.materials)&&l.materials.length>0?($.value=[...l.materials],sessionStorage.getItem("materialLibraryMaterialSelection")!=="true"&&sessionStorage.setItem("materialLibraryMaterialSelection","true")):sessionStorage.removeItem("materialLibraryMaterialSelection")}catch(l){console.error("解析选择信息失败:",l),sessionStorage.removeItem("materialLibraryFolderSelection"),sessionStorage.removeItem("materialLibraryMaterialSelection"),sessionStorage.removeItem("materialLibrarySelectionType")}else sessionStorage.removeItem("materialLibraryFolderSelection"),sessionStorage.removeItem("materialLibraryMaterialSelection"),sessionStorage.removeItem("materialLibrarySelectionType");w()}});async function w(){var u,y;try{r.value=!0;const l=await Uo();let n=[];if(Array.isArray(l))n=l;else if(l&&Array.isArray((u=l.data)==null?void 0:u.data))n=l.data.data;else if(l&&Array.isArray(l.data))n=l.data;else if(l&&((y=l.data)!=null&&y.data)&&typeof l.data.data=="object")n=[l.data.data];else if(l&&l.data&&typeof l.data=="object")n=[l.data];else if(l&&typeof l=="object")for(const v of Object.keys(l)){const f=l[v];if(Array.isArray(f)){n=f;break}}n.length===0?h.value=[]:(h.value=[],n.forEach(v=>{if(v&&Array.isArray(v.data))v.data.forEach(f=>{const U=f.name||f.folderName||f.title||"未命名文件夹";h.value.push({id:f.id||"",name:U,count:f.count||0,createTime:typeof f.createTime=="string"?f.createTime:new Date().toISOString(),updateTime:typeof f.updateTime=="string"?f.updateTime:new Date().toISOString()})});else{const f=v.name||v.folderName||v.title||"未命名文件夹";h.value.push({id:v.id||"",name:f,count:v.count||0,createTime:typeof v.createTime=="string"?v.createTime:new Date().toISOString(),updateTime:typeof v.updateTime=="string"?v.updateTime:new Date().toISOString()})}})),await b(p.value)}catch(l){s("error",l),h.value=[]}finally{r.value=!1}}async function b(u){var y,l;try{r.value=!0;const n=await Bo(u);let v=[];if(Array.isArray(n))v=n;else if(n&&Array.isArray((y=n.data)==null?void 0:y.data))v=n.data.data;else if(n&&Array.isArray(n.data))v=n.data;else if(n&&((l=n.data)!=null&&l.data)&&typeof n.data.data=="object")v=[n.data.data];else if(n&&n.data&&typeof n.data=="object")v=[n.data];else if(n&&typeof n=="object")for(const f of Object.keys(n)){const U=n[f];if(Array.isArray(U)){v=U;break}}x.value=v.map(f=>({id:f.id||"",fileId:f.fileId||"",cozeFileId:f.cozeFileId||"",name:f.name||"未命名素材",previewUrl:f.previewUrl||"",size:f.size||0,type:f.type||"",folderId:f.folderId||"",uploadTime:typeof f.uploadTime=="string"?f.uploadTime:new Date().toISOString(),expiryTime:typeof f.expiryTime=="string"?f.expiryTime:new Date().toISOString(),status:f.status||"valid"}))}catch(n){s("error",n),x.value=[]}finally{r.value=!1}}async function D(u){u!==p.value&&(p.value=u,await b(u))}function G(u,y){y==null||y.stopPropagation();const l=N.value.indexOf(u);l===-1?N.value.push(u):N.value.splice(l,1)}function K(u){return N.value.includes(u)}async function Q(){if(R.value.trim())try{r.value=!0,console.log("开始创建文件夹:",R.value.trim());const u=await Yr(R.value.trim());console.log("创建文件夹响应:",u);let y;u&&(u.data&&u.data.data||u.data&&u.data.success&&u.data.data?y=u.data.data:u.data?y=u.data:y=u),console.log("提取的文件夹数据:",y),y&&y.id?(console.log("新文件夹创建成功:",y),h.value.unshift(y),p.value=y.id,R.value="",I.value=!1,await b(p.value)):(console.error("创建文件夹失败: 响应数据异常",u),s("error","创建文件夹失败，请重试"))}catch(u){console.error("创建文件夹失败:",u),s("error",u)}finally{r.value=!1}}function E(u){if(u==null||u.preventDefault(),u==null||u.stopPropagation(),console.log("素材库: 触发文件上传"),p.value==="1"){Y.warning({title:"请选择具体文件夹",content:"全部文件夹视图只能浏览素材，请先选择一个具体文件夹再上传素材",positiveText:"确定",style:{zIndex:1e4}});return}if(!p.value){console.error("素材库: 未选择文件夹"),Y.warning({title:"上传错误",content:"请先选择或创建文件夹",positiveText:"确定",style:{zIndex:1e4}});return}if(!m.value){console.error("文件输入引用为空");const y=document.createElement("input");y.type="file",y.multiple=!0,y.accept="image/*",y.style.display="none",y.onchange=ee,document.body.appendChild(y),y.click(),setTimeout(()=>{y&&document.body.contains(y)&&document.body.removeChild(y)},5e3);return}console.log("素材库: 找到文件输入元素，触发点击"),st(()=>{var y;(y=m.value)==null||y.click(),console.log("素材库: 已触发文件选择对话框")})}async function ee(u){var n,v,f,U;const l=u.target.files;if(console.log("素材库: 文件选择回调触发"),!l||l.length===0){console.log("素材库: 没有选择文件");return}if(console.log(`素材库: 选择了 ${l.length} 个文件`),p.value==="1"){Y.warning({title:"请选择具体文件夹",content:"全部文件夹视图下不能上传素材，请先选择一个具体文件夹",positiveText:"确定",style:{zIndex:1e4}});return}if(!p.value){console.error("素材库: 未选择文件夹"),Y.warning({title:"上传错误",content:"请先选择或创建文件夹",positiveText:"确定",style:{zIndex:1e4}});return}P.value=!0;try{console.log("素材库: 开始上传文件");for(const V of Array.from(l))try{console.log(`素材库: 上传文件 ${V.name}, ${V.size} 字节`),await ea(V,p.value),console.log(`素材库: 文件 ${V.name} 上传成功`)}catch(O){console.error(`素材库: 文件 ${V.name} 上传失败:`,O);let A=`文件 ${V.name} 上传失败`;(v=(n=O==null?void 0:O.response)==null?void 0:n.data)!=null&&v.message&&typeof O.response.data.message=="string"&&O.response.data.message.includes("已有相同名称素材")?A=O.response.data.message:O!=null&&O.message&&typeof O.message=="string"&&(A=O.message),Y.warning({title:"上传失败",content:A,positiveText:"确定",style:{zIndex:1e4}});break}console.log("素材库: 所有文件上传完成，重新加载素材列表"),await b(p.value)}catch(V){console.error("素材库: 上传文件处理失败:",V);let O="上传文件失败";(U=(f=V==null?void 0:V.response)==null?void 0:f.data)!=null&&U.message?O=V.response.data.message:typeof V=="string"?O=V:V!=null&&V.message&&(O=V.message),Y.warning({title:"上传错误",content:O,positiveText:"确定",style:{zIndex:1e4}})}finally{P.value=!1,m.value&&(console.log("素材库: 重置文件输入"),m.value.value="")}}async function ne(u){try{r.value=!0,await ta(u),x.value=x.value.filter(y=>y.id!==u),$.value=$.value.filter(y=>y!==u)}catch(y){console.error("删除素材失败:",y),s("error",y)}finally{r.value=!1}}function S(u){const y=$.value.indexOf(u);y===-1?$.value.push(u):$.value.splice(y,1)}function j(u){return $.value.includes(u)}function C(){let u=!1;if(N.value.length>0?(sessionStorage.setItem("materialLibraryFolderSelection","true"),u=!0):sessionStorage.removeItem("materialLibraryFolderSelection"),$.value.length>0?(sessionStorage.setItem("materialLibraryMaterialSelection","true"),u=!0):sessionStorage.removeItem("materialLibraryMaterialSelection"),u){sessionStorage.setItem("materialLibrarySelectionType","both");const y=[...N.value,...$.value];console.log("确认选择: 文件夹",N.value,"素材",$.value),console.log("合并后的选择:",y);const l={};N.value.forEach(v=>{const f=h.value.find(U=>U.id===v);f&&(l[v]=f.name)});const n={folders:N.value,materials:$.value,folderNames:l};console.log("完整选择信息:",n),sessionStorage.setItem("materialSelectionInfo",JSON.stringify(n)),s("select",y)}else sessionStorage.removeItem("materialLibrarySelectionType"),sessionStorage.removeItem("materialSelectionInfo"),sessionStorage.removeItem("materialLibraryFolderSelection"),sessionStorage.removeItem("materialLibraryMaterialSelection"),s("select",[]);T()}function T(){if($.value.length===0&&N.value.length===0)sessionStorage.removeItem("materialLibrarySelectionType"),sessionStorage.removeItem("materialSelectionInfo"),sessionStorage.removeItem("materialLibraryFolderSelection"),sessionStorage.removeItem("materialLibraryMaterialSelection");else{const u={folders:N.value,materials:$.value,folderNames:{}};N.value.forEach(y=>{const l=h.value.find(n=>n.id===y);l&&(u.folderNames[y]=l.name)}),sessionStorage.setItem("materialSelectionInfo",JSON.stringify(u)),N.value.length>0?sessionStorage.setItem("materialLibraryFolderSelection","true"):sessionStorage.removeItem("materialLibraryFolderSelection"),$.value.length>0?sessionStorage.setItem("materialLibraryMaterialSelection","true"):sessionStorage.removeItem("materialLibraryMaterialSelection"),N.value.length>0&&$.value.length>0?sessionStorage.setItem("materialLibrarySelectionType","both"):N.value.length>0?sessionStorage.setItem("materialLibrarySelectionType","folders"):$.value.length>0?sessionStorage.setItem("materialLibrarySelectionType","materials"):sessionStorage.removeItem("materialLibrarySelectionType")}s("update:visible",!1)}async function L(u){try{if(!u){console.error("文件夹ID为空，无法删除"),s("error","文件夹ID为空，无法删除");return}Y.warning({title:"删除确认",content:"确定要删除此文件夹吗？此操作将删除文件夹中的所有素材，且不可恢复。",positiveText:"确认删除",negativeText:"取消",positiveButtonProps:{type:"error"},onPositiveClick:async()=>{var y,l;try{r.value=!0,console.log("开始删除文件夹:",u);const n=await oa(u);console.log("删除文件夹响应:",n),h.value=h.value.filter(f=>f.id!==u),p.value===u&&(p.value=h.value.length>0?h.value[0].id:"",await b(p.value));const v=N.value.indexOf(u);v!==-1&&N.value.splice(v,1),s("error",{type:"success",message:"文件夹删除成功"})}catch(n){console.error("删除文件夹API调用失败:",n);let v="删除文件夹失败";if(n.response)if(console.error("错误响应状态:",n.response.status),console.error("错误响应数据:",n.response.data),n.response.status===302){v="登录已过期，请重新登录";const f=window.useAuthStore&&window.useAuthStore();f&&(f.removeToken(),f.setLoginDialog&&f.setLoginDialog(!0))}else if(n.response.status===401){v="请先登录后再操作";const f=window.useAuthStore&&window.useAuthStore();f&&(f.removeToken(),f.setLoginDialog&&f.setLoginDialog(!0))}else if(n.response.status===400&&((l=(y=n.response.data)==null?void 0:y.message)!=null&&l.includes("无权删除"))){v="您没有权限删除此文件夹，只能删除自己创建的文件夹";const f=h.value.find(U=>U.id===u);if(f){s("error",`您无法删除"${f.name}"文件夹，因为它不是由您创建的`);return}}else n.response.data&&n.response.data.message&&(v=n.response.data.message);else n.message&&(v=n.message);s("error",v)}finally{r.value=!1}}});return}catch(y){console.error("删除文件夹失败:",y),s("error","删除文件夹时发生未知错误")}}Te(()=>(p.value="1",w(),X(),window.addEventListener("beforeunload",X),()=>{window.removeEventListener("beforeunload",X)}));function X(){sessionStorage.removeItem("materialLibrarySelectionType"),sessionStorage.removeItem("materialSelectionInfo"),sessionStorage.removeItem("materialLibraryFolderSelection"),sessionStorage.removeItem("materialLibraryMaterialSelection"),N.value=[],$.value=[]}return(u,y)=>u.visible?(i(),c("div",H0,[e("div",G0,[e("div",W0,[e("div",J0,[e("h3",K0,[Z(" 素材库 "),e("span",Z0,J(q.value),1)])]),e("button",{onClick:T,class:"p-1.5 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800"},Y0)]),e("div",eu,J(q.value),1),e("div",tu,[e("div",ou,[e("div",su,[ru,e("button",{onClick:y[0]||(y[0]=l=>I.value=!0),class:"w-full mb-3 px-3 py-1.5 text-sm bg-blue-500 hover:bg-blue-600 text-white rounded-md flex items-center justify-center"},[au,Z(" 新建文件夹 ")]),I.value?(i(),c("div",nu,[e("div",lu,[ce(e("input",{"onUpdate:modelValue":y[1]||(y[1]=l=>R.value=l),type:"text",placeholder:"输入文件夹名称",class:"flex-1 px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500 dark:bg-gray-800 dark:text-gray-200"},null,512),[[we,R.value]]),e("button",{onClick:Q,class:se(["px-3 py-1.5 text-sm bg-pink-500 hover:bg-pink-600 text-white rounded-md",{"opacity-50 cursor-not-allowed":!R.value.trim()}]),disabled:!R.value.trim()}," 创建 ",10,iu)]),e("div",cu,[e("button",{onClick:y[2]||(y[2]=l=>{I.value=!1,R.value=""}),class:"text-xs text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"}," 取消 ")])])):z("",!0)]),e("div",du,[e("button",{onClick:y[4]||(y[4]=l=>D("1")),class:se(["w-full text-left px-3 py-2 text-sm rounded-md flex items-center justify-between",[p.value==="1"?"bg-pink-100 dark:bg-pink-900/30 text-pink-700 dark:text-pink-300":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800",K("1")?"border-l-4 border-blue-500":""]])},[e("div",uu,[e("div",{class:se(["mr-2 h-4 w-4 rounded border border-gray-400 flex items-center justify-center",{"bg-blue-500 border-blue-500":K("1")}]),onClick:y[3]||(y[3]=ge(l=>G("1",l),["stop"]))},[K("1")?(i(),c("svg",gu,hu)):z("",!0)],2),pu,Z(" 全部文件夹 ")]),K("1")?(i(),c("span",fu," 已选 ")):z("",!0)],2),(i(!0),c(ue,null,xe(h.value,l=>(i(),c("button",{key:l.id,onClick:n=>D(l.id),class:se(["w-full text-left px-3 py-2 text-sm rounded-md flex items-center justify-between group relative",[p.value===l.id?"bg-pink-100 dark:bg-pink-900/30 text-pink-700 dark:text-pink-300":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800",K(l.id)?"border-l-4 border-blue-500":""]])},[e("div",yu,[e("div",{class:se(["mr-2 h-4 w-4 rounded border border-gray-400 flex items-center justify-center",{"bg-blue-500 border-blue-500":K(l.id)}]),onClick:ge(n=>G(l.id,n),["stop"])},[K(l.id)?(i(),c("svg",wu,bu)):z("",!0)],10,ku),_u,e("span",$u,J(l.name),1)]),e("div",Iu,[K(l.id)?(i(),c("span",Cu," 已选 ")):z("",!0),e("span",Su,J(l.count),1),e("button",{onClick:ge(n=>L(l.id),["stop"]),class:"ml-2 p-1 text-red-500 hover:text-red-700 opacity-0 group-hover:opacity-100 transition-opacity",title:"删除文件夹"},Au,8,Tu)])],10,mu))),128))])]),e("div",Lu,[e("div",ju,[e("h4",Nu,[Z(J(H.value)+" ",1),e("span",Eu," (已选择 "+J(N.value.length)+" 个文件夹, "+J($.value.length)+" 个素材) ",1)]),e("div",Uu,[e("input",{ref_key:"fileInputRef",ref:m,type:"file",multiple:"",accept:"image/*",class:"hidden",onChange:ee},null,544),e("button",{onClick:y[5]||(y[5]=l=>E(l)),class:se(["w-full sm:w-auto px-3 py-1.5 text-sm bg-pink-500 hover:bg-pink-600 text-white rounded-md flex items-center justify-center",{"opacity-50 cursor-not-allowed":!p.value||p.value==="1"||P.value}]),disabled:!p.value||p.value==="1"||P.value},[P.value?(i(),c("svg",Qu,Ru)):(i(),c("svg",Du,Pu)),Z(" "+J(P.value?"上传中...":"上传素材"),1)],10,Bu)])]),p.value==="1"?(i(),c("div",Ou,Hu)):z("",!0),e("div",Gu,[N.value.length>0||$.value.length>0?(i(),c("div",Wu,[e("div",Ju,[N.value.length>0?(i(),c("div",Ku,[Zu,e("span",Xu,"已选择 "+J(N.value.length)+" 个文件夹",1)])):z("",!0),$.value.length>0?(i(),c("div",Yu,[eg,e("span",tg,"已选择 "+J($.value.length)+" 个素材",1)])):z("",!0)])])):z("",!0),r.value?(i(),c("div",og,rg)):x.value.length===0&&!r.value?(i(),c("div",ag,[e("div",ng,[lg,ig,p.value&&p.value!=="1"?(i(),c("button",{key:0,onClick:E,class:"px-4 py-2 bg-pink-500 hover:bg-pink-600 text-white rounded-md inline-flex items-center"},[cg,Z(" 上传素材 ")])):p.value==="1"?(i(),c("div",dg," 请选择一个具体的文件夹来上传素材 ")):z("",!0)])])):(i(),c("div",ug,[(i(!0),c(ue,null,xe(x.value,l=>(i(),c("div",{key:l.id,class:se(["relative group aspect-square rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-all duration-200 cursor-pointer touch-manipulation",{"ring-2 ring-pink-500":j(l.id)}]),onClick:n=>S(l.id)},[l.status==="expired"?(i(),c("div",vg," 已过期 ")):z("",!0),l.status!=="expired"?(i(),c("div",hg," 已上传 ")):z("",!0),e("img",{src:l.previewUrl,class:se(["w-full h-full object-cover",{"opacity-70":l.status==="expired"}]),alt:"素材图片",loading:"lazy"},null,10,pg),e("div",fg,[e("div",mg,[e("button",{onClick:ge(n=>ne(l.id),["stop"]),class:"p-2 bg-red-500 hover:bg-red-600 text-white rounded-full active:scale-95 transition-transform",title:"删除素材"},wg,8,yg),e("button",{onClick:ge(n=>S(l.id),["stop"]),class:se([j(l.id)?"bg-gray-500 hover:bg-gray-600":"bg-pink-500 hover:bg-pink-600","p-2 text-white rounded-full active:scale-95 transition-transform"]),title:j(l.id)?"取消选择":"选择素材"},[j(l.id)?(i(),c("svg",bg,$g)):(i(),c("svg",Ig,Sg))],10,xg)])]),j(l.id)?(i(),c("div",Tg,Ag)):z("",!0)],10,gg))),128))]))]),e("div",Lg,[e("button",{onClick:T,class:"flex-1 sm:flex-none px-3 sm:px-4 py-2 mr-2 sm:mr-3 text-sm bg-gray-500 hover:bg-gray-600 text-white rounded-md flex items-center justify-center"},[jg,Z(" 取消 ")]),e("button",{onClick:C,class:se(["flex-1 sm:flex-none px-3 sm:px-4 py-2 text-sm bg-green-500 hover:bg-green-600 text-white rounded-md flex items-center justify-center",{"opacity-50 cursor-not-allowed":N.value.length===0&&$.value.length===0}]),disabled:N.value.length===0&&$.value.length===0},[Eg,Z(" 确定选择 ")],10,Ng)])])])])])):z("",!0)}});const Bg=He(Ug,[["__scopeId","data-v-2f577c52"]]),ft=o=>(Oe("data-v-55a3c3be"),o=o(),qe(),o),Dg={class:"mb-6 bg-pink-50 dark:bg-pink-900/20 border border-pink-200 dark:border-pink-800/40 rounded-lg p-4 transition-all duration-300"},Fg={class:"flex justify-between items-center mb-3"},Pg=ft(()=>e("h3",{class:"text-lg font-medium text-pink-700 dark:text-pink-300 flex items-center"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})]),Z(" 已选择模板 ")],-1)),Qg={class:"flex gap-2"},zg=ft(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)),Vg=[zg],Rg={class:"bg-white dark:bg-gray-800 rounded-md p-4 max-h-[400px] overflow-auto border border-gray-200 dark:border-gray-700"},Og={class:"grid grid-cols-1 gap-4"},qg={class:"absolute top-2 left-2 z-10"},Hg={class:"absolute top-2 right-2 z-10"},Gg=["onClick"],Wg=ft(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)),Jg=[Wg],Kg={class:"p-4 pt-8"},Zg={class:"mb-3 flex justify-between items-start"},Xg={class:"font-medium text-gray-800 dark:text-gray-200 text-lg flex items-center"},Yg=ft(()=>e("span",{class:"mr-2 text-gray-500 dark:text-gray-400 cursor-move",title:"拖动排序"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"})])],-1)),ev={class:"flex flex-col md:flex-row gap-4"},tv={key:0,class:"md:w-1/3"},ov=["src","alt"],sv={class:"whitespace-pre-wrap text-gray-700 dark:text-gray-300 text-sm line-clamp-3 bg-gray-50 dark:bg-gray-900 p-3 rounded-md"},rv={class:"flex justify-end mt-2"},av={class:"text-xs text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-800 px-2 py-1 rounded-md"},nv={key:0,class:"text-center py-8 text-gray-500 dark:text-gray-400"},lv=de({__name:"TemplateDisplay",props:{templates:{}},emits:["close","remove"],setup(o,{emit:a}){const t=a;function s(h){const x=h.target;x.src='data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 24 24"%3E%3Cpath fill="%23cccccc" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"%3E%3C/path%3E%3C/svg%3E'}function r(h){t("remove",h)}return(h,x)=>(i(),c("div",Dg,[e("div",Fg,[Pg,e("div",Qg,[e("button",{onClick:x[0]||(x[0]=p=>h.$emit("close")),class:"p-1 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700",title:"关闭模板"},Vg)])]),e("div",Rg,[e("div",Og,[(i(!0),c(ue,null,xe(h.templates,(p,$)=>(i(),c("div",{key:$,class:se(["relative border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-all duration-200",[$===0?"border-l-4 border-l-pink-500":"border-l-4 border-l-blue-500",$===0?"bg-pink-50/30 dark:bg-pink-900/10":$%2===0?"bg-blue-50/30 dark:bg-blue-900/10":""]])},[e("div",qg,[e("span",{class:se(["inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-white rounded-full",$===0?"bg-pink-500":"bg-blue-500"])},J($===0?"主模板":`模板 ${$+1}`),3)]),e("div",Hg,[e("button",{onClick:ge(R=>r($),["stop"]),class:"p-1 text-gray-500 hover:text-red-500 dark:text-gray-400 dark:hover:text-red-400 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700",title:"删除模板"},Jg,8,Gg)]),e("div",Kg,[e("div",Zg,[e("h4",Xg,[Yg,e("span",{class:se(["font-bold",$===0?"text-pink-600 dark:text-pink-400":"text-blue-600 dark:text-blue-400"])},J(p.title),3)])]),e("div",ev,[p.coverImage?(i(),c("div",tv,[e("img",{src:p.coverImage,alt:p.title,class:"w-full h-[120px] object-cover rounded-md border border-gray-200 dark:border-gray-700",onError:s},null,40,ov)])):z("",!0),e("div",{class:se(p.coverImage?"md:w-2/3":"w-full")},[e("div",sv,J(p.content.substring(0,150))+J(p.content.length>150?"...":""),1),e("div",rv,[e("span",av,J(p.content.length)+" 字符 ",1)])],2)])])],2))),128))]),h.templates.length===0?(i(),c("div",nv," 尚未选择任何模板 ")):z("",!0)])]))}});const iv=He(lv,[["__scopeId","data-v-55a3c3be"]]),be=o=>(Oe("data-v-138ceee9"),o=o(),qe(),o),cv={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70 backdrop-blur-sm"},dv={class:"w-[900px] max-w-[95vw] max-h-[90vh] flex flex-col bg-white dark:bg-gray-800 rounded-lg overflow-hidden shadow-xl border border-gray-200 dark:border-gray-700"},uv={class:"flex justify-between items-center p-4 bg-gray-50 dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700"},gv=be(()=>e("h3",{class:"text-lg font-bold text-gray-800 dark:text-gray-200 flex items-center"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2 text-pink-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})]),Z(" 笔记模板市场 ")],-1)),vv={class:"flex items-center gap-2"},hv={class:"text-sm text-gray-500 dark:text-gray-400"},pv=be(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)),fv=[pv],mv={class:"p-4 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800"},yv={class:"flex flex-col sm:flex-row gap-4"},kv={class:"flex-1"},wv={class:"relative"},xv=be(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1)),bv=[xv],_v={class:"sm:w-48"},$v=be(()=>e("option",{value:"createTime"},"最新优先",-1)),Iv=be(()=>e("option",{value:"likesCount"},"热门优先",-1)),Cv=be(()=>e("option",{value:"viewsCount"},"多人查看",-1)),Sv=be(()=>e("option",{value:"title"},"标题排序",-1)),Tv=[$v,Iv,Cv,Sv],Mv={class:"sm:w-48"},Av=be(()=>e("option",{value:"DESC"},"降序",-1)),Lv=be(()=>e("option",{value:"ASC"},"升序",-1)),jv=[Av,Lv],Nv={class:"mt-4 flex items-center"},Ev=be(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"})],-1)),Uv={class:"mt-4"},Bv={class:"text-sm text-gray-500 dark:text-gray-400 mb-2 flex justify-between items-center"},Dv={key:0,class:"text-xs"},Fv={class:"overflow-x-auto pb-2 custom-scrollbar"},Pv={class:"flex space-x-2 min-w-max"},Qv=["onClick"],zv={class:"flex-1 overflow-auto p-4 bg-gray-50 dark:bg-gray-900"},Vv={key:0,class:"flex justify-center my-12"},Rv=be(()=>e("div",{class:"spinner"},null,-1)),Ov=[Rv],qv={key:1,class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6"},Hv=["onClick"],Gv={class:"aspect-w-3 aspect-h-4 bg-gray-100 dark:bg-gray-700 relative"},Wv=["src","alt","onError"],Jv={key:1,class:"w-full h-full flex items-center justify-center text-gray-400"},Kv=be(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-12 w-12",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),Zv=[Kv],Xv=["onClick"],Yv=be(()=>e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"},null,-1)),e2=[Yv],t2={class:"p-4 flex-1 flex flex-col"},o2=["title"],s2=["title"],r2={class:"mt-auto pt-2 border-t border-gray-100 dark:border-gray-700"},a2={class:"flex justify-between items-center text-xs text-gray-500 dark:text-gray-400"},n2={class:"flex items-center gap-1 px-1"},l2=be(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1)),i2={class:"flex items-center gap-1"},c2=be(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})],-1)),d2=["onClick"],u2={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},g2=be(()=>e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5 13l4 4L19 7"},null,-1)),v2=[g2],h2={key:2,class:"text-center py-12 bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700"},p2=be(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-16 w-16 mx-auto text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),f2=be(()=>e("p",{class:"mt-4 text-gray-600 dark:text-gray-400"},"暂无笔记模板",-1)),m2={key:3,class:"mt-8 flex justify-center"},y2={class:"flex space-x-2"},k2=["disabled"],w2=["onClick"],x2=["disabled"],b2={class:"p-4 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 flex justify-between items-center"},_2={class:"text-sm text-gray-600 dark:text-gray-400"},$2={class:"flex gap-2"},I2=["disabled"],C2=de({__name:"TemplateMarketModal",props:{visible:{type:Boolean}},emits:["close","select"],setup(o,{emit:a}){const t=o,s=a,r=_([]),h=_([]),x=_(!1),p=_(""),$=_("createTime"),R=_("DESC"),I=_(1),P=_(12),m=_(0),N=_(0),Y=_([]),H=_(null),q=_(""),w=_("info"),b=_(!1),D=re(()=>{const u=[];if(N.value<=5)for(let l=1;l<=N.value;l++)u.push(l);else{let l=Math.max(I.value-Math.floor(2.5),1),n=l+5-1;n>N.value&&(n=N.value,l=Math.max(n-5+1,1));for(let v=l;v<=n;v++)u.push(v)}return u});function G(u,y="info"){q.value=u,w.value=y,setTimeout(()=>{q.value=""},3e3)}async function K(u){try{x.value=!0,I.value=u;const y={page:u,pageSize:P.value,orderBy:$.value,orderDirection:R.value,withUserStatus:!0,favoriteOnly:b.value};p.value&&(y.title=p.value),H.value!==null&&(y.typeId=H.value);const l=["/xiaohongshu/note-template-market/list","/xiaohongshu/note/list"];let n=null,v=null;for(const U of l)try{console.log("尝试API路径:",U,"参数:",y);const V=await kt.get(U,{params:y});console.log("获取模板列表响应:",V);let O=V.data;if(O.code===200&&O.data&&typeof O.data=="object"&&O.data.code!==void 0&&(O=O.data),O&&(O.code===0||O.code===200)){n=O;break}}catch(V){console.warn(`API ${U} 请求失败:`,V),v=V}if(!n){console.warn("所有API路径均请求失败，使用测试数据"),r.value=T(),m.value=30,N.value=Math.ceil(m.value/P.value),G("无法连接到服务器，显示测试数据","info");return}const f=n.data;f.content?r.value=f.content:f.items?r.value=f.items:f.list?r.value=f.list:Array.isArray(f)?r.value=f:(r.value=[],console.error("无法找到模板列表数据")),f.totalElements!==void 0?m.value=f.totalElements:f.total!==void 0?m.value=f.total:f.count!==void 0?m.value=f.count:m.value=r.value.length,f.totalPages!==void 0?N.value=f.totalPages:N.value=Math.ceil(m.value/P.value),console.log(`已加载${r.value.length}条模板数据，总数:${m.value}，总页数:${N.value}`)}catch(y){console.error("获取模板列表失败:",y),G(y.message||"获取模板列表失败","error"),r.value=T(),m.value=30,N.value=Math.ceil(m.value/P.value)}finally{x.value=!1}}async function Q(){try{const u=await kt.get("/xiaohongshu/notetype/list");console.log("获取笔记类型响应:",u);let y=u.data;if(y.code===200&&y.data&&typeof y.data=="object"&&y.data.code!==void 0&&(y=y.data),y&&(y.code===0||y.code===200)){const l=y.data;l.items?Y.value=l.items:Array.isArray(l)?Y.value=l:(console.error("无法解析笔记类型数据"),Y.value=[]),Y.value=Y.value.filter(n=>n.status!==!1),Y.value.sort((n,v)=>{const f=n.sort||0,U=v.sort||0;return f-U})}else console.error("获取笔记类型列表失败:",y==null?void 0:y.message),Y.value=[]}catch(u){console.error("获取笔记类型失败:",u),Y.value=[]}}function E(u){H.value=u,K(1)}function ee(){if(H.value===null)return"全部";const u=Y.value.find(y=>y.id===H.value);return u?u.name:"未知分类"}function ne(u,y){const l=u.target;l.src='data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 24 24"%3E%3Cpath fill="%23cccccc" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"%3E%3C/path%3E%3C/svg%3E'}function S(u){return h.value.some(y=>y.id===u.id)}function j(u){const y=h.value.findIndex(l=>l.id===u.id);y>=0?h.value.splice(y,1):h.value.push(u)}function C(){if(h.value.length===0){G("请至少选择一个模板","error");return}s("select",h.value),s("close")}function T(){const u=[];for(let y=1;y<=12;y++)u.push({id:y,title:`测试模板 ${y}`,content:`这是一个测试模板内容，用于在API不可用时显示。这是模板 ${y} 的内容。`,coverImage:`https://via.placeholder.com/300x200?text=Template+${y}`,typeId:y%3+1,createTime:new Date().toISOString(),updateTime:new Date().toISOString(),likesCount:Math.floor(Math.random()*100),viewsCount:Math.floor(Math.random()*500),source:"test"});return u}function L(){b.value=!b.value,K(1)}async function X(u){var y;try{if(!u.id){G("模板ID不存在","error");return}const l=(y=u.userStatus)==null?void 0:y.favorited,n=`/xiaohongshu/note-template-market/${u.id}/${l?"unfavorite":"favorite"}`,v=await kt.post(n);console.log("收藏状态切换响应:",v);let f=v.data;f.code===200&&f.data&&typeof f.data=="object"&&f.data.code!==void 0&&(f=f.data),f&&(f.code===0||f.code===200)?(u.userStatus?u.userStatus.favorited=!l:u.userStatus={favorited:!l,liked:!1},G(l?"已取消收藏":"已收藏","success"),b.value&&l&&(r.value=r.value.filter(U=>U.id!==u.id),m.value=Math.max(0,m.value-1),N.value=Math.ceil(m.value/P.value),r.value.length===0&&I.value>1&&K(I.value-1))):G((f==null?void 0:f.message)||"操作失败","error")}catch(l){console.error("切换收藏状态失败:",l),G(l.message||"操作失败","error")}}return fe(()=>t.visible,u=>{u&&(Q(),K(1))}),Te(()=>{t.visible&&(Q(),K(1))}),(u,y)=>u.visible?(i(),c("div",cv,[e("div",dv,[e("div",uv,[gv,e("div",vv,[e("span",hv,"已选择: "+J(h.value.length),1),e("button",{onClick:y[0]||(y[0]=l=>u.$emit("close")),class:"p-1 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700",title:"关闭"},fv)])]),e("div",mv,[e("div",yv,[e("div",kv,[e("div",wv,[ce(e("input",{"onUpdate:modelValue":y[1]||(y[1]=l=>p.value=l),type:"text",placeholder:"搜索笔记模板...",class:"w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200",onKeyup:y[2]||(y[2]=ct(l=>K(1),["enter"]))},null,544),[[we,p.value]]),e("button",{class:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-pink-500",onClick:y[3]||(y[3]=l=>K(1))},bv)])]),e("div",_v,[ce(e("select",{"onUpdate:modelValue":y[4]||(y[4]=l=>$.value=l),class:"w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200",onChange:y[5]||(y[5]=l=>K(1))},Tv,544),[[xt,$.value]])]),e("div",Mv,[ce(e("select",{"onUpdate:modelValue":y[6]||(y[6]=l=>R.value=l),class:"w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200",onChange:y[7]||(y[7]=l=>K(1))},jv,544),[[xt,R.value]])])]),e("div",Nv,[e("button",{onClick:L,class:se(["px-4 py-2 rounded-md text-sm font-medium shadow-sm flex items-center mr-4",b.value?"bg-pink-500 text-white":"bg-gray-100 text-gray-800 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600"])},[Ev,Z(" "+J(b.value?"我的收藏":"全部模板"),1)],2)]),e("div",Uv,[e("div",Bv,[e("span",null,J(H.value===null?"显示全部笔记类型":`当前分类: ${ee()}`),1),Y.value.length>0?(i(),c("span",Dv,"共 "+J(Y.value.length)+" 个分类",1)):z("",!0)]),e("div",Fv,[e("div",Pv,[e("button",{class:se(["px-4 py-2 rounded-md transition-colors text-sm font-medium shadow-sm flex-shrink-0",H.value===null?"bg-pink-500 text-white":"bg-gray-100 text-gray-800 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600"]),onClick:y[8]||(y[8]=l=>E(null))}," 全部 ",2),(i(!0),c(ue,null,xe(Y.value,l=>(i(),c("button",{key:l.id,class:se(["px-4 py-2 rounded-md transition-colors text-sm font-medium shadow-sm flex-shrink-0",H.value===l.id?"bg-pink-500 text-white":"bg-gray-100 text-gray-800 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600"]),onClick:n=>E(l.id)},J(l.name),11,Qv))),128))])])])]),e("div",zv,[x.value?(i(),c("div",Vv,Ov)):r.value.length>0?(i(),c("div",qv,[(i(!0),c(ue,null,xe(r.value,l=>{var n;return i(),c("div",{key:l.id,class:"border rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-all duration-300 bg-white dark:bg-gray-800 dark:border-gray-700 cursor-pointer relative flex flex-col",onClick:v=>j(l)},[e("div",Gv,[l.coverImage?(i(),c("img",{key:0,src:l.coverImage,alt:l.title,class:"object-cover w-full h-full",onError:v=>ne(v)},null,40,Wv)):(i(),c("div",Jv,Zv)),e("button",{class:"absolute top-2 right-2 p-1.5 rounded-full bg-white bg-opacity-80 hover:bg-opacity-100 dark:bg-gray-800 dark:bg-opacity-80 dark:hover:bg-opacity-100 transition-all duration-200 shadow-sm z-10",onClick:ge(v=>X(l),["stop"]),title:"收藏模板"},[(i(),c("svg",{xmlns:"http://www.w3.org/2000/svg",class:se(["h-5 w-5",(n=l.userStatus)!=null&&n.favorited?"text-pink-500 fill-pink-500":"text-gray-500 dark:text-gray-400"]),viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},e2,2))],8,Xv)]),e("div",t2,[e("h3",{class:"font-semibold text-gray-800 dark:text-gray-200 mb-2 line-clamp-2",title:l.title},J(l.title),9,o2),e("p",{class:"text-sm text-gray-600 dark:text-gray-400 mb-3 line-clamp-3",title:l.content},J(l.content),9,s2),e("div",r2,[e("div",a2,[e("span",n2,[l2,e("span",null,J(l.viewsCount||0),1)]),e("span",i2,[c2,e("span",null,J(l.likesCount||0),1)])]),e("button",{class:se(["w-full mt-2 px-3 py-2 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 text-sm font-medium rounded-md hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors flex items-center justify-center",{"bg-pink-100 dark:bg-pink-900 text-pink-700 dark:text-pink-300 hover:bg-pink-200 dark:hover:bg-pink-800":S(l)}]),onClick:ge(v=>j(l),["stop"])},[S(l)?(i(),c("svg",u2,v2)):z("",!0),Z(" "+J(S(l)?"已选择":"选择模板"),1)],10,d2)])])],8,Hv)}),128))])):(i(),c("div",h2,[p2,f2,e("button",{class:"mt-4 px-4 py-2 bg-pink-500 text-white rounded-md hover:bg-pink-600 transition-colors",onClick:y[9]||(y[9]=l=>K(1))}," 刷新 ")])),N.value>1?(i(),c("div",m2,[e("div",y2,[e("button",{class:"px-3 py-1 rounded-md bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors disabled:opacity-50",disabled:I.value===1,onClick:y[10]||(y[10]=l=>K(I.value-1))}," 上一页 ",8,k2),(i(!0),c(ue,null,xe(D.value,l=>(i(),c("button",{key:l,class:se(["px-3 py-1 rounded-md transition-colors",l===I.value?"bg-pink-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-600"]),onClick:n=>K(l)},J(l),11,w2))),128)),e("button",{class:"px-3 py-1 rounded-md bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors disabled:opacity-50",disabled:I.value===N.value,onClick:y[11]||(y[11]=l=>K(I.value+1))}," 下一页 ",8,x2)])])):z("",!0)]),e("div",b2,[e("div",_2," 已选择 "+J(h.value.length)+" 个模板 ",1),e("div",$2,[e("button",{onClick:y[12]||(y[12]=l=>u.$emit("close")),class:"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"}," 取消 "),e("button",{onClick:C,class:"px-4 py-2 bg-pink-500 text-white rounded-md hover:bg-pink-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:h.value.length===0}," 确认选择 ("+J(h.value.length)+") ",9,I2)])])])])):z("",!0)}});const S2=He(C2,[["__scopeId","data-v-138ceee9"]]),me=o=>(Oe("data-v-32c53af3"),o=o(),qe(),o),T2={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70 backdrop-blur-sm"},M2={class:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-xl border border-gray-200 dark:border-gray-700 w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col"},A2=me(()=>e("h3",{class:"text-xl font-bold text-gray-800 dark:text-gray-200 flex items-center"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 mr-2 text-pink-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})]),Z(" 编辑笔记 ")],-1)),L2=me(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)),j2=[L2],N2={class:"flex-1 overflow-y-auto"},E2={key:0,class:"flex items-center justify-center h-full"},U2=me(()=>e("div",{class:"flex flex-col items-center"},[e("div",{class:"h-10 w-10 border-4 border-t-pink-500 rounded-full animate-spin mb-4"}),e("p",{class:"text-gray-600 dark:text-gray-300"},"加载笔记中...")],-1)),B2=[U2],D2={key:1,class:"flex items-center justify-center h-full"},F2={class:"text-center p-4"},P2=me(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-12 w-12 text-red-500 mx-auto mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),Q2={class:"text-red-500 mb-4"},z2={key:0,class:"p-3 bg-gray-50 dark:bg-gray-700 rounded-md mb-4"},V2={class:"flex items-center text-sm font-medium text-gray-700 dark:text-gray-300"},R2=me(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2 text-gray-500 dark:text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z"})],-1)),O2={class:"ml-1 font-semibold"},q2={key:1,class:"space-y-6"},H2=me(()=>e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"视频封面",-1)),G2={key:0,class:"mb-4"},W2={class:"relative rounded-lg overflow-hidden border border-gray-200 dark:border-gray-700 group max-w-md mx-auto"},J2=["src"],K2={class:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-40 transition-all duration-200 flex items-center justify-center opacity-0 group-hover:opacity-100"},Z2=me(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)),X2=[Z2],Y2={class:"flex space-x-3"},eh={for:"cover-upload",class:"flex items-center justify-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 cursor-pointer"},th=me(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),oh=me(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})],-1)),sh={key:1,class:"mt-3 flex"},rh=me(()=>e("label",{for:"video",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"视频链接",-1)),ah={key:0,class:"mb-4"},nh=me(()=>e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"视频预览",-1)),lh={class:"rounded-lg overflow-hidden border border-gray-200 dark:border-gray-700"},ih={controls:"",class:"w-full h-auto",preload:"metadata"},ch=["src"],dh={key:2},uh=me(()=>e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"图片",-1)),gh={key:0,class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3 mb-4"},vh=["src","onError","onClick"],hh={class:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-40 transition-all duration-200 flex items-center justify-center opacity-0 group-hover:opacity-100"},ph=["onClick"],fh=me(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)),mh=[fh],yh={class:"flex space-x-3"},kh={for:"image-upload",class:"flex items-center justify-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 cursor-pointer"},wh=me(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),xh=me(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})],-1)),bh={key:1,class:"mt-3 flex"},_h=me(()=>e("label",{for:"title",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"标题",-1)),$h=me(()=>e("label",{for:"content",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"内容",-1)),Ih={class:"flex justify-end space-x-3 mt-6 pt-4 border-t border-gray-200 dark:border-gray-700"},Ch=["disabled"],Sh={key:0},Th={key:1,class:"flex items-center"},Mh=me(()=>e("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),Ah={key:1,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-70 backdrop-blur-sm"},Lh={class:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-xl border border-gray-200 dark:border-gray-700 w-full max-w-4xl"},jh=me(()=>e("h3",{class:"text-lg font-bold text-gray-800 dark:text-gray-200"}," 图片预览 ",-1)),Nh=me(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)),Eh=[Nh],Uh={class:"flex justify-center"},Bh=["src"],Dh=de({__name:"EditNoteModal",props:{visible:{type:Boolean},noteId:{}},emits:["update:visible","success","error"],setup(o,{emit:a}){const t=It(),s=o,r=a,h=_(!1),x=_(!1),p=_(""),$=_(!1),R=_(""),I=_(!1),P=_(""),m=zt({title:"",content:"",images:[],type:"",video:"",cover:""}),N=zt({title:"",content:"",images:[],type:"",video:"",cover:""}),Y=_(!1),H=_("");fe(()=>s.visible,async l=>{l&&s.noteId?await q():w()}),fe(()=>s.noteId,async l=>{s.visible&&l&&await q()});async function q(){if(s.noteId){h.value=!0,p.value="";try{const l=t.token||localStorage.getItem("token");if(!l){p.value="未登录或认证已过期，请重新登录";return}console.log("正在获取笔记数据，ID:",s.noteId);const n=await Vt.get(`/api/xhs/${encodeURIComponent(s.noteId)}`,{headers:{Authorization:`Bearer ${l}`}});console.log("获取笔记数据响应:",n.data);let v;n.data&&n.data.data&&n.data.data.data?v=n.data.data.data:n.data&&n.data.data?v=n.data.data:v=n.data,v?(console.log("解析到的笔记数据:",v),m.title=v.title||"",m.content=v.content||"",m.images=v.images||[],m.type=v.type||"",m.video=v.video||"",m.cover=v.cover||"",N.title=v.title||"",N.content=v.content||"",N.images=[...v.images||[]],N.type=v.type||"",N.video=v.video||"",N.cover=v.cover||""):(p.value="获取笔记数据失败，返回数据格式不正确",console.error("无法解析笔记数据:",n.data))}catch(l){console.error("获取笔记数据失败:",l),l.response&&l.response.status===401?p.value="认证失败，请重新登录":l.response&&l.response.status===404?p.value="笔记不存在或已被删除":p.value=l.message||"获取笔记数据失败，请稍后重试"}finally{h.value=!1}}}function w(){m.title="",m.content="",m.images=[],N.title="",N.content="",N.images=[],N.type="",N.video="",N.cover="",p.value="",$.value=!1,R.value="",I.value=!1,P.value=""}function b(){D()&&!confirm("有未保存的修改，确定要关闭吗？")||(r("update:visible",!1),w())}function D(){return m.title!==N.title||m.content!==N.content||!G(m.images,N.images)||m.type!==N.type||m.video!==N.video||m.cover!==N.cover}function G(l,n){if(l.length!==n.length)return!1;for(let v=0;v<l.length;v++)if(l[v]!==n[v])return!1;return!0}async function K(){var l;if(!s.noteId){console.error("提交失败：noteId为空");return}if(console.log("开始处理表单提交，noteId:",s.noteId),!D()){console.log("没有检测到修改，关闭弹窗"),r("update:visible",!1);return}x.value=!0,p.value="";try{const n={};if(m.title!==N.title&&(n.title=m.title||"",console.log("检测到标题修改")),m.content!==N.content&&(n.content=m.content||"",console.log("检测到内容修改")),G(m.images,N.images)||(n.images=m.images||[],console.log("检测到图片修改")),m.type!==N.type&&(n.type=m.type||"",console.log("检测到类型修改")),m.video!==N.video&&(n.video=m.video||"",console.log("检测到视频修改")),m.cover!==N.cover&&(n.cover=m.cover||"",console.log("检测到封面修改")),Object.keys(n).length===0){console.log("没有字段被修改，关闭弹窗"),r("update:visible",!1);return}const v=t.token||localStorage.getItem("token");if(!v){p.value="未登录或认证已过期，请重新登录",console.error("提交失败：未找到有效token");return}const f=`/api/xhs/${encodeURIComponent(s.noteId)}`;console.log(`准备发送PATCH请求到: ${f}`),console.log("请求头:",{Authorization:`Bearer ${v.substring(0,10)}...`,"Content-Type":"application/json"}),console.log("请求体:",JSON.stringify(n,null,2));const U=await Vt({method:"PATCH",url:f,data:n,headers:{Authorization:`Bearer ${v}`,"Content-Type":"application/json"}});console.log("收到更新响应:",{status:U.status,statusText:U.statusText,headers:U.headers,data:U.data});let V=U.data,O=!1;if(V.data&&V.data.code===200?(O=!0,console.log("检测到嵌套成功响应"),r("success",V.data.data)):V.code===200?(O=!0,console.log("检测到直接成功响应"),r("success",V.data)):console.warn("未检测到成功状态码:",V),O){console.log("更新成功，关闭弹窗"),r("update:visible",!1);return}throw console.error("未检测到成功状态，抛出错误"),new Error(V.message||((l=V.data)==null?void 0:l.message)||"更新笔记失败")}catch(n){if(console.error("更新笔记失败，详细错误:",n),n.config&&console.error("请求配置:",{url:n.config.url,method:n.config.method,headers:n.config.headers,data:n.config.data}),n.response){const v=n.response.status,f=n.response.data;console.error(`服务器返回错误(${v}):`,{data:f,headers:n.response.headers}),v===401?p.value="认证失败，请重新登录":v===403?p.value="您没有权限修改此笔记":v===404?p.value="笔记不存在或已被删除":v===500?f&&f.message?(p.value=`服务器错误: ${f.message}`,console.error("服务器错误详情:",f.message)):(p.value="服务器内部错误，请稍后重试",console.error("服务器返回500错误，但没有详细信息"),Q()):p.value=(f==null?void 0:f.message)||`请求失败(${v})`}else n.request?(console.error("请求已发送但没有收到响应:",n.request),p.value="服务器无响应，请检查网络连接"):(console.error("请求设置错误:",n.message),p.value=n.message||"更新笔记失败，请稍后重试");r("error",p.value)}finally{x.value=!1}}async function Q(){if(s.noteId){console.log("尝试备用更新方法...");try{const l=t.token||localStorage.getItem("token");if(!l)return;const n={title:m.title||"",content:m.content||""};console.log("使用备用方法发送请求，数据:",n);const v=await fetch(`/api/xhs/${encodeURIComponent(s.noteId)}`,{method:"PATCH",headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"},body:JSON.stringify(n)}),f=await v.json();console.log("备用方法响应:",f),v.ok&&(console.log("备用方法更新成功"),r("success",f.data),r("update:visible",!1))}catch(l){console.error("备用更新方法也失败:",l)}}}async function E(l){const n=l.target;if(!n.files||n.files.length===0)return;const v=Array.from(n.files),f=v.filter(U=>{const V=U.type.startsWith("image/"),O=U.size<=10*1024*1024;return V&&O});if(f.length!==v.length&&alert("部分文件无效。请确保所有文件都是图片且大小不超过10MB。"),f.length!==0){for(const U of f)try{const V=await ee(U);m.images.push(V)}catch(V){console.error("转换图片失败:",V)}n.value=""}}function ee(l){return new Promise((n,v)=>{const f=new FileReader;f.readAsDataURL(l),f.onload=()=>n(f.result),f.onerror=U=>v(U)})}function ne(l,n){const v=l.target;v.src="https://via.placeholder.com/150?text=图片加载失败"}function S(l){m.images.splice(l,1)}function j(){$.value=!0,R.value="",setTimeout(()=>{const l=document.querySelector('input[placeholder="输入图片URL"]');l&&l.focus()},100)}function C(){R.value.trim()&&(m.images.push(R.value.trim()),R.value="",$.value=!1)}function T(l){H.value=l,Y.value=!0}function L(){Y.value=!1}async function X(l){const n=l.target;if(!n.files||n.files.length===0)return;const v=n.files[0],f=v.type.startsWith("image/"),U=v.size<=10*1024*1024;if(!f||!U){alert("封面图片无效。请确保文件是图片且大小不超过10MB。");return}try{const V=await ee(v);m.cover=V}catch(V){console.error("转换封面图片失败:",V)}n.value=""}function u(){I.value=!0,P.value="",setTimeout(()=>{const l=document.querySelector('input[placeholder="输入封面图片URL"]');l&&l.focus()},100)}function y(){P.value.trim()&&(m.cover=P.value.trim(),P.value="",I.value=!1)}return Te(async()=>{s.visible&&s.noteId&&await q()}),(l,n)=>(i(),c(ue,null,[l.visible?(i(),c("div",T2,[e("div",M2,[e("div",{class:"flex justify-between items-center mb-4 pb-3 border-b border-gray-200 dark:border-gray-700"},[A2,e("button",{onClick:b,class:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"},j2)]),e("div",N2,[h.value?(i(),c("div",E2,B2)):p.value?(i(),c("div",D2,[e("div",F2,[P2,e("p",Q2,J(p.value),1),e("button",{onClick:b,class:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 transition-all duration-200"}," 关闭 ")])])):(i(),c("form",{key:2,onSubmit:ge(K,["prevent"]),class:"space-y-6"},[m.type?(i(),c("div",z2,[e("div",V2,[R2,Z(" 笔记类型: "),e("span",O2,J(m.type==="video"?"视频":"图文"),1)])])):z("",!0),m.type==="video"?(i(),c("div",q2,[e("div",null,[H2,m.cover?(i(),c("div",G2,[e("div",W2,[e("img",{src:m.cover,class:"w-full h-auto object-contain max-h-[300px] cursor-pointer",onError:n[0]||(n[0]=v=>ne(v)),onClick:n[1]||(n[1]=v=>T(m.cover))},null,40,J2),e("div",K2,[e("button",{type:"button",onClick:n[2]||(n[2]=ge(v=>m.cover="",["stop"])),class:"p-1 bg-red-500 text-white rounded-full hover:bg-red-600 transition-all duration-200"},X2)])])])):z("",!0),e("div",Y2,[e("label",eh,[th,Z(" 上传封面图片 "),e("input",{id:"cover-upload",type:"file",accept:"image/*",class:"hidden",onChange:X},null,32)]),e("button",{type:"button",onClick:u,class:"flex items-center justify-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600"},[oh,Z(" 添加封面链接 ")])]),I.value?(i(),c("div",sh,[ce(e("input",{"onUpdate:modelValue":n[3]||(n[3]=v=>P.value=v),type:"text",class:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-l-md shadow-sm focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-pink-500 dark:bg-gray-700 dark:text-white",placeholder:"输入封面图片URL"},null,512),[[we,P.value]]),e("button",{type:"button",onClick:y,class:"px-4 py-2 bg-pink-500 text-white rounded-r-md hover:bg-pink-600 transition-all duration-200"}," 添加 ")])):z("",!0)]),e("div",null,[rh,ce(e("input",{id:"video","onUpdate:modelValue":n[4]||(n[4]=v=>m.video=v),type:"text",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-pink-500 dark:bg-gray-700 dark:text-white",placeholder:"视频链接URL"},null,512),[[we,m.video]])]),m.video?(i(),c("div",ah,[nh,e("div",lh,[e("video",ih,[e("source",{src:m.video,type:"video/mp4"},null,8,ch),Z(" 您的浏览器不支持视频播放 ")])])])):z("",!0)])):z("",!0),m.type!=="video"?(i(),c("div",dh,[uh,m.images&&m.images.length>0?(i(),c("div",gh,[(i(!0),c(ue,null,xe(m.images,(v,f)=>(i(),c("div",{key:f,class:"relative rounded-lg overflow-hidden border border-gray-200 dark:border-gray-700 group aspect-[3/4]"},[e("img",{src:v,class:"w-full h-full object-cover cursor-pointer",onError:U=>ne(U),onClick:U=>T(v)},null,40,vh),e("div",hh,[e("button",{type:"button",onClick:ge(U=>S(f),["stop"]),class:"p-1 bg-red-500 text-white rounded-full hover:bg-red-600 transition-all duration-200"},mh,8,ph)])]))),128))])):z("",!0),e("div",yh,[e("label",kh,[wh,Z(" 上传图片 "),e("input",{id:"image-upload",type:"file",accept:"image/*",multiple:"",class:"hidden",onChange:E},null,32)]),e("button",{type:"button",onClick:j,class:"flex items-center justify-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600"},[xh,Z(" 添加图片链接 ")])]),$.value?(i(),c("div",bh,[ce(e("input",{"onUpdate:modelValue":n[5]||(n[5]=v=>R.value=v),type:"text",class:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-l-md shadow-sm focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-pink-500 dark:bg-gray-700 dark:text-white",placeholder:"输入图片URL"},null,512),[[we,R.value]]),e("button",{type:"button",onClick:C,class:"px-4 py-2 bg-pink-500 text-white rounded-r-md hover:bg-pink-600 transition-all duration-200"}," 添加 ")])):z("",!0)])):z("",!0),e("div",null,[_h,ce(e("input",{id:"title","onUpdate:modelValue":n[6]||(n[6]=v=>m.title=v),type:"text",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-pink-500 dark:bg-gray-700 dark:text-white",placeholder:"笔记标题"},null,512),[[we,m.title]])]),e("div",null,[$h,ce(e("textarea",{id:"content","onUpdate:modelValue":n[7]||(n[7]=v=>m.content=v),rows:"10",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-pink-500 dark:bg-gray-700 dark:text-white",placeholder:"笔记内容"},null,512),[[we,m.content]])])],32))]),e("div",Ih,[e("button",{onClick:b,class:"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 transition-all duration-200"}," 取消 "),e("button",{onClick:K,disabled:x.value,class:"px-4 py-2 bg-pink-500 text-white rounded-md hover:bg-pink-600 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center"},[x.value?(i(),c("span",Th,[Mh,Z(" 保存中... ")])):(i(),c("span",Sh,"保存修改"))],8,Ch)])])])):z("",!0),Y.value?(i(),c("div",Ah,[e("div",Lh,[e("div",{class:"flex justify-between items-center mb-4"},[jh,e("button",{onClick:L,class:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"},Eh)]),e("div",Uh,[e("img",{src:H.value,alt:"预览图片",class:"max-w-full max-h-[70vh] object-contain"},null,8,Bh)])])])):z("",!0)],64))}});const Fh=He(Dh,[["__scopeId","data-v-32c53af3"]]),Ph={class:"mb-6"},Qh=e("label",{class:"block mb-2 text-sm font-medium text-gray-700 dark:text-gray-300"},[Z(" 补充信息 "),e("span",{class:"text-xs text-gray-500 dark:text-gray-400 ml-1"},"(选填)")],-1),zh=e("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"}," 补充信息将作为额外参数传递给工作流，帮助生成更精准的笔记内容 ",-1),Vh=de({__name:"AdditionalInformation",props:{modelValue:{}},emits:["update:modelValue"],setup(o,{emit:a}){const t=o,s=a,r=re({get:()=>t.modelValue||"",set:h=>s("update:modelValue",h)});return(h,x)=>(i(),c("div",Ph,[Qh,ce(e("textarea",{"onUpdate:modelValue":x[0]||(x[0]=p=>r.value=p),class:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-pink-500 dark:focus:ring-pink-400 focus:border-transparent transition-all duration-200",placeholder:"请输入补充信息，如产品特点、活动信息等，将传递给工作流",rows:"4"},null,512),[[we,r.value]]),zh]))}}),pe=o=>(Oe("data-v-e66ecc88"),o=o(),qe(),o),Rh={class:"h-full w-full relative overflow-hidden flex flex-col bg-white dark:bg-gray-900"},Oh={class:"flex-1 overflow-auto p-4 sm:p-6 md:p-8"},qh={class:"max-w-4xl mx-auto"},Hh=pe(()=>e("div",{class:"mb-8 text-center"},[e("h1",{class:"text-2xl sm:text-3xl font-bold text-gray-800 dark:text-gray-200 flex items-center justify-center"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mr-2 text-pink-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"})]),Z(" AI智能生成小红书笔记，快速打造品牌爆款内容 ")])],-1)),Gh=pe(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})],-1)),Wh={class:"mt-8 flex flex-col sm:flex-row sm:justify-between items-center space-y-3 sm:space-y-0"},Jh=["disabled"],Kh={key:0,class:"flex items-center"},Zh=pe(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1)),Xh={key:1,class:"flex items-center"},Yh=pe(()=>e("svg",{class:"animate-spin -ml-1 mr-2 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),ep=pe(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)),tp={key:0,class:"fixed inset-0 z-[9999] flex items-center justify-center bg-black bg-opacity-70 backdrop-blur-sm"},op={class:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-xl border border-gray-200 dark:border-gray-700 w-full max-w-md"},sp={class:"flex justify-between items-center mb-4"},rp=pe(()=>e("h3",{class:"text-lg font-bold text-gray-800 dark:text-gray-200"}," 选择发布平台 ",-1)),ap=pe(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)),np=[ap],lp={class:"grid grid-cols-1 gap-4 mb-4"},ip=Ke('<div class="flex flex-col items-center" data-v-e66ecc88><svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mb-2 text-purple-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-v-e66ecc88><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9" data-v-e66ecc88></path></svg><span class="font-medium text-gray-800 dark:text-gray-200" data-v-e66ecc88>全平台发布</span><span class="text-xs text-gray-500 dark:text-gray-400 mt-1" data-v-e66ecc88>不区分平台，所有笔记均可查看</span></div>',1),cp=[ip],dp=Ke('<div class="flex flex-col items-center" data-v-e66ecc88><svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mb-2 text-pink-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-v-e66ecc88><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" data-v-e66ecc88></path></svg><span class="font-medium text-gray-800 dark:text-gray-200" data-v-e66ecc88>小红书发布</span><span class="text-xs text-gray-500 dark:text-gray-400 mt-1" data-v-e66ecc88>仅显示小红书平台笔记</span></div>',1),up=[dp],gp=Ke('<div class="flex flex-col items-center" data-v-e66ecc88><svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mb-2 text-black dark:text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-v-e66ecc88><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" data-v-e66ecc88></path></svg><span class="font-medium text-gray-800 dark:text-gray-200" data-v-e66ecc88>抖音发布</span><span class="text-xs text-gray-500 dark:text-gray-400 mt-1" data-v-e66ecc88>仅显示抖音平台笔记</span></div>',1),vp=[gp],hp={key:1,class:"fixed inset-0 z-[990] flex items-center justify-center bg-black bg-opacity-70 backdrop-blur-sm"},pp={class:"w-[700px] h-[800px] max-w-[90vw] max-h-[90vh] flex flex-col bg-white dark:bg-gray-800 rounded-lg overflow-hidden shadow-xl"},fp=pe(()=>e("h3",{class:"text-lg font-bold text-gray-800 dark:text-gray-100 flex items-center"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2 text-pink-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]),Z(" 笔记详情 ")],-1)),mp=pe(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)),yp=[mp],kp={class:"flex-grow relative overflow-auto bg-white dark:bg-gray-800"},wp={key:0,class:"absolute inset-0 flex items-center justify-center bg-white bg-opacity-80 dark:bg-gray-800 dark:bg-opacity-80 z-10"},xp=pe(()=>e("div",{class:"flex flex-col items-center"},[e("div",{class:"h-10 w-10 border-4 border-t-pink-500 rounded-full animate-spin mb-4"}),e("p",{class:"text-gray-700 dark:text-gray-200"},"笔记加载中...")],-1)),bp=[xp],_p={key:1,class:"absolute inset-0 flex items-center justify-center bg-white bg-opacity-80 dark:bg-gray-800 dark:bg-opacity-80 z-10"},$p={class:"text-center p-4 rounded-lg bg-white dark:bg-gray-700 max-w-md shadow-lg"},Ip=pe(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-12 w-12 text-red-500 mx-auto mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),Cp={class:"text-gray-700 dark:text-gray-200 mb-4"},Sp={key:2,class:"p-6 text-gray-700 dark:text-gray-200"},Tp={class:"text-2xl font-bold mb-4 text-gray-800 dark:text-pink-300"},Mp={key:0,class:"mb-6"},Ap={class:"aspect-[16/9] relative"},Lp=["src"],jp=pe(()=>e("div",{class:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-30"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-16 w-16 text-white opacity-80",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),Np={key:1,class:"mb-4 rounded-lg overflow-hidden border border-gray-100 dark:border-gray-600 shadow-sm"},Ep={controls:"",class:"w-full h-auto",preload:"metadata"},Up=["src"],Bp=pe(()=>e("div",{class:"text-sm text-gray-500 dark:text-gray-400 mb-4 flex items-center"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})]),Z(" 视频类型笔记 ")],-1)),Dp={key:1,class:"mb-6 grid grid-cols-2 md:grid-cols-3 gap-4"},Fp=["onClick"],Pp={class:"aspect-[3/4]"},Qp=["src","alt"],zp={class:"prose dark:prose-invert max-w-none"},Vp={key:0,class:"whitespace-pre-wrap text-gray-700 dark:text-gray-300"},Rp={key:1,class:"text-gray-400 dark:text-gray-500 italic"},Op={class:"mt-6 pt-4 border-t border-gray-100 dark:border-gray-600"},qp={class:"flex flex-wrap gap-4 text-sm text-gray-500 dark:text-gray-400"},Hp={class:"flex items-center"},Gp=pe(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),Wp={class:"flex items-center"},Jp=pe(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"})],-1)),Kp={key:0,class:"ml-1 text-green-600 dark:text-green-400"},Zp={key:1,class:"ml-1 text-red-600 dark:text-red-400"},Xp={key:2,class:"ml-1 text-yellow-600 dark:text-yellow-400"},Yp={key:0,class:"flex items-center text-blue-600 dark:text-blue-400"},ef=pe(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),tf={key:1,class:"flex items-center"},of=pe(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z"})],-1)),sf={class:"p-4 bg-gray-50 dark:bg-gray-700 border-t border-gray-200 dark:border-gray-600 flex flex-wrap gap-3 justify-center"},rf=pe(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})],-1)),af=pe(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)),nf=["disabled"],lf=pe(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)),cf=pe(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)),df={key:3,class:"fixed inset-0 z-[9999] flex items-center justify-center bg-black bg-opacity-70 backdrop-blur-sm"},uf={class:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-xl border border-gray-200 dark:border-gray-700 w-full max-w-md"},gf=pe(()=>e("h3",{class:"text-lg font-bold text-gray-800 dark:text-gray-200"}," 图片预览 ",-1)),vf=pe(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)),hf=[vf],pf={class:"flex justify-center"},ff=["src"],mf=20,yf=de({__name:"index",setup(o,{expose:a}){console.log("XhsProductFactory组件开始加载...");const t=It(),s=re(()=>t.isLogin);fs();const r=bt(),h=go();document.title="图文矩阵PRO版";const x=_(null),p=_(null),$=_(null),R=_(""),I=_(""),P=_([]),m=_({brandProduct:"",title:"",titles:[],activityId:"",materials:[],batchCount:"1",templateIds:[],information:""}),N=_(!1),Y=_([]),H=_(!1),q=_(""),w=_(null),b=_(!1),D=_(!1),G=_(""),K=_(!1),Q=_(""),E=_({}),ee=_(!1),ne=_(""),S=_(!1),j=_(!1),C=_([]),T=_([]),L=_([]),X=_([]),u=_([]),y=_("all"),l=_(!1),n=_(""),v=_(!1),f=_([]),U=re(()=>f.value.length>0),V=(d="")=>{const g=Date.now().toString().slice(-6),k=Math.random().toString(36).substring(2,7);return d?`${d}_${g}${k}`:`${g}${k}`};function O(d){var k,F,M,B;console.error("API请求失败:",d);const g=tt(d);if(g){A(g,"error");return}((k=d==null?void 0:d.response)==null?void 0:k.status)===401||(F=d==null?void 0:d.message)!=null&&F.includes("401")||(M=d==null?void 0:d.message)!=null&&M.includes("认证")||(B=d==null?void 0:d.message)!=null&&B.includes("登录")?(A("请先登录后再使用","error"),s.value||setTimeout(()=>{r.push("/login")},1500)):A(typeof d=="string"?d:(d==null?void 0:d.message)||"操作失败，请稍后重试","error")}function A(d,g="info"){R.value=d,I.value=g,setTimeout(()=>{ie()},3e3)}function ie(){R.value="",I.value=""}const $e=d=>{d&&d.trim()!==""?(console.log("收到单个AI生成选题: ",d.trim()),m.value.title=d.trim(),m.value.titles.includes(d.trim())?console.log("选题已存在，不重复添加"):(m.value.titles.push(d.trim()),console.log("选题已添加到列表，当前选题列表: ",m.value.titles)),A(`已添加选题: ${d.trim()}`,"success")):console.warn("收到的选题为空")},Fe=d=>{if(d&&d.length>0){console.log("收到多个AI生成选题: ",d);let g=0;for(let k=0;k<d.length;k++)d[k]&&d[k].trim()&&!m.value.titles.includes(d[k].trim())&&(m.value.titles.push(d[k].trim()),g++);g>0&&d[0]&&(m.value.title=d[0].trim()),A(`已添加 ${g} 个选题`,"success")}};async function Pe(d){var g,k,F;if(!d||d.length===0){C.value=[],T.value=[],u.value=[],L.value=[],X.value=[],sessionStorage.removeItem("materialLibrarySelectionType"),sessionStorage.removeItem("materialLibraryFolderSelection"),sessionStorage.removeItem("materialLibraryMaterialSelection"),sessionStorage.removeItem("materialSelectionInfo"),A("已清除选择","info");return}try{const M=sessionStorage.getItem("materialSelectionInfo");if(M)try{const B=JSON.parse(M);if(B&&B.folders&&B.folders.length>0)try{const ae=[...B.folders],ve=[];if(B.folderNames&&typeof B.folderNames=="object")ae.forEach(le=>{B.folderNames[le]?ve.push(B.folderNames[le]):ve.push(`文件夹 ${ve.length+1}`)});else try{const le=await Uo();let Ce=[];typeof le=="object"&&le!==null?le&&typeof le.data=="object"&&((g=le.data)!=null&&g.data)?Ce=le.data.data:le&&typeof le.data=="object"&&(Ce=le.data):Array.isArray(le)&&(Ce=le),ae.forEach(Ye=>{const et=Ce.find(Pt=>Pt.id===Ye||Pt.folderId===Ye);et?ve.push(et.name||et.folderName||`文件夹 ${ve.length+1}`):ve.push(`文件夹 ${ve.length+1}`)})}catch(le){console.error("通过API获取文件夹名称失败:",le),ae.forEach((Ce,Ye)=>{ve.push(`文件夹 ${Ye+1}`)})}L.value=ae,X.value=ve}catch(ae){console.error("处理文件夹选择失败:",ae),L.value=[...B.folders],X.value=B.folders.map((ve,le)=>`文件夹 ${le+1}`)}else L.value=[],X.value=[];if(B&&B.materials&&B.materials.length>0)try{const ae=[...B.materials],ve=B.materials.map(le=>`素材 ${le.substring(0,6)}...`);C.value=ae,u.value=ve}catch(ae){console.error("处理素材选择失败:",ae),C.value=[...B.materials],u.value=B.materials.map((ve,le)=>`素材 ${le+1}`)}else C.value=[],u.value=[];const W=((k=B.folders)==null?void 0:k.length)||0,oe=((F=B.materials)==null?void 0:F.length)||0;W>0&&oe>0?A(`已选择 ${W} 个文件夹和 ${oe} 个素材`,"success"):W>0?A(`已选择 ${W} 个文件夹`,"success"):oe>0&&A(`已选择 ${oe} 个素材`,"success")}catch(B){console.error("解析选择信息失败:",B),A("处理选择信息失败，请重试","error")}else A(`选择了 ${d.length} 个项目`,"success")}catch(M){console.error("素材库选择处理失败:",M),O(M)}}async function Qe(){var d,g,k;if(!m.value.brandProduct){A("请输入品牌产品名称","error");return}if(m.value.titles.length===0){A("请至少添加一个选题","error");return}if(m.value.materials.length===0&&C.value.length===0&&L.value.length===0){A("请上传至少一张素材图或从素材库选择","error");return}if(N.value){A("正在处理中，请稍候...","info");return}try{N.value=!0,console.log("开始提交表单，选题数量:",m.value.titles.length);const F=parseInt(m.value.batchCount)||1,M=F>1?V("batch"):void 0;console.log(`批量设置: ${F}，批次ID: ${M||"无"}`),console.log("选中的素材库素材:",C.value),console.log("选中的文件夹:",L.value);try{let B;m.value.titles.length>1?(console.log("使用批量API提交多个选题"),B=await wt({brandProduct:m.value.brandProduct,title:m.value.titles[0],titleList:m.value.titles,activityId:m.value.activityId,fileIds:m.value.materials,folderIds:L.value,materialIds:C.value,batchCount:F,templateIds:(d=m.value.templateIds)==null?void 0:d.map(oe=>oe.toString()),information:m.value.information})):F>1?B=await wt({brandProduct:m.value.brandProduct,title:m.value.titles[0],activityId:m.value.activityId,fileIds:m.value.materials,folderIds:L.value,materialIds:C.value,batchCount:F,templateIds:(g=m.value.templateIds)==null?void 0:g.map(oe=>oe.toString()),information:m.value.information}):B=await wt({brandProduct:m.value.brandProduct,title:m.value.titles[0],activityId:m.value.activityId,fileIds:m.value.materials,folderIds:L.value,materialIds:C.value,templateIds:(k=m.value.templateIds)==null?void 0:k.map(oe=>oe.toString()),information:m.value.information}),console.log("生成API响应:",B);const W=tt(B);if(W){A(W,"error");return}if(!B.success){A(B.message||"生成失败，请稍后重试","error");return}p.value&&setTimeout(()=>{var oe;console.log("执行提交后的任务刷新"),(oe=p.value)==null||oe.refreshTasks()},1e3),A("已成功提交笔记生成任务！","success")}catch(B){console.error("提交表单失败:",B);const W=tt(B);if(W){A(W,"error");return}O(B)}}finally{N.value=!1}}function ze(){m.value={brandProduct:"",title:"",titles:[],activityId:m.value.activityId,materials:[],batchCount:"1",templateIds:[],information:""},Y.value=[],C.value=[],T.value=[],u.value=[],L.value=[],X.value=[],sessionStorage.removeItem("materialLibrarySelectionType"),sessionStorage.removeItem("materialLibraryFolderSelection"),sessionStorage.removeItem("materialLibraryMaterialSelection"),sessionStorage.removeItem("materialSelectionInfo"),st(()=>{console.log("表单已重置，状态已清除")}),A("表单已重置","info")}function Ue(d){if(!d||!d.noteId){A("无法查看笔记详情，缺少笔记ID","error");return}K.value=!0,Q.value="",D.value=!0,E.value={},G.value=d.noteId,Ne(d.noteId)}async function Ne(d){try{const g=await fetch(`/api/xhs-auto/notes/${d}`),k=await g.json();if(!g.ok)throw new Error(`获取笔记详情失败: ${g.status} ${g.statusText}`);const F=k.data||k;E.value=F,K.value=!1,console.log("获取到笔记详情:",F)}catch(g){console.error("获取笔记详情失败:",g),Q.value=g.message||"获取笔记详情失败",K.value=!1}}function Le(d){if(!d)return"未知时间";try{return new Date(d).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return d}}function Ie(d){if(!d||!d.noteId&&!d.id){A("无法打开分享页面，缺少笔记ID","error");return}try{const g=d.noteId||d.id,F=`${typeof window<"u"?window.location.origin:""}/chat#/xhs-auto-api?id=${g}`;console.log("打开分享页面:",F),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?(window.open(F,"_blank"),A("已打开分享页面","success")):(console.log("在电脑端显示二维码，noteId:",g,"分享URL:",F),mt(g,F))}catch(g){console.error("打开分享页面失败:",g),A(`打开分享页面失败: ${g.message||"未知错误"}`,"error")}}function mt(d,g){console.log("showQRCodeForShare 方法被调用，noteId:",d,"分享URL:",g);const F=`https://xhs.aivip1.top/api/html-render/qrcode?data=${encodeURIComponent(g)}`;if(console.log("生成的二维码URL:",F),w.value={id:`share_${d}`,brandProduct:"分享页面二维码",title:"扫码在手机端查看分享页面",status:"completed",createTime:new Date().toISOString(),updateTime:new Date().toISOString(),result:{qrCode:F,isShareLink:!0,mobileOnly:!0},error:"",executeId:void 0,noteId:d,batchId:void 0,batchCount:void 0,batchIndex:void 0},w.value.qrCodeType="share",q.value=F,$.value&&typeof $.value.refreshQrImage=="function"){console.log("使用 modalDialogsRef.refreshQrImage 刷新二维码");try{setTimeout(()=>{var M,B;(B=(M=$.value)==null?void 0:M.refreshQrImage)==null||B.call(M)},50)}catch(M){console.error("刷新二维码失败:",M)}}console.log("设置 showQrModal.value = true"),H.value=!0,A("请使用手机扫描二维码查看分享页面","info")}async function Fo(d){if(!d||!d.noteId&&!d.id){A("无法弃用笔记，缺少笔记ID","error");return}if(confirm("确定要弃用这篇笔记吗？弃用后将不再显示在可用笔记列表中。"))try{const g=d.noteId||d.id,k=await fetch(`/api/xhs-auto/notes/${g}/discard`,{method:"POST",headers:{"Content-Type":"application/json"}}),F=await k.json();if(!k.ok)throw new Error(`弃用笔记失败: ${k.status} ${k.statusText}`);E.value&&(E.value.isDiscarded=!0),A("笔记已成功弃用","success"),p.value&&p.value.refreshTasks()}catch(g){console.error("弃用笔记失败:",g),A(`弃用笔记失败: ${g.message||"未知错误"}`,"error")}}function at(){D.value=!1,G.value="",Q.value="",K.value=!1,E.value={},console.log("关闭笔记详情弹窗")}function jt(d){console.log("准备编辑笔记:",d),d?(d.noteId?(ne.value=d.noteId,ee.value=!0,console.log("编辑笔记, 使用noteId:",ne.value)):d.id?(ne.value=d.id,ee.value=!0,console.log("编辑笔记, 使用任务id:",ne.value)):A("无法编辑笔记，缺少笔记ID","error"),D.value&&(D.value=!1)):A("无法编辑笔记，缺少笔记信息","error")}function Po(d){A("笔记修改成功","success"),p.value&&p.value.refreshTasks(),D.value&&E.value&&(E.value.id===d.id||E.value.noteId===d.id)&&Ne(d.id)}async function Qo(d){if(console.log("重试任务:",d),!d||!d.id){A("无法重试任务，缺少任务ID","error");return}if(confirm("确定要重试这个失败的任务吗？"))try{A("正在重新提交任务...","info");const g=await Ts(d.id);console.log("重试任务API响应:",g);const k=tt(g);if(k){A(k,"error");return}if(!g.success){A(g.message||"重试任务失败，请稍后重试","error");return}A("任务重试成功，正在重新处理...","success"),p.value&&setTimeout(()=>{var F;console.log("执行重试后的任务刷新"),(F=p.value)==null||F.refreshTasks()},1e3)}catch(g){console.error("重试任务失败:",g);const k=tt(g);if(k){A(k,"error");return}O(g)}}function zo(){console.log("iframe加载完成"),K.value=!1,Q.value=""}function Vo(d){if(console.error("iframe加载失败:",d),E.value&&Object.keys(E.value).length>0){K.value=!1;return}K.value=!1;let g=G.value;if(d){const k=d.target;k&&k.src&&(g=k.src)}!g||g==="undefined"||g==="null"?Q.value="笔记链接无效，请联系管理员":Q.value="笔记内容加载失败，请刷新重试",setTimeout(()=>{if(Q.value&&G.value)try{Ne(G.value)}catch(k){console.error("重建URL失败:",k)}},1500)}function Ro(d){if(!d){A("活动ID不存在","error");return}console.log("导航到活动页面, activityId:",d),h.showApp({id:"xhs-notes",name:"小红书笔记",type:"built-in",path:"xhs-notes",params:{activityId:d}}),localStorage.setItem("currentActivityId",d),A("正在跳转到活动笔记列表...","success")}function Oo(d){if(console.log("收到view-qr-code事件，笔记ID:",d.noteId),A("正在生成二维码...","info"),w.value=d,q.value="",b.value=!1,y.value="all",w.value){if(w.value.qrCodeType="note",!w.value.result)w.value.result={};else if(typeof w.value.result=="string"){const g=w.value.result;w.value.result={qrCode:g}}else typeof w.value.result!="object"&&(w.value.result={});w.value.result.platform="all"}if(d.result&&d.result.qrCode){const g=d.result.qrCode;if(g.startsWith("https://api.qrserver.com/")){console.log("使用任务中保存的二维码URL:",g),q.value=g,H.value=!0;return}else console.log("任务中保存的二维码URL格式不正确，重新生成")}if(d.noteId)try{const k=`${typeof window<"u"?window.location.origin:""}/chat#/xhs-auto-api?id=${d.noteId}`,F=encodeURIComponent(k);console.log("生成笔记二维码链接:",k),console.log("编码后的链接:",F);const B=`https://xhs.aivip1.top/api/html-render/qrcode?data=${F}`;console.log("完整的二维码URL:",B),H.value=!0;const W=new Image;W.onload=()=>{console.log("二维码图片预加载成功"),q.value=B,w.value&&w.value.result&&(w.value.result.qrCode=B)},W.onerror=()=>{console.error("二维码图片预加载失败，尝试使用备用服务");const ae=`https://xhs.aivip1.top/api/html-render/qrcode?data=${F}`,ve=new Image;ve.onload=()=>{console.log("备用二维码服务加载成功"),q.value=ae,w.value&&w.value.result&&(w.value.result.qrCode=ae)},ve.onerror=()=>{console.error("所有二维码服务都失败，使用文本链接"),$.value&&$.value.showTextLink(k)},ve.src=ae},W.src=B,q.value=B}catch(g){if(console.error("生成二维码URL失败:",g),A("生成二维码失败，请重试","error"),d.noteId){const F=`${typeof window<"u"?window.location.origin:""}/chat#/xhs-auto-api?id=${d.noteId}`;$.value&&($.value.showTextLink(F),H.value=!0)}}else A("此笔记没有可用的二维码","error")}function qo(d,g){if(g&&g.stopPropagation(),!d){A("活动ID不存在","error");return}console.log("查看活动笔记二维码:",d),n.value=d,y.value="all",nt("all"),l.value=!1,H.value=!0}function nt(d){const g=n.value;if(g)try{y.value=d;let F=`${typeof window<"u"?window.location.origin:""}/chat#/xhs-auto-api?identifier=${g}`;d==="xhs"?F+="&platform=xhs":d==="douyin"&&(F+="&platform=douyin");const M=encodeURIComponent(F);q.value=`https://xhs.aivip1.top/api/html-render/qrcode?data=${M}`,console.log("设置二维码URL:",q.value),w.value={id:"activity_"+g,brandProduct:"活动二维码",title:d==="all"?"扫码查看全平台笔记":d==="xhs"?"扫码查看小红书笔记":"扫码查看抖音笔记",status:"completed",createTime:new Date().toISOString(),updateTime:new Date().toISOString(),activityId:g,result:{qrCode:q.value,platform:d},error:"",executeId:void 0,noteId:void 0,batchId:void 0,batchCount:void 0,batchIndex:void 0},w.value.qrCodeType="activity",l.value=!1,H.value=!0}catch(k){console.error("生成二维码失败:",k),A("生成二维码失败，请重试","error"),l.value=!1}}function Ho(d){m.value=d}function Nt(d){if(console.error("二维码加载失败:",q.value),b.value=!0,q.value&&!q.value.startsWith("http")){console.error("URL格式不正确，需要添加前缀");const g=typeof window<"u"?window.location.origin:"";if(q.value.includes("/chat#/xhs-auto-api")||q.value.includes(`${g}/chat`)){const k=q.value,B=`https://xhs.aivip1.top/api/html-render/qrcode?data=${encodeURIComponent(k)}`;console.log("重新构建的二维码URL:",B),A("正在修复二维码格式...","info"),q.value=B,w.value&&w.value.result&&(w.value.result.qrCode=B);const W=new Image;W.onload=()=>{console.log("修复后的二维码加载成功"),b.value=!1,setTimeout(()=>{$.value&&$.value.refreshQrImage()},200)},W.onerror=()=>{console.error("修复后的二维码仍然加载失败，切换到备用服务"),Et()},W.src=B;return}}Et()}function Et(){if(q.value&&q.value.includes("api.qrserver.com"))try{const d=q.value.match(/data=([^&]+)/);if(d&&d[1]){const g=d[1];A("正在切换备用二维码服务...","info");const k=`https://xhs.aivip1.top/api/html-render/qrcode?data=${g}`;console.log("切换到备用QR服务:",k);const F=new Image;F.onload=()=>{console.log("备用二维码加载成功"),q.value=k,w.value&&w.value.result&&(w.value.result.qrCode=k),b.value=!1,setTimeout(()=>{$.value&&$.value.refreshQrImage()},200)},F.onerror=()=>{console.error("备用二维码服务也失败，使用文本链接"),Ut()},F.src=k;return}}catch(d){console.error("解析QR URL失败:",d)}Ut()}function Ut(){var d,g;if(w.value)try{const k=typeof window<"u"?window.location.origin:"";let F="";const M=w.value.qrCodeType;if(M==="note"||!M&&w.value.noteId&&!w.value.id.startsWith("activity_"))F=`${k}/chat#/xhs-auto-api?id=${w.value.noteId}`,console.log("生成笔记二维码链接：",F);else if(M==="activity"||(d=w.value.id)!=null&&d.startsWith("activity_")||!w.value.noteId&&w.value.activityId){let B="";if(!w.value.result)B="";else if(typeof w.value.result=="string"){const oe=w.value.result;w.value.result={qrCode:oe},B=""}else typeof w.value.result=="object"?w.value.result.platform==="xhs"?B="&platform=xhs":w.value.result.platform==="douyin"&&(B="&platform=douyin"):(w.value.result={},B="");let W=w.value.activityId;!W&&((g=w.value.id)!=null&&g.startsWith("activity_"))&&(W=w.value.id.replace("activity_","")),W?(F=`${k}/chat#/xhs-auto-api?identifier=${W}${B}`,console.log("生成活动二维码链接：",F)):(F=`${k}/chat#/xhs-auto-api`,console.log("未能确定活动ID，使用默认链接"))}else w.value.noteId?(F=`${k}/chat#/xhs-auto-api?id=${w.value.noteId}`,console.log("不确定类型，使用笔记ID生成链接:",F)):w.value.activityId?(F=`${k}/chat#/xhs-auto-api?identifier=${w.value.activityId}`,console.log("不确定类型，使用活动ID生成链接:",F)):(F=`${k}/chat#/xhs-auto-api`,console.log("无效的任务，使用默认链接"));w.value.textShareLink=F,w.value.qrLoadFailed=!0,$.value?$.value.showTextLink(F):(A("二维码加载失败，请使用链接访问","info"),setTimeout(()=>{alert(`二维码加载失败，请使用以下链接访问：
${F}`)},100)),console.log("已创建文本型二维码替代链接:",F)}catch(k){console.error("创建文本型二维码失败:",k),A("无法生成二维码，请稍后重试","error")}}function Go(d){console.error("登录二维码加载失败:",d),A("登录二维码加载失败，请刷新页面重试","error");const g=`${window.location.origin}/login?redirect=${encodeURIComponent(window.location.pathname)}`;return setTimeout(()=>{confirm("无法加载登录二维码，是否跳转到登录页面？")&&(window.location.href=g)},1e3),d&&d.preventDefault&&d.preventDefault(),!1}function Wo(){console.log("添加404跳转拦截...");const d=history.pushState,g=history.replaceState;history.pushState=function(M,B,W){if(W&&typeof W=="string"&&(W.includes("/404")||W.includes("/not-found"))){console.warn("检测到跳转到404，已阻止:",W),A("检测到错误，已阻止页面跳转","error");return}return d.apply(this,[M,B,W])},history.replaceState=function(M,B,W){if(W&&typeof W=="string"&&(W.includes("/404")||W.includes("/not-found"))){console.warn("检测到跳转到404，已阻止:",W),A("检测到错误，已阻止页面跳转","error");return}return g.apply(this,[M,B,W])},window.addEventListener("error",function(M){var B,W,oe,ae,ve;if((W=(B=M==null?void 0:M.error)==null?void 0:B.message)!=null&&W.includes("getQRCode")||(ae=(oe=M==null?void 0:M.error)==null?void 0:oe.stack)!=null&&ae.includes("getQRCode")||(ve=M==null?void 0:M.message)!=null&&ve.includes("getQRCode"))return console.warn("捕获到二维码相关错误，阻止默认行为:",M),M.preventDefault(),M.stopPropagation(),A("登录二维码加载失败，请刷新页面重试","error"),!1},!0),window.addEventListener("beforeunload",function(M){const B=window.location.href,W=document.referrer;(B.includes("getQRCode")||W.includes("getQRCode"))&&!B.includes("/404")&&!B.includes("/login")&&console.warn("防止可能的错误跳转:",{currentUrl:B,referrer:W})}),new MutationObserver(M=>{for(const B of M)if(B.type==="childList"){const W=document.querySelectorAll('.not-found, .error-404, [data-error="404"], .page-404');if(W.length>0){console.warn("检测到404页面元素，尝试恢复:",W),A("页面出错，正在恢复...","error"),setTimeout(()=>{try{window.history.back()}catch(oe){console.error("无法返回上一页:",oe)}},500);break}}}).observe(document.body,{childList:!0,subtree:!0});const F=window.fetch;window.fetch=async function(M,B){try{if(typeof M=="string"&&(M.includes("/getQRCode")||M.includes("/qrcode")||M.includes("/api/official/"))){console.log("拦截到二维码相关请求:",M);try{const ae=await F(M,B);if(!ae.ok){console.warn("二维码请求返回错误状态:",ae.status);const ve=ae.clone();let le={};try{le=await ve.json()}catch(Ce){console.error("解析响应失败:",Ce)}if(ae.status===400||ae.status===401)return console.warn("返回认证错误:",le),new Response(JSON.stringify({code:200,success:!0,message:"已被拦截的请求，避免404跳转",data:{url:null,qrUrl:null,errMsg:le.message||"认证错误",fromIntercept:!0}}),{status:200,headers:{"Content-Type":"application/json"}})}return ae}catch(ae){return console.error("二维码请求发生网络错误:",ae),new Response(JSON.stringify({code:200,success:!0,message:"网络错误已被拦截，避免404跳转",data:{url:null,qrUrl:null,errMsg:ae.message||"网络请求失败",fromIntercept:!0}}),{status:200,headers:{"Content-Type":"application/json"}})}}if(typeof M=="string"&&(M.includes("access_token")||M.includes("/api/official/")||M.includes("/api/wechat/")))try{const ae=await F(M,B);if(!ae.ok){const ve=ae.clone();let le={};try{le=await ve.json()}catch(et){console.error("解析access_token响应失败:",et)}const Ce=(le==null?void 0:le.message)||"";if(Ce.includes("access_token")||Ce.includes("token")||Ce.includes("授权"))return console.warn("拦截到access_token错误:",Ce),A("授权已过期，请刷新页面重试","info"),new Response(JSON.stringify({code:200,success:!0,message:"access_token错误已被拦截，避免404跳转",data:{errMsg:Ce||"access_token错误",fromIntercept:!0}}),{status:200,headers:{"Content-Type":"application/json"}})}return ae}catch(ae){return console.error("access_token请求错误:",ae),new Response(JSON.stringify({code:200,success:!0,message:"access_token请求错误已被拦截",data:{errMsg:ae.message||"网络请求失败",fromIntercept:!0}}),{status:200,headers:{"Content-Type":"application/json"}})}return F(M,B)}catch(W){return console.error("fetch拦截器捕获到错误:",W),Go(W),new Response(JSON.stringify({code:200,success:!0,message:"错误已被拦截，避免404跳转",data:{message:(W==null?void 0:W.message)||"Unknown error"}}),{status:200,headers:{"Content-Type":"application/json"}})}},console.log("404跳转拦截已添加")}async function Jo(){try{console.log("获取活动列表...");const d=await vo();d&&Array.isArray(d)?(P.value=d,console.log("获取到活动列表:",P.value)):(console.warn("活动列表返回格式不正确:",d),P.value=[])}catch(d){console.error("获取活动列表失败:",d),P.value=[]}}Te(async()=>{if(Wo(),Ko(),!Lt().isLoggedIn){console.warn("图文矩阵页面加载，用户未登录"),A("请先登录后再使用图文矩阵功能","error"),setTimeout(()=>{s.value||r.push("/login")},2e3);return}console.log("图文矩阵页面已初始化，用户已登录");try{await Jo()}catch(g){O(g)}os()});function Ko(){console.log("设置Vue Router导航守卫...");const d=bt();let g=d.currentRoute.value.path;console.log("当前路由路径:",g);const k=d.beforeEach((M,B,W)=>{if(console.log(`路由导航: ${B.path} -> ${M.path}`),M.name==="error-404"||M.name==="404"||M.path.includes("/404")||M.path.includes("/not-found")){if(console.warn("拦截到404路由导航:",M.path),A("检测到页面错误，已阻止跳转","error"),B.path.includes("login")||localStorage.getItem("lastAuthError")==="true"){console.log("检测到认证相关错误，跳转到登录页"),localStorage.removeItem("lastAuthError"),setTimeout(()=>{d.push("/login")},100),W("/login");return}W(!1);return}g=M.path,W()}),F=M=>{console.error("路由导航错误:",M),M.message&&(M.message.includes("authentication")||M.message.includes("authorize")||M.message.includes("access_token")||M.message.includes("login")||M.message.includes("401")||M.message.includes("权限")||M.message.includes("认证"))&&localStorage.setItem("lastAuthError","true");try{!g.includes("/404")&&!g.includes("/error")?(console.log("尝试重定向回:",g),d.replace(g)):d.replace("/")}catch(B){console.error("尝试重定向失败:",B)}A("导航出错，请刷新页面重试","error")};return d.onError(F),fe(()=>d.currentRoute.value,M=>{console.log("路由变化:",M.path),(M.name==="error-404"||M.name==="404"||M.path.includes("/404")||M.path.includes("/not-found")||M.meta.error===!0)&&(console.warn("路由变为错误状态，尝试恢复"),setTimeout(()=>{if(document.querySelectorAll('.not-found, .error-404, [data-error="404"], .page-404').length>0){console.warn("检测到404页面内容，尝试恢复"),A("页面出错，正在尝试恢复...","error");try{window.history.back()}catch(W){console.error("无法返回上一页:",W);try{d.replace("/")}catch(oe){console.error("跳转到主页失败:",oe)}}}},300))},{immediate:!0}),uo(()=>{typeof k=="function"&&k();try{d.onError(()=>{})}catch{console.warn("无法重置路由错误处理器")}}),console.log("Vue Router导航守卫设置完成"),k}function Zo(d){var k,F;if(console.log("平台切换为:",d),y.value=d,!w.value)return;if(w.value){if(!w.value.result)w.value.result={};else if(typeof w.value.result=="string"){const M=w.value.result;w.value.result={qrCode:M}}else typeof w.value.result!="object"&&(w.value.result={});w.value.result.platform=d}const g=w.value.qrCodeType||(w.value.noteId&&!((k=w.value.id)!=null&&k.startsWith("activity_"))?"note":"activity");w.value.title=d==="all"?"扫码查看全平台笔记":d==="xhs"?"扫码查看小红书笔记":"扫码查看抖音笔记";try{const M=typeof window<"u"?window.location.origin:"";let B="";if(g==="note"&&w.value.noteId)B=`${M}/chat#/xhs-auto-api?id=${w.value.noteId}`,d!=="all"&&(B+=`&platform=${d}`);else if(w.value.activityId)B=`${M}/chat#/xhs-auto-api?identifier=${w.value.activityId}`,d!=="all"&&(B+=`&platform=${d}`);else if((F=w.value.id)!=null&&F.startsWith("activity_")){const W=w.value.id.replace("activity_","");B=`${M}/chat#/xhs-auto-api?identifier=${W}`,d!=="all"&&(B+=`&platform=${d}`)}if(B){const W=encodeURIComponent(B);q.value=`https://xhs.aivip1.top/api/html-render/qrcode?data=${W}`,console.log("生成新的二维码URL:",q.value),w.value.result&&(w.value.result.qrCode=q.value)}}catch(M){console.error("生成二维码失败:",M),A(`生成${d}平台二维码失败`,"error")}}function Xo(){H.value=!1,q.value="",w.value=null}const Yo=()=>new Promise((d,g)=>{if(window.xhs){console.log("小红书分享SDK已加载"),d();return}try{const k=document.createElement("script");k.src="https://fe-static.xiaohongshu.com/official-site/js/share-sdk.js",k.async=!0,k.onload=()=>{console.log("小红书分享SDK加载成功"),d()},k.onerror=F=>{console.error("小红书分享SDK加载失败:",F),g(new Error("小红书分享SDK加载失败"))},document.body.appendChild(k)}catch(k){console.error("添加小红书SDK脚本失败:",k),g(k)}});async function Bt(d){try{if(await Yo(),!window.xhs){A("小红书分享SDK加载失败，请刷新后重试","error"),Xe("小红书分享SDK加载失败，请刷新后重试");return}const k=new URLSearchParams(window.location.search).get("debug")==="1",F=await ks();if(!F||!F.signature){A("获取分享签名失败","error"),Xe("获取分享签名失败，请稍后重试");return}console.log("分享签名获取成功:",F);let M="",B="",W=[];if(d.result&&(M=d.title||"",B=d.result.content||"",W=d.result.images||[]),!W.length&&d.noteId)try{const oe=await fo(d.id);oe&&oe.images&&oe.images.length&&(W=oe.images)}catch(oe){console.error("获取笔记图片失败:",oe)}if(!W.length){A("笔记没有图片，无法分享到小红书","error"),Xe("笔记没有图片，无法分享到小红书");return}window.xhs.share({shareInfo:{type:"normal",title:M,content:B,images:W},verifyConfig:{appKey:F.appKey,nonce:F.nonce,timestamp:F.timestamp,signature:F.signature},success:()=>{console.log("分享成功"),A("已成功分享到小红书","success"),!k&&d.id?(console.log("正在更新笔记状态..."),fetch(`/api/xhs-auto/notes/${d.id}/used`,{method:"POST",headers:{"Content-Type":"application/json"}}).then(oe=>oe.json()).then(oe=>{console.log("笔记状态已更新:",oe)}).catch(oe=>{console.error("更新笔记状态失败:",oe)})):k&&console.log("调试模式：分享成功，但不更新笔记状态")},fail:oe=>{console.error("分享失败",oe),A(`分享失败: ${oe.message||"未知错误"}`,"error"),Xe(`分享失败: ${oe.message||"未知错误"}`)}})}catch(g){console.error("分享到小红书失败:",g);const k=g instanceof Error?g.message:"未知错误";A(`分享失败: ${k}`,"error"),Xe(`分享失败: ${k}`)}}function Xe(d){const g=document.createElement("div");g.className="error-dialog-container",g.style.position="fixed",g.style.top="0",g.style.left="0",g.style.width="100%",g.style.height="100%",g.style.backgroundColor="rgba(0, 0, 0, 0.7)",g.style.display="flex",g.style.justifyContent="center",g.style.alignItems="center",g.style.zIndex="9999";const k=document.createElement("div");k.className="error-dialog-content",k.style.backgroundColor="white",k.style.borderRadius="8px",k.style.padding="20px",k.style.maxWidth="80%",k.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.15)",k.style.display="flex",k.style.flexDirection="column",k.style.alignItems="center";const F=document.createElement("div");F.className="error-icon",F.style.width="50px",F.style.height="50px",F.style.borderRadius="50%",F.style.backgroundColor="#ff3333",F.style.display="flex",F.style.justifyContent="center",F.style.alignItems="center",F.style.marginBottom="15px",F.style.color="white",F.style.fontSize="32px",F.style.fontWeight="bold",F.innerHTML="!";const M=document.createElement("h3");M.className="error-title",M.style.margin="0 0 10px",M.style.fontSize="18px",M.style.color="#333",M.textContent="错误提示";const B=document.createElement("p");B.className="error-message",B.style.margin="0 0 20px",B.style.fontSize="16px",B.style.color="#666",B.style.textAlign="center",B.textContent=d;const W=document.createElement("button");W.className="error-close-button",W.style.padding="8px 16px",W.style.backgroundColor="#f5f5f5",W.style.border="1px solid #ddd",W.style.borderRadius="4px",W.style.color="#333",W.style.fontSize="14px",W.style.cursor="pointer",W.textContent="知道了",W.addEventListener("click",()=>{document.body.removeChild(g)}),k.appendChild(F),k.appendChild(M),k.appendChild(B),k.appendChild(W),g.appendChild(k),document.body.appendChild(g),g.addEventListener("click",oe=>{oe.target===g&&document.body.removeChild(g)})}a({handleQrLoadError:Nt,shareToXhs:Bt});function es(){console.log("打开笔记模板市场"),v.value=!0,A("正在加载模板市场...","info")}function ts(d){console.log("选择了模板:",d),f.value=[],f.value=d,m.value.templateIds=d.map(g=>g.id.toString()),A(`已选择${d.length}个模板`,"success")}function os(){var d;try{const g=localStorage.getItem("template_data");if(!g){console.log("未检测到模板数据");return}console.log("检测到模板数据:",g);const k=JSON.parse(g),F=new Date().getTime(),M=k.timestamp||0;if(!(F-M<3e5)){console.log("模板数据已过期，不应用"),localStorage.removeItem("template_data");return}if(k.templates&&Array.isArray(k.templates)){const oe=k.templates.map(ae=>({id:ae.id||Date.now(),title:ae.title||"未命名模板",content:ae.content||"",coverImage:ae.coverImage||"",source:ae.source||"template_market"}));f.value=[...f.value,...oe],console.log(`成功应用${oe.length}个模板`)}else{const oe={id:k.id||Date.now(),title:k.title||"未命名模板",content:k.content||"",coverImage:k.coverImage||"",source:k.source||"template_market"};f.value.push(oe),console.log("成功应用单个模板")}localStorage.removeItem("template_data");const W=((d=k.templates)==null?void 0:d.length)||1;A(`已导入${W}个模板`,"success"),setTimeout(()=>{const oe=document.querySelector("form");oe&&oe.scrollIntoView({behavior:"smooth",block:"start"})},300)}catch(g){console.error("检查模板数据时出错:",g),localStorage.removeItem("template_data")}}function ss(d){var g;if(d>=0&&d<f.value.length){const k=f.value[d].title,F=f.value[d].id.toString();f.value.splice(d,1),m.value.templateIds=((g=m.value.templateIds)==null?void 0:g.map(M=>M.toString()).filter(M=>M!==F))||[],A(`已移除模板: ${k}`,"success")}}const yt=_(!1),Dt=_("");function Ft(d){Dt.value=d,yt.value=!0}function rs(){yt.value=!1}return(d,g)=>(i(),c("div",Rh,[ke(qi,{message:R.value,type:I.value,onClear:ie},null,8,["message","type"]),e("div",Oh,[e("div",qh,[Hh,e("form",{onSubmit:ge(Qe,["prevent"]),class:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border border-gray-200 dark:border-gray-700"},[ke(aa,{modelValue:m.value.brandProduct,"onUpdate:modelValue":g[0]||(g[0]=k=>m.value.brandProduct=k)},null,8,["modelValue"]),ke(za,{modelValue:m.value.titles,"onUpdate:modelValue":g[1]||(g[1]=k=>m.value.titles=k),onRequestAiTopic:g[2]||(g[2]=k=>S.value=!0)},null,8,["modelValue"]),e("div",{class:"mb-6"},[e("button",{type:"button",onClick:es,class:"w-full px-4 py-3 border border-pink-300 bg-pink-50 dark:bg-pink-900/20 dark:border-pink-800/40 text-pink-700 dark:text-pink-300 rounded-md hover:bg-pink-100 dark:hover:bg-pink-900/30 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-pink-500 focus:ring-offset-2 transform active:scale-95 flex items-center justify-center"},[Gh,Z(" 从笔记模板市场选择模板 ")])]),U.value?(i(),Me(iv,{key:0,templates:f.value,onClose:g[3]||(g[3]=k=>f.value=[]),onRemove:ss},null,8,["templates"])):z("",!0),ke(Mn,{modelValue:m.value.activityId,"onUpdate:modelValue":g[4]||(g[4]=k=>m.value.activityId=k),onError:O,ref_key:"activityManagerRef",ref:x},null,8,["modelValue"]),ke(Vh,{modelValue:m.value.information,"onUpdate:modelValue":g[5]||(g[5]=k=>m.value.information=k)},null,8,["modelValue"]),ke(Dl,{"max-file-count":mf,"product-form":m.value,"uploaded-files":Y.value,"selected-material-folders":C.value,"selected-folder-names":T.value,"material-names":u.value,"folder-ids":L.value,"folder-names":X.value,"onUpdate:uploadedFiles":g[6]||(g[6]=k=>Y.value=k),"onUpdate:productForm":Ho,"onUpdate:selectedMaterialFolders":g[7]||(g[7]=k=>C.value=k),"onUpdate:selectedFolderNames":g[8]||(g[8]=k=>T.value=k),"onUpdate:materialNames":g[9]||(g[9]=k=>u.value=k),"onUpdate:folderIds":g[10]||(g[10]=k=>L.value=k),"onUpdate:folderNames":g[11]||(g[11]=k=>X.value=k),onShowStatusMessage:A,onOpenMaterialLibrary:g[12]||(g[12]=k=>j.value=!0)},{actions:Be(()=>[]),_:1},8,["product-form","uploaded-files","selected-material-folders","selected-folder-names","material-names","folder-ids","folder-names"]),ke(Rl,{modelValue:m.value.batchCount,"onUpdate:modelValue":g[13]||(g[13]=k=>m.value.batchCount=k)},null,8,["modelValue"]),e("div",Wh,[e("button",{type:"submit",class:"w-full sm:w-auto sm:min-w-[180px] px-6 py-3 bg-gradient-to-r from-pink-500 to-pink-600 text-white rounded-md hover:from-pink-600 hover:to-pink-700 transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-pink-500 focus:ring-offset-2 active:from-pink-700 active:to-pink-800 transform active:scale-95 flex items-center justify-center",disabled:N.value},[N.value?(i(),c("span",Xh,[Yh,Z(" 处理中... ")])):(i(),c("span",Kh,[Zh,Z(" "+J(Number(m.value.batchCount)>1?`批量生成${m.value.batchCount}篇笔记`:"生成笔记"),1)]))],8,Jh),e("button",{type:"button",onClick:ze,class:"w-full sm:w-auto px-6 py-3 border border-gray-300 dark:border-gray-700 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-50 dark:hover:bg-gray-800 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-gray-300 dark:focus:ring-gray-700 transform active:scale-95 flex items-center justify-center"},[ep,Z(" 重置表单 ")])])],32),ke(Li,{"auto-refresh-enabled":!0,onViewNoteDetail:Ue,onViewActivity:Ro,onViewQrCode:Oo,onViewActivityQrCode:qo,onEditNote:jt,onRetryTask:Qo,onError:O,ref_key:"taskListRef",ref:p,tasks:[],activities:P.value,"loading-tasks":!1},null,8,["activities"])])]),l.value?(i(),c("div",tp,[e("div",op,[e("div",sp,[rp,e("button",{onClick:g[14]||(g[14]=k=>l.value=!1),class:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"},np)]),e("div",lp,[e("button",{onClick:g[15]||(g[15]=k=>nt("all")),class:"flex items-center justify-center p-4 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-all duration-200"},cp),e("button",{onClick:g[16]||(g[16]=k=>nt("xhs")),class:"flex items-center justify-center p-4 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-all duration-200"},up),e("button",{onClick:g[17]||(g[17]=k=>nt("douyin")),class:"flex items-center justify-center p-4 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-all duration-200"},vp)])])])):z("",!0),ke(Ad,{ref_key:"modalDialogsRef",ref:$,showQrModal:H.value,currentQrUrl:q.value,currentQrTask:w.value,showNoteDetailModal:D.value,currentNoteId:G.value,noteDetailLoading:K.value,noteDetailError:Q.value,onCloseQrModal:Xo,onCloseNoteDetailModal:at,onViewNoteDetail:Ue,onIframeLoaded:zo,onIframeError:Vo,onError:O,onQrLoadError:Nt,onChangePlatform:Zo,onShareToXhs:Bt},null,8,["showQrModal","currentQrUrl","currentQrTask","showNoteDetailModal","currentNoteId","noteDetailLoading","noteDetailError"]),D.value?(i(),c("div",hp,[e("div",pp,[e("div",{class:"flex justify-between items-center p-4 bg-gray-50 dark:bg-gray-700 border-b border-gray-200 dark:border-gray-600"},[fp,e("div",{class:"flex space-x-2"},[e("button",{onClick:at,class:"p-2 text-gray-500 dark:text-gray-300 hover:text-gray-700 dark:hover:text-white transition-colors rounded-full hover:bg-gray-100 dark:hover:bg-gray-600",title:"关闭"},yp)])]),e("div",kp,[K.value?(i(),c("div",wp,bp)):Q.value?(i(),c("div",_p,[e("div",$p,[Ip,e("p",Cp,J(Q.value),1),e("button",{onClick:at,class:"px-4 py-2 bg-gray-100 dark:bg-gray-600 text-gray-700 dark:text-gray-200 rounded-md hover:bg-gray-200 dark:hover:bg-gray-500 transition-all duration-200"}," 关闭 ")])])):(i(),c("div",Sp,[e("h2",Tp,J(E.value.title||"无标题"),1),E.value.type==="video"?(i(),c("div",Mp,[E.value.cover?(i(),c("div",{key:0,class:"relative overflow-hidden rounded-lg border border-gray-100 dark:border-gray-600 shadow-sm mb-4 cursor-pointer",onClick:g[18]||(g[18]=k=>Ft(E.value.cover))},[e("div",Ap,[e("img",{src:E.value.cover,alt:"视频封面",class:"w-full h-full object-cover"},null,8,Lp),jp])])):z("",!0),E.value.video?(i(),c("div",Np,[e("video",Ep,[e("source",{src:E.value.video,type:"video/mp4"},null,8,Up),Z(" 您的浏览器不支持视频播放 ")])])):z("",!0),Bp])):E.value.images&&E.value.images.length>0?(i(),c("div",Dp,[(i(!0),c(ue,null,xe(E.value.images,(k,F)=>(i(),c("div",{key:F,class:"relative overflow-hidden rounded-lg border border-gray-100 dark:border-gray-600 shadow-sm cursor-pointer",onClick:M=>Ft(k)},[e("div",Pp,[e("img",{src:k,alt:`图片 ${F+1}`,class:"w-full h-full object-cover"},null,8,Qp)])],8,Fp))),128))])):z("",!0),e("div",zp,[E.value.content?(i(),c("div",Vp,J(E.value.content),1)):(i(),c("div",Rp,"无内容"))]),e("div",Op,[e("div",qp,[e("div",Hp,[Gp,Z(" 创建时间: "+J(Le(E.value.createTime)),1)]),e("div",Wp,[Jp,Z(" 状态: "),E.value.isUsed?(i(),c("span",Kp,"已发布到小红书")):E.value.isDiscarded?(i(),c("span",Zp,"已弃用")):(i(),c("span",Xp,"未发布"))]),E.value.douyinUsed?(i(),c("div",Yp,[ef,Z(" 已发布到抖音 ")])):z("",!0),E.value.type?(i(),c("div",tf,[of,Z(" 类型: "+J(E.value.type==="video"?"视频":"图文"),1)])):z("",!0)])])])),z("",!0)]),e("div",sf,[e("button",{onClick:g[19]||(g[19]=k=>Ie(E.value)),class:"flex items-center px-4 py-2 bg-green-500 dark:bg-green-600 hover:bg-green-600 dark:hover:bg-green-500 text-white rounded-md transition-colors"},[rf,Z(" 打开分享页面 ")]),e("button",{onClick:g[20]||(g[20]=k=>jt(E.value)),class:"flex items-center px-4 py-2 bg-blue-500 dark:bg-blue-600 hover:bg-blue-600 dark:hover:bg-blue-500 text-white rounded-md transition-colors"},[af,Z(" 编辑笔记 ")]),e("button",{onClick:g[21]||(g[21]=k=>Fo(E.value)),class:"flex items-center px-4 py-2 bg-red-500 dark:bg-red-600 hover:bg-red-600 dark:hover:bg-red-500 text-white rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:E.value.isDiscarded},[lf,Z(" 弃用笔记 ")],8,nf),e("button",{onClick:at,class:"flex items-center px-4 py-2 bg-gray-400 dark:bg-gray-600 hover:bg-gray-500 dark:hover:bg-gray-500 text-white rounded-md transition-colors"},[cf,Z(" 关闭 ")])])])])):z("",!0),ke(Fh,{visible:ee.value,"onUpdate:visible":g[22]||(g[22]=k=>ee.value=k),noteId:ne.value,onSuccess:Po,onError:O},null,8,["visible","noteId"]),S.value?(i(),Me(q0,{key:2,"brand-product":m.value.brandProduct,onClose:g[23]||(g[23]=k=>S.value=!1),onGenerate:$e,onGenerateMultiple:Fe,onError:O,visible:S.value,"onUpdate:visible":g[24]||(g[24]=k=>S.value=k)},null,8,["brand-product","visible"])):z("",!0),ke(Bg,{visible:j.value,"onUpdate:visible":g[25]||(g[25]=k=>j.value=k),"selected-materials":C.value,onSelect:Pe,onError:O},null,8,["visible","selected-materials"]),ke(S2,{visible:v.value,onClose:g[26]||(g[26]=k=>v.value=!1),onSelect:ts},null,8,["visible"]),yt.value?(i(),c("div",df,[e("div",uf,[e("div",{class:"flex justify-between items-center mb-4"},[gf,e("button",{onClick:rs,class:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"},hf)]),e("div",pf,[e("img",{src:Dt.value,alt:"预览图片",class:"max-w-full max-h-90vh"},null,8,ff)])])])):z("",!0)]))}});const Sf=He(yf,[["__scopeId","data-v-e66ecc88"]]);export{Sf as default};
