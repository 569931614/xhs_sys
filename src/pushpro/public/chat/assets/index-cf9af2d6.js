import{d as S,R as i,S as d,a2 as s,m as F,a8 as se,a6 as k,a3 as L,ab as q,ac as J,r as v,w as ae,f as re,G as oe,k as U,a5 as ie,a4 as _,aj as de,c as E,F as le,a7 as ne,U as V,V as Q,W as H}from"./vue-f337fce5.js";import{d as ce,K as A}from"./index-e8e306c5.js";import{_ as N}from"./_plugin-vue_export-helper-c27b6911.js";import{e as ue}from"./naive-ui-5426aa23.js";import"./vueuse-motion-2f7a1d90.js";const ge={class:"analysis-modal-container"},xe=S({__name:"Modal",props:{show:{type:Boolean,default:!1}},emits:["update:show"],setup(n,{emit:r}){const x=r,I=()=>{x("update:show",!1)};return(m,C)=>n.show?(i(),d("div",{key:0,class:"analysis-modal-overlay",onClick:se(I,["self"])},[s("div",ge,[F(m.$slots,"default",{},void 0,!0)])])):k("",!0)}});const ye=N(xe,[["__scopeId","data-v-b70fbc36"]]),pe=n=>(q("data-v-e1af5b53"),n=n(),J(),n),he=["disabled"],me={key:0,class:"mr-2"},ve=pe(()=>s("svg",{class:"animate-spin h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),fe=[ve],_e=S({__name:"Button",props:{loading:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},size:{type:String,default:"md",validator:n=>["xs","sm","md","lg"].includes(n)}},emits:["click"],setup(n){return(r,x)=>(i(),d("button",{class:L(["inline-flex items-center justify-center bg-primary-600 hover:bg-primary-700 text-white rounded focus:outline-none transition-colors",[n.loading?"opacity-75 cursor-not-allowed":"",n.disabled?"opacity-50 cursor-not-allowed":"",n.size==="xs"?"btn-xs":"",n.size==="sm"?"btn-sm":"",n.size==="md"?"btn-md":"",n.size==="lg"?"btn-lg":""]]),disabled:n.disabled||n.loading,onClick:x[0]||(x[0]=I=>r.$emit("click"))},[n.loading?(i(),d("span",me,fe)):k("",!0),F(r.$slots,"default",{},void 0,!0)],10,he))}});const we=N(_e,[["__scopeId","data-v-e1af5b53"]]),be=s("svg",{class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),ke=[be],Ie=S({__name:"CloseButton",emits:["click"],setup(n){return(r,x)=>(i(),d("button",{class:"text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300 flex items-center justify-center w-6 h-6 rounded-full transition-colors hover:bg-gray-100 dark:hover:bg-gray-700",onClick:x[0]||(x[0]=I=>r.$emit("click"))},ke))}}),Me=S({__name:"Spinner",props:{size:{type:String,default:"md",validator:n=>["sm","md","lg"].includes(n)}},setup(n){return(r,x)=>(i(),d("div",{class:L(["spinner",[n.size]])},null,2))}});const $e=N(Me,[["__scopeId","data-v-b4cbff2a"]]),Ae={},Ne={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Ce=s("path",{d:"M23 4v6h-6"},null,-1),je=s("path",{d:"M1 20v-6h6"},null,-1),ze=s("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10"},null,-1),Le=s("path",{d:"M1 14l4.64 4.36A9 9 0 0 0 20.49 15"},null,-1),Se=[Ce,je,ze,Le];function Ge(n,r){return i(),d("svg",Ne,Se)}const Pe=N(Ae,[["render",Ge]]),De={},Ze={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},He=s("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"},null,-1),Te=s("line",{x1:"12",y1:"9",x2:"12",y2:"13"},null,-1),Be=s("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"},null,-1),We=[He,Te,Be];function Ye(n,r){return i(),d("svg",Ze,We)}const Re=N(De,[["render",Ye]]),w=n=>(q("data-v-5ed523de"),n=n(),J(),n),Ue={class:"account-analysis-container p-4"},Ee={class:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 max-w-5xl mx-auto"},Ve=w(()=>s("h1",{class:"text-2xl font-bold mb-6 text-center text-gray-800 dark:text-gray-200"},"账号分析",-1)),Qe={class:"mb-8"},Fe={class:"account-form"},qe={class:"grid md:grid-cols-3 gap-4"},Je={class:"md:col-span-2 mb-4"},Oe=w(()=>s("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"账号链接",-1)),Xe={key:1,class:"text-sm text-gray-500 mt-1"},Ke={class:"mb-4"},et=w(()=>s("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"分析模式",-1)),tt=w(()=>s("option",{value:"10"},"全面分析",-1)),st=w(()=>s("option",{value:"1"},"简单分析",-1)),at=[tt,st],rt=["disabled"],ot={key:0},it={key:1},dt={class:"analysis-history mt-8"},lt={class:"flex justify-between items-center mb-4"},nt=w(()=>s("h2",{class:"text-xl font-medium text-gray-800 dark:text-gray-200"},"分析历史",-1)),ct=["disabled"],ut=w(()=>s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)),gt={key:0,class:"flex justify-center py-8"},xt=w(()=>s("div",{class:"loading-spinner"},null,-1)),yt=[xt],pt={key:1,class:"text-center py-8 text-gray-500 dark:text-gray-400"},ht={key:2,class:"overflow-x-auto"},mt={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},vt=w(()=>s("thead",{class:"bg-gray-50 dark:bg-gray-700"},[s("tr",null,[s("th",{class:"px-3 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"},"平台"),s("th",{class:"px-3 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"},"链接"),s("th",{class:"px-3 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"},"状态"),s("th",{class:"px-3 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"},"用户名"),s("th",{class:"px-3 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"},"粉丝数"),s("th",{class:"px-3 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"},"点赞数"),s("th",{class:"px-3 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"},"时间"),s("th",{class:"px-3 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"},"操作")])],-1)),ft={class:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700"},_t={class:"px-3 py-4 whitespace-nowrap"},wt={class:"px-3 py-4 text-sm text-gray-600 dark:text-gray-300 max-w-xs truncate"},bt={class:"max-w-xs overflow-hidden text-ellipsis"},kt={class:"px-3 py-4 whitespace-nowrap"},It={key:0,class:"px-3 py-4 text-sm text-gray-600 dark:text-gray-300 max-w-xs truncate"},Mt={class:"max-w-xs overflow-hidden text-ellipsis font-medium"},$t={key:1,class:"px-3 py-4 text-sm text-gray-400 dark:text-gray-500"},At={key:2,class:"px-3 py-4 text-sm text-gray-600 dark:text-gray-300 whitespace-nowrap"},Nt={class:"px-2 py-1 text-xs bg-blue-50 dark:bg-blue-800 text-blue-700 dark:text-white rounded-full font-medium"},Ct={key:3,class:"px-3 py-4 text-sm text-gray-400 dark:text-gray-500"},jt={key:4,class:"px-3 py-4 text-sm text-gray-600 dark:text-gray-300 whitespace-nowrap"},zt={class:"px-2 py-1 text-xs bg-red-50 dark:bg-red-800 text-red-700 dark:text-white rounded-full font-medium"},Lt={key:5,class:"px-3 py-4 text-sm text-gray-400 dark:text-gray-500"},St={class:"px-3 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400"},Gt={class:"px-3 py-4 whitespace-nowrap text-sm"},Pt={class:"flex space-x-3"},Dt=["onClick"],Zt=["onClick","disabled"],Ht={class:"analysis-modal-content"},Tt={class:"flex justify-between items-center mb-2 px-3 pt-2"},Bt=w(()=>s("div",{class:"text-base font-bold text-gray-800 dark:text-gray-200"},"分析结果",-1)),Wt={class:"flex items-center gap-2"},Yt={key:0,class:"text-xs text-gray-500 dark:text-gray-400"},Rt={class:"result-content p-2 md:p-3 overflow-y-auto max-h-[calc(95vh-3rem)]"},Ut={key:0,class:"p-3 flex flex-col items-center justify-center"},Et={class:"mt-2 text-xs text-gray-600 dark:text-gray-400"},Vt={key:1,class:"p-3 flex flex-col items-center justify-center"},Qt={class:"text-red-500 mb-1"},Ft={class:"text-xs text-gray-600 dark:text-gray-400 text-center"},qt={key:2,class:"analysis-result-container"},Jt=["innerHTML"],Ot={key:1,class:"p-3 text-xs text-gray-600 dark:text-gray-400"},Xt=S({__name:"index",setup(n){const r=ue();ce();const x=v(""),I=v("10"),m=v(null),C=v(!1),G=v(!1),y=v([]),M=v(null),j=v(!1),P=v(!1),T=v("正在获取分析结果..."),B=v(!1),W=v(!1),f=v(null),b=v(""),O=t=>{if(!t)return"N/A";try{const a=new Date(t);return isNaN(a.getTime())?(console.warn("无效的日期字符串:",t),"N/A"):a.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch(a){return console.error("日期格式化错误:",a),"N/A"}},X=()=>{M.value&&(clearInterval(M.value),M.value=null),M.value=window.setInterval(()=>{y.value.some(a=>a.status==="进行中"||a.status==="刷新中...")?(console.log("自动刷新任务列表 - 发现进行中的任务"),$()):z()},2*60*1e3),console.log("启动自动刷新定时器，间隔: 2分钟")},z=()=>{M.value&&(clearInterval(M.value),M.value=null,console.log("停止自动刷新定时器"))},Y=()=>{if(!x.value){m.value=null;return}try{let t=x.value.toLowerCase().trim();!t.startsWith("http://")&&!t.startsWith("https://")&&(t="https://"+t);try{new URL(t)}catch{console.warn("无效的URL格式:",t),m.value=null;return}t.includes("douyin.com")||t.includes("iesdouyin.com")||t.includes("snssdk.com")||t.includes("toutiao.com")?m.value="douyin":t.includes("xiaohongshu.com")||t.includes("xhscdn.com")||t.includes("xhs.")?m.value="xiaohongshu":m.value=null}catch(t){console.error("检测平台类型出错:",t),m.value=null}};ae(x,()=>{Y()});const K=async()=>{if(!x.value){r.error("请输入账号链接");return}Y();try{let t=x.value;!t.startsWith("http://")&&!t.startsWith("https://")&&(t="https://"+t),new URL(t)}catch{r.error("请输入有效的账号链接");return}if(!x.value.toLowerCase().includes("user")){r.warning("请使用用户主页链接");return}m.value||r.warning("无法识别链接平台类型，请确保输入抖音或小红书的账号链接");try{C.value=!0;const t={link:x.value,mode:I.value};m.value&&(t.platform=m.value,t.type_name=m.value==="douyin"?"抖音":"小红书");const a=await A.post("account-analysis/create-task",t).catch(e=>{var o;if(console.error("API请求失败:",e),e.response){const u=e.response.status,l=((o=e.response.data)==null?void 0:o.message)||"未知错误";u===401?r.error("请先登录后再使用此功能"):u===403?r.error("您没有权限执行此操作"):u===429?r.error("请求过于频繁，请稍后再试"):r.error(`请求失败: ${l}`)}else e.request?r.error("服务器无响应，请检查网络连接"):r.error(`请求错误: ${e.message}`);throw e});if(a.data.success){const e=a.data.data;console.log("创建分析任务成功，返回数据:",e),r.success("创建账号分析任务成功"),x.value="",$()}else r.error(a.data.message||"创建账号分析任务失败")}catch(t){console.error("分析账号出错:",t)}finally{C.value=!1}},$=async()=>{var t;try{G.value=!0,y.value=[];const a=await A.get("account-analysis/tasks").catch(e=>{var o;throw console.error("获取任务列表API请求失败:",e),e.response?e.response.status===401?r.error("请先登录后再使用此功能"):r.error(`获取任务列表失败: ${((o=e.response.data)==null?void 0:o.message)||"未知错误"}`):e.request?r.error("服务器无响应，请检查网络连接"):r.error(`请求错误: ${e.message}`),e});if(console.log("获取任务列表响应:",a),a.data&&a.data.success){let e;a.data.data&&typeof a.data.data=="object"?a.data.data.data&&Array.isArray(a.data.data.data)?e=a.data.data.data:Array.isArray(a.data.data)?e=a.data.data:e=[]:e=[],y.value=Array.isArray(e)?e:[],console.log("处理后的分析任务列表:",{taskDataType:typeof e,isArray:Array.isArray(e),tasksLength:y.value.length,tasks:y.value}),y.value.some(u=>u.status==="进行中"||u.status==="刷新中...")?X():z()}else console.warn("获取分析任务列表失败:",a.data),r.error(((t=a.data)==null?void 0:t.message)||"获取分析任务列表失败"),y.value=[],z()}catch(a){console.error("获取分析任务列表出错:",a),y.value=[],z()}finally{G.value=!1}},R=async t=>{if(t.status!=="已完成"&&t.status!=="失败"){r.info("任务尚未完成，请稍后查看");return}try{j.value=!0,P.value=!0,T.value="正在获取分析结果...";const a=await A.get(`account-analysis/result?task_id=${t.task_id}&id=${t.id}`).catch(e=>{var o;throw console.error("获取分析结果API请求失败:",e),e.response?e.response.status===401?r.error("请先登录后再使用此功能"):r.error(`获取分析结果失败: ${((o=e.response.data)==null?void 0:o.message)||"未知错误"}`):e.request?r.error("服务器无响应，请检查网络连接"):r.error(`请求错误: ${e.message}`),e});if(a.data.success){if(t.status==="失败")f.value={status:"fail",message:t.ip_content||"分析任务执行失败，请稍后重试"};else{let e=a.data.data;if(e&&e.data&&typeof e.data=="object"&&(console.log("检测到嵌套数据结构，使用内层数据"),e=e.data),console.log("处理后的任务数据:",e),f.value={status:"success",data:e},e!=null&&e.fx_content)try{const o=JSON.parse(e.fx_content);let u='<div class="analysis-result">';if(o.user_data){const l=o.user_data,h=D(l.followers_count),g=D(l.following_count),c=D(l.likes_count),p=Z(l.profile_picture,!0);u+=`
                <div class="account-info-container bg-gray-50 dark:bg-gray-900 rounded-lg overflow-hidden shadow-md mb-3">
                  <h2 class="text-base font-bold p-2 bg-gray-100 dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700">账号基本信息</h2>
                  
                  <div class="p-3">
                    <div class="flex mb-4">
                      <div class="mr-4 flex-shrink-0">
                        <img src="${p}" alt="${l.nickname}" class="w-16 h-16 rounded-full border-2 border-gray-200 dark:border-gray-700 object-cover shadow-sm">
                      </div>
                      <div class="flex-grow flex flex-col justify-center overflow-hidden">
                        <h3 class="font-bold text-lg text-gray-900 dark:text-white truncate">${l.nickname}</h3>
                        <p class="text-sm text-gray-600 dark:text-gray-400 truncate">${l.location||"未知地区"}</p>
                      </div>
                    </div>

                    <div class="grid grid-cols-2 gap-3 mb-3">
                      <div class="border border-gray-200 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 px-3 py-2.5">
                        <span class="text-gray-600 dark:text-gray-400">抖音号: </span>
                        <span class="text-gray-900 dark:text-white font-medium">${l.douyin_account||"未知"}</span>
                      </div>
                      
                      <div class="border border-gray-200 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 px-3 py-2.5">
                        <span class="text-gray-600 dark:text-gray-400">性别: </span>
                        <span class="text-gray-900 dark:text-white font-medium">${l.age||"未知"}</span>
                      </div>
                      
                      <div class="border border-gray-200 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 px-3 py-2.5">
                        <span class="text-gray-600 dark:text-gray-400">IP属地: </span>
                        <span class="text-gray-900 dark:text-white font-medium">${l.ip_location||"未知"}</span>
                      </div>
                      
                      <div class="border border-gray-200 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 px-3 py-2.5">
                        <span class="text-gray-600 dark:text-gray-400">作品数: </span>
                        <span class="text-gray-900 dark:text-white font-medium">${l.works_count||"0"}</span>
                      </div>
                    </div>
                    
                    <div class="mb-3">
                      <div class="border border-gray-200 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 p-2.5">
                        <span class="text-gray-600 dark:text-gray-400">简介: </span>
                        <span class="text-gray-900 dark:text-white break-words">${l.signature||"无数据"}</span>
                      </div>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-3">
                      <div class="p-3 bg-gradient-to-br from-blue-500 to-blue-700 rounded-lg shadow-md hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1">
                        <div class="text-center">
                          <div class="text-base md:text-lg font-bold text-white text-shadow break-words leading-tight px-1">${h}</div>
                          <div class="text-xs md:text-sm font-medium text-white opacity-90 mt-1">粉丝</div>
                        </div>
                      </div>
                      <div class="p-3 bg-gradient-to-br from-purple-500 to-purple-700 rounded-lg shadow-md hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1">
                        <div class="text-center">
                          <div class="text-base md:text-lg font-bold text-white text-shadow break-words leading-tight px-1">${g}</div>
                          <div class="text-xs md:text-sm font-medium text-white opacity-90 mt-1">关注</div>
                        </div>
                      </div>
                      <div class="p-3 bg-gradient-to-br from-red-500 to-red-700 rounded-lg shadow-md hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1">
                        <div class="text-center">
                          <div class="text-base md:text-lg font-bold text-white text-shadow break-words leading-tight px-1">${c}</div>
                          <div class="text-xs md:text-sm font-medium text-white opacity-90 mt-1">获赞</div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              `}if(o.videos&&o.videos.length>0){u+=`
                <div class="videos-container bg-gray-50 dark:bg-gray-900 rounded-lg overflow-hidden shadow-md mb-3">
                  <h2 class="text-base font-bold p-2 bg-gray-100 dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700">热门视频</h2>
                  <div class="video-grid grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 p-3">
              `;const l=Math.min(o.videos.length,12);for(let h=0;h<l;h++){const g=o.videos[h],c=D(g.likes_count),p=Z(g.cover_image,!1);u+=`
                  <div class="video-card bg-white dark:bg-gray-800 rounded-lg overflow-hidden shadow-sm border border-gray-200 dark:border-gray-700 hover:shadow-md transition-all duration-300">
                    <div class="relative">
                      <img src="${p}" alt="${g.video_title}" class="w-full h-28 object-cover">
                      <div class="absolute bottom-2 right-2 bg-black bg-opacity-70 text-white text-xs px-2 py-1 rounded-full">
                        ${c} 赞
                      </div>
                    </div>
                    <div class="p-2">
                      <div class="text-sm font-medium text-gray-900 dark:text-gray-100 overflow-hidden line-clamp-2 h-10" title="${g.video_title}">${g.video_title}</div>
                      <a href="${g.original_link}" target="_blank" class="text-xs text-primary-600 dark:text-primary-400 mt-1.5 inline-block hover:underline">查看原视频</a>
                    </div>
                  </div>
                `}u+="</div></div>"}if(e!=null&&e.ip_html_content){let l=e.ip_html_content;l=l.replace(/<img[^>]+src=["']([^"']+)["'][^>]*>/gi,(h,g)=>{if(g.includes("xhscdn.com")){const c=Z(g,!1);return h.replace(g,c)}return h}),u+=`
                <div class="analysis-container bg-gray-50 dark:bg-gray-900 rounded-lg overflow-hidden shadow-md mt-4">
                  <h2 class="text-base font-bold p-2 bg-gray-100 dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700">详细分析报告</h2>
                  <div class="p-0">
                    <iframe 
                      id="analysis-frame" 
                      style="width:100%; height:800px; border:none; border-radius:0 0 8px 8px; overflow:auto;" 
                      srcdoc="${l.replace(/"/g,"&quot;")}"
                      onload="this.style.height = Math.max(600, this.contentWindow.document.body.scrollHeight + 50) + 'px';"
                    ></iframe>
                  </div>
                </div>
              `}u+="</div>",b.value=u}catch(o){console.error("解析fx_content失败:",o),e!=null&&e.ip_html_content?b.value=`
                <div class="analysis-result">
                  <iframe 
                    id="analysis-frame" 
                    style="width:100%; height:800px; border:none; border-radius:8px; overflow:auto;" 
                    srcdoc="${e.ip_html_content.replace(/"/g,"&quot;")}"
                    onload="this.style.height = Math.max(600, this.contentWindow.document.body.scrollHeight + 50) + 'px';"
                  ></iframe>
                </div>
              `:b.value='<pre class="whitespace-pre-wrap text-sm bg-gray-50 dark:bg-gray-800 p-4 rounded text-gray-900 dark:text-white">'+e.fx_content+"</pre>"}else if(e!=null&&e.ip_html_content)try{let o=e.ip_html_content;o=o.replace(/<img[^>]+src=["']([^"']+)["'][^>]*>/gi,(u,l)=>{if(l.includes("xhscdn.com")){const h=Z(l,!1);return u.replace(l,h)}return u}),b.value=`
              <div class="analysis-result">
                <iframe 
                  id="analysis-frame" 
                  style="width:100%; height:800px; border:none; border-radius:8px; overflow:auto;" 
                  srcdoc="${o.replace(/"/g,"&quot;")}"
                  onload="this.style.height = Math.max(600, this.contentWindow.document.body.scrollHeight + 50) + 'px';"
                ></iframe>
              </div>
            `}catch(o){console.error("处理HTML内容失败:",o),b.value=`<div class="analysis-result p-4 bg-white dark:bg-gray-800 rounded-lg shadow">${e.ip_html_content}</div>`}else b.value='<div class="p-4 text-center text-gray-500">暂无分析数据</div>'}B.value=!0}else f.value={status:"fail",message:a.data.message||"获取分析结果失败"}}catch(a){console.error("获取分析结果出错:",a),f.value={status:"fail",message:"获取分析结果出错，请稍后再试"}}finally{P.value=!1}},ee=async()=>{var t,a;if(!(!B.value||!((a=(t=f.value)==null?void 0:t.data)!=null&&a.id)))try{W.value=!0;const e=f.value.data,o=await A.get(`account-analysis/result?task_id=${e.task_id}&id=${e.id}`);o.data.success?R({id:e.id,task_id:e.task_id,status:"已完成"}):r.error(o.data.message||"刷新分析结果失败")}catch(e){console.error("刷新分析结果出错:",e),r.error("刷新分析结果出错，请稍后再试")}finally{W.value=!1}},te=async t=>{var a,e,o,u,l,h;if(t.status!=="进行中"){r.info("任务状态不是进行中，无法刷新");return}try{const g=y.value.findIndex(c=>c.id===t.id);if(g!==-1){const c=y.value[g].status;y.value[g].status="刷新中...";try{const p=await A.post("account-analysis/refresh-task",{task_id:t.task_id,id:t.id});(a=p==null?void 0:p.data)!=null&&a.success?(r.success("任务刷新请求已发送"),setTimeout(()=>{$()},3e3)):(y.value[g].status=c,r.error(((e=p==null?void 0:p.data)==null?void 0:e.message)||"刷新任务失败"))}catch(p){y.value[g].status=c,p.response?p.response.status===401?r.error("请先登录后再使用此功能"):r.error(`刷新失败: ${((o=p.response.data)==null?void 0:o.message)||"未知错误"}`):p.request?r.error("服务器无响应，请检查网络连接"):r.error(`请求错误: ${p.message}`)}}else try{const c=await A.post("account-analysis/refresh-task",{task_id:t.task_id,id:t.id});(u=c==null?void 0:c.data)!=null&&u.success?(r.success("任务刷新请求已发送"),setTimeout(()=>{$()},3e3)):r.error(((l=c==null?void 0:c.data)==null?void 0:l.message)||"刷新任务失败")}catch(c){c.response?c.response.status===401?r.error("请先登录后再使用此功能"):r.error(`刷新失败: ${((h=c.response.data)==null?void 0:h.message)||"未知错误"}`):c.request?r.error("服务器无响应，请检查网络连接"):r.error(`请求错误: ${c.message}`)}}catch(g){console.error("刷新任务出错:",g),r.error("刷新任务出错，请稍后再试");const c=y.value.findIndex(p=>p.id===t.id);c!==-1&&y.value[c].status==="刷新中..."&&(y.value[c].status="进行中")}},D=t=>{if(!t)return"0";if(typeof t=="string"&&(t.includes("万")||t.includes("亿")))return t;try{let a;if(typeof t=="string"){const e=t.replace(/[^\d.]/g,"");a=parseFloat(e)}else a=t;if(isNaN(a)||a===0)return"0";if(a>=1e8){const e=a/1e8;return e%1===0?e.toString()+"亿":e.toFixed(1).replace(/\.0$/,"")+"亿"}else if(a>=1e4){const e=a/1e4;return e%1===0?e.toString()+"万":e.toFixed(1).replace(/\.0$/,"")+"万"}else return a.toString()}catch(a){return console.error("格式化数字出错:",a,t),typeof t=="string"?t:"0"}},Z=(t,a=!1)=>{if(!t)return a?"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiB2aWV3Qm94PSIwIDAgMTAwIDEwMCI+PHJlY3Qgd2lkdGg9IjEwMCIgaGVpZ2h0PSIxMDAiIGZpbGw9IiNmMWYxZjEiLz48Y2lyY2xlIGN4PSI1MCIgY3k9IjM1IiByPSIyMCIgZmlsbD0iI2NjYyIvPjxwYXRoIGQ9Ik0yNSw4MCBDMjUsNjAgNzUsNjAgNzUsODAiIGZpbGw9IiNjY2MiLz48L3N2Zz4=":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMjAiIGhlaWdodD0iMTgwIiB2aWV3Qm94PSIwIDAgMzIwIDE4MCI+PHJlY3Qgd2lkdGg9IjMyMCIgaGVpZ2h0PSIxODAiIGZpbGw9IiNmMWYxZjEiLz48Y2lyY2xlIGN4PSIxNjAiIGN5PSI5MCIgcj0iMzAiIGZpbGw9IiNjY2MiLz48cGF0aCBkPSJNMTQ1LDkwIEwxODAsMTEwIEwxNDUsMTMwIFoiIGZpbGw9IiNhYWEiLz48L3N2Zz4=";if(t.includes("xhscdn.com"))try{return`https://images.weserv.nl/?url=${encodeURIComponent(t)}&default=${encodeURIComponent(a?"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiB2aWV3Qm94PSIwIDAgMTAwIDEwMCI+PHJlY3Qgd2lkdGg9IjEwMCIgaGVpZ2h0PSIxMDAiIGZpbGw9IiNmMWYxZjEiLz48Y2lyY2xlIGN4PSI1MCIgY3k9IjM1IiByPSIyMCIgZmlsbD0iI2NjYyIvPjxwYXRoIGQ9Ik0yNSw4MCBDMjUsNjAgNzUsNjAgNzUsODAiIGZpbGw9IiNjY2MiLz48L3N2Zz4=":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMjAiIGhlaWdodD0iMTgwIiB2aWV3Qm94PSIwIDAgMzIwIDE4MCI+PHJlY3Qgd2lkdGg9IjMyMCIgaGVpZ2h0PSIxODAiIGZpbGw9IiNmMWYxZjEiLz48Y2lyY2xlIGN4PSIxNjAiIGN5PSI5MCIgcj0iMzAiIGZpbGw9IiNjY2MiLz48cGF0aCBkPSJNMTQ1LDkwIEwxODAsMTEwIEwxNDUsMTMwIFoiIGZpbGw9IiNhYWEiLz48L3N2Zz4=")}`}catch(e){console.error("处理图片URL失败:",e)}return t};return re(()=>{console.log("账号分析组件已挂载，开始获取任务列表"),y.value=[],$()}),oe(()=>{z(),console.log("账号分析组件已卸载，清理资源")}),(t,a)=>(i(),d("div",Ue,[s("div",Ee,[Ve,s("div",Qe,[s("div",Fe,[s("div",qe,[s("div",Je,[Oe,U(s("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>x.value=e),type:"text",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:border-primary-500 focus:ring focus:ring-primary-500 focus:ring-opacity-50 dark:bg-gray-700 dark:text-white",placeholder:"请输入抖音或小红书账号链接，系统会自动识别平台"},null,512),[[ie,x.value]]),m.value?(i(),d("p",{key:0,class:L(["text-sm mt-1",m.value==="douyin"?"text-blue-500":"text-pink-500"])}," 已检测到"+_(m.value==="douyin"?"抖音":"小红书")+"链接 ",3)):(i(),d("p",Xe,"支持抖音或小红书账号链接"))]),s("div",Ke,[et,U(s("select",{"onUpdate:modelValue":a[1]||(a[1]=e=>I.value=e),class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:border-primary-500 focus:ring focus:ring-primary-500 focus:ring-opacity-50 dark:bg-gray-700 dark:text-white"},at,512),[[de,I.value]])])]),s("button",{onClick:K,class:"w-full py-2 px-4 bg-primary-600 hover:bg-primary-700 text-white font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors",disabled:!x.value||C.value},[C.value?(i(),d("span",ot,"分析中...")):(i(),d("span",it,"开始分析"))],8,rt)])]),s("div",dt,[s("div",lt,[nt,s("button",{onClick:$,class:"flex items-center text-sm text-primary-600 hover:text-primary-700",disabled:G.value},[ut,E(" 刷新 ")],8,ct)]),G.value?(i(),d("div",gt,yt)):!y.value||y.value.length===0?(i(),d("div",pt," 暂无分析记录 ")):(i(),d("div",ht,[s("table",mt,[vt,s("tbody",ft,[(i(!0),d(le,null,ne(y.value,e=>(i(),d("tr",{key:e.id,class:"hover:bg-gray-50 dark:hover:bg-gray-700"},[s("td",_t,[s("span",{class:L(["px-2 py-1 text-xs rounded-full",{"bg-blue-100 text-blue-800":e.type_name==="抖音","bg-pink-100 text-pink-800":e.type_name==="小红书","bg-green-100 text-green-800":e.status==="已完成","bg-yellow-100 text-yellow-800":e.status==="进行中","bg-red-100 text-red-800":e.status==="失败"}])},_(e.type_name),3)]),s("td",wt,[s("div",bt,_(e.fx_url),1)]),s("td",kt,[s("span",{class:L(["px-2 py-1 text-xs rounded-full",{"bg-green-100 text-green-800":e.status==="已完成","bg-yellow-100 text-yellow-800":e.status==="进行中","bg-red-100 text-red-800":e.status==="失败"}])},_(e.status),3)]),e.account_name?(i(),d("td",It,[s("div",Mt,_(e.account_name),1)])):(i(),d("td",$t,"-")),e.followers_count?(i(),d("td",At,[s("span",Nt,_(e.followers_count),1)])):(i(),d("td",Ct,"-")),e.likes_count?(i(),d("td",jt,[s("span",zt,_(e.likes_count),1)])):(i(),d("td",Lt,"-")),s("td",St,_(O(e.create_time)),1),s("td",Gt,[s("div",Pt,[e.status==="已完成"||e.status==="失败"?(i(),d("button",{key:0,onClick:o=>R(e),class:"text-primary-600 hover:text-primary-800 font-medium"}," 查看结果 ",8,Dt)):k("",!0),e.status==="进行中"||e.status==="刷新中..."?(i(),d("button",{key:1,onClick:o=>te(e),class:"text-blue-600 hover:text-blue-800 font-medium",disabled:e.status==="刷新中..."}," 刷新状态 ",8,Zt)):k("",!0)])])]))),128))])])]))])]),j.value?(i(),V(ye,{key:0,show:j.value,"onUpdate:show":a[3]||(a[3]=e=>j.value=e)},{default:Q(()=>{var e,o,u,l,h;return[s("div",Ht,[s("div",Tt,[Bt,s("div",Wt,[P.value?(i(),d("span",Yt,_(T.value),1)):k("",!0),B.value&&((e=f.value)==null?void 0:e.status)==="success"?(i(),V(we,{key:1,size:"xs",onClick:ee,loading:W.value},{default:Q(()=>[H(Pe,{class:"w-3 h-3 mr-1"}),E(" 刷新 ")]),_:1},8,["loading"])):k("",!0),H(Ie,{onClick:a[2]||(a[2]=g=>j.value=!1)})])]),s("div",Rt,[P.value?(i(),d("div",Ut,[H($e,{size:"md"}),s("div",Et,_(T.value),1)])):!((o=f.value)!=null&&o.status)||((u=f.value)==null?void 0:u.status)==="fail"?(i(),d("div",Vt,[s("div",Qt,[H(Re,{class:"w-8 h-8"})]),s("div",Ft,_(((l=f.value)==null?void 0:l.message)||"分析失败，请稍后重试"),1)])):((h=f.value)==null?void 0:h.status)==="success"?(i(),d("div",qt,[b.value?(i(),d("div",{key:0,innerHTML:b.value,class:"analysis-result"},null,8,Jt)):(i(),d("div",Ot,"暂无分析结果，请稍后重试"))])):k("",!0)])])]}),_:1},8,["show"])):k("",!0)]))}});const os=N(Xt,[["__scopeId","data-v-5ed523de"]]);export{os as default};
