
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.github.io
 */

import{d as X,r as m,m as _,a as G,g as M,c as C,b as l,w as i,e as h,i as r,R as v,h as U,A as H,S as J,T as Q,U as p,V as x,W as Y,X as Z,l as ee}from"./index-CnisIzlN.js";import{u as te,N as ae,a as A,b as S,c as z,d as I}from"./use-message-DYMqPvJU.js";import{N as K}from"./Spin-Dl1eRu5a.js";import{N as se}from"./DataTable-0DEKN-Ju.js";import{N as le,a as c}from"./FormItem-DswOIw46.js";import{N as re}from"./InputNumber-nCSOSPO9.js";import{N as oe}from"./Popconfirm-DZJlR63j.js";import"./Icon-BI3nzoj7.js";const k=w=>(Y("data-v-28325938"),w=w(),Z(),w),ne={class:"backup-models-container"},ie={class:"header-actions"},ue=k(()=>h("div",{class:"priority-note"},"* 优先级：数字越小优先级越高，系统会优先调用优先级更高的模型",-1)),de={key:0,class:"pagination-container"},pe=k(()=>h("span",{class:"form-tip"},"默认选择图文模型",-1)),ce=k(()=>h("span",{class:"priority-tip"},"数字越小优先级越高，系统会优先调用优先级更高的模型",-1)),me=k(()=>h("span",{class:"form-tip"},"默认选择同步响应，推荐用于图像生成",-1)),ye=k(()=>h("span",{class:"form-tip"},"默认选择聊天模式",-1)),fe=X({__name:"backupModels",setup(w){const N=m([]),T=m(!1),d=_({page:1,pageSize:10,itemCount:0,showSizePicker:!0,pageSizes:[10,20,30,40]}),P=[{title:"ID",key:"id",width:60},{title:"模型名称",key:"name",width:150},{title:"请求地址",key:"baseUrl",width:200},{title:"API Key",key:"apiKey",width:150,render(t,a){const e=t.apiKey||"";return e.length>8?`${e.substring(0,4)}****${e.substring(e.length-4)}`:e}},{title:"模型类型",key:"modelType",width:80,render(t,a){const e={text:{type:"info",text:"文字"},image:{type:"success",text:"图文"},video:{type:"warning",text:"视频"}},s=t.modelType||"text",n=e[s]||{type:"default",text:"未知"};return p(I,{type:n.type},{default:()=>n.text})}},{title:"使用的模型",key:"model",width:120},{title:"优先级 *",key:"priority",width:60,titleAlign:"center",align:"center",render(t){return p("span",{class:t.priority<=5?"high-priority":""},t.priority)}},{title:"请求方式",key:"requestMethod",width:80,render(t,a){const e={stream:{type:"info",text:"流式"},sync:{type:"success",text:"同步"}},s=t.requestMethod||"stream",n=e[s]||{type:"default",text:"未知"};return p(I,{type:n.type},{default:()=>n.text})}},{title:"请求类型",key:"requestType",width:80,render(t,a){const e={chat:{type:"default",text:"聊天"},edit:{type:"info",text:"编辑"},image:{type:"success",text:"图像"}},s=t.requestType||"chat",n=e[s]||{type:"default",text:"未知"};return p(I,{type:n.type},{default:()=>n.text})}},{title:"状态",key:"status",width:60,render(t,a){return p(I,{type:t.status===1?"success":"error"},{default:()=>t.status===1?"启用":"禁用"})}},{title:"创建时间",key:"createdAt",width:160},{title:"操作",key:"actions",render(t,a){return p(A,{justify:"center"},{default:()=>[p(v,{type:"primary",size:"small",onClick:()=>V(t)},{default:()=>"编辑"}),p(oe,{onPositiveClick:()=>E(t)},{default:()=>"确定删除吗？",trigger:()=>p(v,{type:"error",size:"small"},{default:()=>"删除"})}),p(v,{type:t.status===1?"warning":"success",size:"small",onClick:()=>R(t)},{default:()=>t.status===1?"禁用":"启用"})]})}}],y=m(!1),B=m(null),q=m("添加备用模型"),f=m(!1),b=m(!1),o=_({name:"",baseUrl:"",apiKey:"",modelType:"image",model:"gpt-4o-image",status:1,priority:10,requestMethod:"sync",requestType:"chat"}),$=[{label:"文字模型",value:"text"},{label:"图文模型",value:"image"},{label:"视频模型",value:"video"}],D=[{label:"流式响应",value:"stream"},{label:"同步响应",value:"sync"}],O=[{label:"聊天模式",value:"chat"},{label:"编辑模式",value:"edit"},{label:"图像模式",value:"image"}],u=te(),g=async()=>{var a;const t=localStorage.getItem("token");if(!t){u.error("请先登录");return}T.value=!0;try{const{page:e,pageSize:s}=d,n=await x.get("/backup/models",{params:{page:e,pageSize:s},headers:{Authorization:`Bearer ${t}`}});n.data&&n.data.success?(N.value=n.data.data.items||[],d.itemCount=n.data.data.total||0):u.error(((a=n.data)==null?void 0:a.message)||"加载数据失败")}catch(e){console.error("加载备用模型列表失败:",e);const s=e;s.response&&s.response.status===401?u.error("登录已过期，请重新登录"):u.error("加载备用模型列表失败")}finally{T.value=!1}},V=t=>{f.value=!0,q.value="编辑备用模型",Object.assign(o,{id:t.id,name:t.name,baseUrl:t.baseUrl,apiKey:t.apiKey,modelType:t.modelType,model:t.model||"gpt-4o-image",status:t.status,priority:t.priority||10,requestMethod:t.requestMethod||"stream",requestType:t.requestType||"chat"}),y.value=!0},j=()=>{f.value=!1,q.value="添加备用模型",Object.assign(o,{id:void 0,name:"",baseUrl:"",apiKey:"",modelType:"image",model:"gpt-4o-image",status:1,priority:10,requestMethod:"sync",requestType:"chat"}),y.value=!0},E=async t=>{var e;const a=localStorage.getItem("token");if(!a){u.error("请先登录");return}try{const s=await x.post("/backup/models/delete",{id:t.id},{headers:{Authorization:`Bearer ${a}`}});s.data&&s.data.success?(u.success("删除成功"),g()):u.error(((e=s.data)==null?void 0:e.message)||"删除失败")}catch(s){console.error("删除备用模型失败:",s);const n=s;n.response&&n.response.status===401?u.error("登录已过期，请重新登录"):u.error("删除备用模型失败")}},R=async t=>{var e;const a=localStorage.getItem("token");if(!a){u.error("请先登录");return}try{const s=t.status===1?0:1,n=await x.post("/backup/models/update-status",{id:t.id,status:s},{headers:{Authorization:`Bearer ${a}`}});n.data&&n.data.success?(u.success(`${s===1?"启用":"禁用"}成功`),g()):u.error(((e=n.data)==null?void 0:e.message)||"操作失败")}catch(s){console.error("切换备用模型状态失败:",s);const n=s;n.response&&n.response.status===401?u.error("登录已过期，请重新登录"):u.error("操作失败")}},F=async()=>{var a;if(!o.name){u.error("请输入模型名称");return}if(!o.baseUrl){u.error("请输入请求地址");return}if(!o.apiKey){u.error("请输入API Key");return}const t=localStorage.getItem("token");if(!t){u.error("请先登录");return}b.value=!0;try{const e=f.value?"/backup/models/update":"/backup/models/create",s=await x.post(e,o,{headers:{Authorization:`Bearer ${t}`}});s.data&&s.data.success?(u.success(f.value?"更新成功":"添加成功"),y.value=!1,g()):u.error(((a=s.data)==null?void 0:a.message)||(f.value?"更新失败":"添加失败"))}catch(e){console.error("保存备用模型失败:",e);const s=e;s.response&&s.response.status===401?u.error("登录已过期，请重新登录"):u.error(f.value?"更新失败":"添加失败")}finally{b.value=!1}},L=t=>{d.page=t,g()},W=t=>{d.pageSize=t,d.page=1,g()};return G(()=>{if(!localStorage.getItem("token")){u.warning("请先登录后再访问此页面");return}g()}),(t,a)=>(M(),C("div",ne,[l(r(J),{title:"备用模型管理",class:"mb-4"},{"header-extra":i(()=>[h("div",ie,[l(r(v),{type:"primary",onClick:j},{default:i(()=>[U(" 添加备用模型 ")]),_:1})])]),default:i(()=>[l(r(K),{show:T.value},{default:i(()=>[l(r(se),{columns:P,data:N.value,bordered:!1,striped:"",pagination:!1,"row-key":e=>e.id},null,8,["data","row-key"]),ue,N.value.length>0?(M(),C("div",de,[l(r(ae),{page:d.page,"onUpdate:page":[a[0]||(a[0]=e=>d.page=e),L],"page-size":d.pageSize,"onUpdate:pageSize":[a[1]||(a[1]=e=>d.pageSize=e),W],"item-count":d.itemCount,"page-sizes":d.pageSizes,"show-size-picker":d.showSizePicker},null,8,["page","page-size","item-count","page-sizes","show-size-picker"])])):H("",!0)]),_:1},8,["show"])]),_:1}),l(r(Q),{show:y.value,"onUpdate:show":a[12]||(a[12]=e=>y.value=e),title:q.value,preset:"card",style:{width:"600px"}},{footer:i(()=>[l(r(A),{justify:"end"},{default:i(()=>[l(r(v),{onClick:a[11]||(a[11]=e=>y.value=!1),disabled:b.value},{default:i(()=>[U("取消")]),_:1},8,["disabled"]),l(r(v),{type:"primary",onClick:F,loading:b.value},{default:i(()=>[U("保存")]),_:1},8,["loading"])]),_:1})]),default:i(()=>[l(r(K),{show:b.value},{default:i(()=>[l(r(le),{ref_key:"formRef",ref:B,model:o,"label-placement":"left","label-width":"100"},{default:i(()=>[l(r(c),{label:"模型名称",required:""},{default:i(()=>[l(r(S),{value:o.name,"onUpdate:value":a[2]||(a[2]=e=>o.name=e),placeholder:""},null,8,["value"])]),_:1}),l(r(c),{label:"请求地址",required:""},{default:i(()=>[l(r(S),{value:o.baseUrl,"onUpdate:value":a[3]||(a[3]=e=>o.baseUrl=e),placeholder:"请输入API请求地址，如：https://api.openai.com"},null,8,["value"])]),_:1}),l(r(c),{label:"API Key",required:""},{default:i(()=>[l(r(S),{value:o.apiKey,"onUpdate:value":a[4]||(a[4]=e=>o.apiKey=e),type:"password",placeholder:"请输入API Key","show-password-on":"click"},null,8,["value"])]),_:1}),l(r(c),{label:"模型类型",required:""},{help:i(()=>[pe]),default:i(()=>[l(r(z),{value:o.modelType,"onUpdate:value":a[5]||(a[5]=e=>o.modelType=e),options:$,"default-value":"image"},null,8,["value"])]),_:1}),l(r(c),{label:"使用的模型",required:""},{default:i(()=>[l(r(S),{value:o.model,"onUpdate:value":a[6]||(a[6]=e=>o.model=e),placeholder:"请输入使用的模型，如：gpt-4o-image"},null,8,["value"])]),_:1}),l(r(c),{label:"优先级"},{help:i(()=>[ce]),default:i(()=>[l(r(re),{value:o.priority,"onUpdate:value":a[7]||(a[7]=e=>o.priority=e),min:1,max:100},null,8,["value"])]),_:1}),l(r(c),{label:"请求方式"},{help:i(()=>[me]),default:i(()=>[l(r(z),{value:o.requestMethod,"onUpdate:value":a[8]||(a[8]=e=>o.requestMethod=e),options:D,"default-value":"sync"},null,8,["value"])]),_:1}),l(r(c),{label:"请求类型"},{help:i(()=>[ye]),default:i(()=>[l(r(z),{value:o.requestType,"onUpdate:value":a[9]||(a[9]=e=>o.requestType=e),options:O,"default-value":"chat"},null,8,["value"])]),_:1}),l(r(c),{label:"状态"},{default:i(()=>[l(r(z),{value:o.status,"onUpdate:value":a[10]||(a[10]=e=>o.status=e),options:[{label:"启用",value:1},{label:"禁用",value:0}]},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])]),_:1},8,["show","title"])]))}}),ze=ee(fe,[["__scopeId","data-v-28325938"]]);export{ze as default};
