
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.github.io
 */

import{_ as R}from"./index.vue_vue_type_script_setup_true_lang-BkBSJsBX.js";import{d as G,r as v,m as K,M as J,a as Q,p as r,g as k,c as W,b as e,w as a,h as f,t as X,e as y,v as Y,A as Z,G as d,N as ee,j as te,_ as le,k as x}from"./index-CnisIzlN.js";import{a as g}from"./coze-Br_YcUzB.js";const oe=y("div",{class:"flex items-center gap-4"},"Coze 工作流管理",-1),ae=y("div",{class:"text-sm/6"},[y("div",null," 管理 Coze Bot 的密钥和配置。您可以添加多个 Coze Bot，方便在不同场景下使用。 ")],-1),se={class:"flex justify-end mt-5"},ne={class:"dialog-footer"},re=G({__name:"list",setup(de){const V=v([]),h=v(0),B={botId:[{required:!0,message:"请输入Bot ID",trigger:"blur"}],name:[{required:!0,message:"请输入名称",trigger:"blur"}],publicKey:[{required:!0,message:"请输入公钥",trigger:"blur"}],secretKey:[{required:!0,message:"请输入私钥",trigger:"blur"}],clientId:[{required:!0,message:"请输入客户端ID",trigger:"blur"}],spaceId:[{required:!0,message:"请输入空间ID",trigger:"blur"}]},i=K({page:1,size:990}),u=v(!1),I=v("添加Coze配置");J(u,s=>{s||b()});const o=K({id:void 0,botId:"",name:"",publicKey:"",secretKey:"",clientId:"",spaceId:"",status:1}),_=v(),m=async()=>{try{const s=await g.getCozeList(i);s&&s.data&&(V.value=s.data.items||[],h.value=s.data.total||0)}catch(s){console.error("获取Coze列表失败",s),d.error("获取Coze列表失败")}},U=()=>{I.value="添加Coze配置",b(),u.value=!0},S=async s=>{I.value="编辑Coze配置",b();try{const t=await g.getCozeDetail(s.id);t&&t.data&&Object.assign(o,t.data),u.value=!0}catch(t){console.error("获取Coze详情失败",t),d.error("获取Coze详情失败")}},q=s=>{ee.confirm("确定要删除该Coze配置吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await g.deleteCoze(s.id),d.success("删除成功"),m()}catch(t){console.error("删除Coze配置失败",t),d.error("删除Coze配置失败")}}).catch(()=>{})},$=async s=>{try{await g.updateCoze(s.id,{status:s.status===1?0:1}),d.success("状态更新成功"),m()}catch(t){console.error("更新状态失败",t),d.error("更新状态失败")}},b=()=>{Object.assign(o,{id:void 0,botId:"",name:"",publicKey:"",secretKey:"",clientId:"",spaceId:"",status:1}),_.value&&_.value.resetFields()},j=()=>{b()},N=async()=>{_.value&&_.value.validate(async s=>{if(s)try{const t={botId:o.botId,name:o.name,publicKey:o.publicKey,secretKey:o.secretKey,clientId:o.clientId,spaceId:o.spaceId,status:o.status};o.id?(await g.updateCoze(o.id,t),d.success("更新成功")):(await g.addCoze(t),d.success("添加成功")),u.value=!1,b(),m()}catch(t){console.error("保存Coze配置失败",t),d.error("保存Coze配置失败")}})},A=s=>{i.size=s,m()},E=s=>{i.page=s,m()};return Q(()=>{m()}),(s,t)=>{const z=te,M=le,T=R,n=r("el-table-column"),c=r("el-input"),D=r("el-switch"),w=r("el-button"),F=r("el-table"),L=r("el-pagination"),H=r("el-card"),p=r("el-form-item"),O=r("el-form"),P=r("el-dialog");return k(),W("div",null,[e(T,null,{title:a(()=>[oe]),content:a(()=>[ae]),default:a(()=>[e(M,{onClick:U},{default:a(()=>[e(z,{name:"mdi:plus-circle-outline"}),f(" 添加配置 ")]),_:1})]),_:1}),e(H,{style:{margin:"20px"}},{default:a(()=>[e(F,{data:V.value,border:"",style:{width:"100%"}},{default:a(()=>[e(n,{prop:"id",label:"ID",width:"80"}),e(n,{prop:"name",label:"名称",width:"180"}),e(n,{prop:"botId",label:"Bot ID"}),e(n,{prop:"clientId",label:"客户端ID","show-overflow-tooltip":""}),e(n,{prop:"spaceId",label:"空间ID","show-overflow-tooltip":""}),e(n,{prop:"publicKey",label:"公钥","show-overflow-tooltip":""}),e(n,{prop:"secretKey",label:"私钥","show-overflow-tooltip":""},{default:a(l=>[e(c,{modelValue:l.row.secretKey,"onUpdate:modelValue":C=>l.row.secretKey=C,disabled:"",type:"password","show-password":""},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(n,{prop:"status",label:"状态",width:"120"},{default:a(l=>[e(D,{modelValue:l.row.status,"onUpdate:modelValue":C=>l.row.status=C,"active-value":1,"inactive-value":0,onChange:()=>$(l.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(n,{prop:"createdAt",label:"创建时间",width:"180"},{default:a(l=>[f(X(new Date(l.row.createdAt).toLocaleString()),1)]),_:1}),e(n,{label:"操作",width:"180"},{default:a(l=>[e(w,{size:"small",onClick:C=>S(l.row)},{default:a(()=>[e(z,{name:"mdi:pencil",class:"mr-1"}),f(" 编辑 ")]),_:2},1032,["onClick"]),e(w,{size:"small",type:"danger",onClick:C=>q(l.row)},{default:a(()=>[e(z,{name:"mdi:delete",class:"mr-1"}),f(" 删除 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),y("div",se,[e(L,{"current-page":i.page,"onUpdate:currentPage":t[0]||(t[0]=l=>i.page=l),"page-size":i.size,"onUpdate:pageSize":t[1]||(t[1]=l=>i.size=l),total:h.value,"page-sizes":[10,20,30,50,100,990],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:A,onCurrentChange:E},null,8,["current-page","page-size","total"])])]),_:1}),e(P,{modelValue:u.value,"onUpdate:modelValue":t[10]||(t[10]=l=>u.value=l),title:I.value,width:"500px",onClose:j},{footer:a(()=>[y("span",ne,[e(w,{onClick:t[9]||(t[9]=l=>u.value=!1)},{default:a(()=>[f("取 消")]),_:1}),e(w,{type:"primary",onClick:N},{default:a(()=>[f("确 定")]),_:1})])]),default:a(()=>[e(O,{ref_key:"formRef",ref:_,model:o,rules:B,"label-width":"120px"},{default:a(()=>[e(p,{label:"Bot ID",prop:"botId"},{default:a(()=>[e(c,{modelValue:o.botId,"onUpdate:modelValue":t[2]||(t[2]=l=>o.botId=l),placeholder:"请输入Coze Bot ID"},null,8,["modelValue"])]),_:1}),e(p,{label:"名称",prop:"name"},{default:a(()=>[e(c,{modelValue:o.name,"onUpdate:modelValue":t[3]||(t[3]=l=>o.name=l),placeholder:"请输入名称，便于管理"},null,8,["modelValue"])]),_:1}),e(p,{label:"客户端ID",prop:"clientId"},{default:a(()=>[e(c,{modelValue:o.clientId,"onUpdate:modelValue":t[4]||(t[4]=l=>o.clientId=l),placeholder:"请输入客户端ID"},null,8,["modelValue"])]),_:1}),e(p,{label:"空间ID",prop:"spaceId"},{default:a(()=>[e(c,{modelValue:o.spaceId,"onUpdate:modelValue":t[5]||(t[5]=l=>o.spaceId=l),placeholder:"请输入空间ID"},null,8,["modelValue"])]),_:1}),e(p,{label:"公钥",prop:"publicKey"},{default:a(()=>[e(c,{modelValue:o.publicKey,"onUpdate:modelValue":t[6]||(t[6]=l=>o.publicKey=l),placeholder:"请输入Coze公钥"},null,8,["modelValue"])]),_:1}),e(p,{label:"私钥",prop:"secretKey"},{default:a(()=>[e(c,{modelValue:o.secretKey,"onUpdate:modelValue":t[7]||(t[7]=l=>o.secretKey=l),placeholder:"请输入Coze私钥",type:"password","show-password":""},null,8,["modelValue"])]),_:1}),o.id?(k(),Y(p,{key:0,label:"状态"},{default:a(()=>[e(D,{modelValue:o.status,"onUpdate:modelValue":t[8]||(t[8]=l=>o.status=l),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1})):Z("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});typeof x=="function"&&x(re);export{re as default};
