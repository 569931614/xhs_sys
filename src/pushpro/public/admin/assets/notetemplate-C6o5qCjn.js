
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.github.io
 */

import{d as Q,r as d,m as V,U as C,a as Y,E as v,p as i,g as Z,c as ee,b as o,w as a,_ as te,j as le,h as c,i as oe,e as s,t as ae,I as ne,bX as se,W as ie,X as ue,l as re,k as M}from"./index-CnisIzlN.js";import{_ as de}from"./index.vue_vue_type_script_setup_true_lang-BkBSJsBX.js";import{T as ce,r as U,B as me}from"./service-BAUdoYLG.js";import{u as pe}from"./use-message-DYMqPvJU.js";import"./DataTable-0DEKN-Ju.js";import"./Icon-BI3nzoj7.js";import"./composables-D2s7nT97.js";const w=y=>(ie("data-v-e5d8e7c2"),y=y(),ue(),y),fe=w(()=>s("div",{class:"flex items-center gap-4"},"笔记页面模板",-1)),_e=w(()=>s("div",{class:"text-sm/6"},[s("div",null," 管理小红书笔记页面模板，用于快速创建笔记内容。 ")],-1)),he=w(()=>s("div",{class:"mb-2 text-gray-500 text-sm"},[s("i",{class:"el-icon-info mr-1"}),c(" 模板缩略图是模板内容渲染后的结果，用于在列表中展示。 ")],-1)),be=w(()=>s("i",{class:"el-icon-plus"},null,-1)),ve={class:"dialog-footer"},ye={class:"code-preview"},ge={class:"dialog-footer"},S=Q({__name:"notetemplate",setup(y){const f=d(),m=pe(),T=d(),u=d(!1),k=d(!1),$=d(""),_=d(!1),g=d([]),h=V({name:""}),l=V({id:"",name:"",content:"",thumbnail:"",sort:0,status:!0}),q={name:{required:!0,message:"请输入模板名称",trigger:"blur"},content:{required:!0,message:"请输入模板内容",trigger:"blur"}},D=[{title:"ID",key:"id",width:80},{title:"模板名称",key:"name",width:150},{title:"缩略图",key:"thumbnail",width:120,render(e){return C("img",{src:e.thumbnail||"",style:{width:"50px",height:"50px",objectFit:"cover"}})}},{title:"排序",key:"sort",width:100},{title:"状态",key:"status",width:100,render(e){return C("span",{style:{color:e.status?"green":"red"}},e.status?"启用":"禁用")}},{title:"创建时间",key:"createTime",width:180}],L=V({width:260,title:"操作",key:"action",fixed:"right",render(e){return C(ce,{style:"button",actions:[{label:"编辑",onClick:A.bind(null,e),type:"primary"},{label:"删除",onClick:X.bind(null,e),type:"error"}]})}});Y(async()=>{});function N(e){console.log(e)}async function P(e){try{const t={...e,...h};return await U({url:"/xiaohongshu/notetemplate/list",method:"get",params:t})}catch(t){return console.error("加载数据失败:",t),{items:[],total:0}}}function E(){v(()=>{var e;(e=f.value)==null||e.reload()})}function F(){h.name="",v(()=>{var e;(e=f.value)==null||e.reload()})}function j(){u.value=!0,l.id="",l.name="",l.thumbnail="",l.content="",l.sort=0,l.status=!0,g.value=[],v(()=>{console.log("nextTick后showModal状态:",u.value)})}function A(e){u.value=!0,l.id=String(e.id),l.name=e.name,l.thumbnail=e.thumbnail,l.content=e.content,l.sort=e.sort,l.status=e.status,e.thumbnail?g.value=[{name:"缩略图",url:e.thumbnail}]:g.value=[]}function H(e){if(e.raw){const t=e.fileList;t.length>0&&t[0].url?l.thumbnail=t[0].url:l.thumbnail=""}}async function X(e){try{await U({url:`/xiaohongshu/notetemplate/delete/${e.id}`,method:"delete"}),m.success("删除成功"),v(()=>{var t;(t=f.value)==null||t.reload()})}catch{m.error("删除失败")}}function K(){u.value=!1}async function W(){try{if(_.value=!0,!l.name){m.error("请输入模板名称"),_.value=!1;return}if(!l.content){m.error("请输入模板内容"),_.value=!1;return}const e={...l,sort:Number(l.sort),status:!!l.status};e.id===""?delete e.id:e.id=Number(e.id);const t=e.id?"/xiaohongshu/notetemplate/update":"/xiaohongshu/notetemplate/create",x=await U({url:t,method:"post",data:e});m.success(e.id?"更新成功":"添加成功"),u.value=!1,v(()=>{var p;(p=f.value)==null||p.reload()})}catch(e){console.error("保存失败:",e),m.error(l.id?"更新失败":"添加失败")}finally{_.value=!1}}return(e,t)=>{const x=de,p=i("el-input"),r=i("el-form-item"),b=i("el-button"),B=i("el-form"),R=ne,z=se,G=i("el-upload"),J=i("el-input-number"),O=i("el-switch"),I=i("el-dialog");return Z(),ee("div",null,[o(x,null,{title:a(()=>[fe]),content:a(()=>[_e]),default:a(()=>[o(te,{outline:"",type:"success",onClick:j},{default:a(()=>[o(le,{name:"i-ri:file-text-line"}),c(" 新增页面模板 ")]),_:1})]),_:1}),o(R,null,{default:a(()=>[o(B,{ref_key:"formRef",ref:T,inline:!0,model:h},{default:a(()=>[o(r,{label:"模板名称"},{default:a(()=>[o(p,{modelValue:h.name,"onUpdate:modelValue":t[0]||(t[0]=n=>h.name=n),placeholder:"请输入模板名称",clearable:""},null,8,["modelValue"])]),_:1}),o(r,null,{default:a(()=>[o(b,{type:"primary",onClick:E},{default:a(()=>[c("搜索")]),_:1}),o(b,{onClick:F},{default:a(()=>[c("重置")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),o(R,{style:{width:"100%"}},{default:a(()=>[o(z,null,{default:a(()=>[o(oe(me),{columns:D,request:P,"row-key":n=>n.id,ref_key:"actionRef",ref:f,actionColumn:L,"onUpdate:checkedRowKeys":N,"scroll-x":1090},null,8,["row-key","actionColumn"])]),_:1}),o(I,{modelValue:u.value,"onUpdate:modelValue":t[5]||(t[5]=n=>u.value=n),title:"页面模板信息",width:"800px","close-on-click-modal":!1},{footer:a(()=>[s("div",ve,[o(b,{onClick:K},{default:a(()=>[c("取消")]),_:1}),o(b,{type:"primary",loading:_.value,onClick:W},{default:a(()=>[c("确定")]),_:1},8,["loading"])])]),default:a(()=>[o(B,{model:l,rules:q,ref_key:"formRef",ref:T,"label-width":"100px",class:"py-4"},{default:a(()=>[o(r,{label:"模板名称",prop:"name"},{default:a(()=>[o(p,{modelValue:l.name,"onUpdate:modelValue":t[1]||(t[1]=n=>l.name=n),placeholder:"请输入模板名称"},null,8,["modelValue"])]),_:1}),o(r,{label:"模板缩略图",prop:"thumbnail"},{default:a(()=>[he,o(G,{"list-type":"picture-card",limit:1,"file-list":g.value,onChange:H},{default:a(()=>[be]),_:1},8,["file-list"])]),_:1}),o(r,{label:"模板内容",prop:"content"},{default:a(()=>[o(p,{modelValue:l.content,"onUpdate:modelValue":t[2]||(t[2]=n=>l.content=n),type:"textarea",placeholder:"请输入HTML模板内容",rows:12},null,8,["modelValue"])]),_:1}),o(r,{label:"排序",prop:"sort"},{default:a(()=>[o(J,{modelValue:l.sort,"onUpdate:modelValue":t[3]||(t[3]=n=>l.sort=n),min:0},null,8,["modelValue"])]),_:1}),o(r,{label:"状态",prop:"status"},{default:a(()=>[o(O,{modelValue:l.status,"onUpdate:modelValue":t[4]||(t[4]=n=>l.status=n)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),o(I,{modelValue:k.value,"onUpdate:modelValue":t[7]||(t[7]=n=>k.value=n),title:"模板内容预览",width:"800px","close-on-click-modal":!1},{footer:a(()=>[s("div",ge,[o(b,{onClick:t[6]||(t[6]=n=>k.value=!1)},{default:a(()=>[c("关闭")]),_:1})])]),default:a(()=>[s("div",ye,[s("pre",null,[s("code",null,ae($.value),1)])])]),_:1},8,["modelValue"])]),_:1})])}}});typeof M=="function"&&M(S);const Be=re(S,[["__scopeId","data-v-e5d8e7c2"]]);export{Be as default};
