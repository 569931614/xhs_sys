
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.github.io
 */

import{J as N,d as j,m as z,r as b,a as E,g as _,c as w,b as i,w as r,i as o,R as A,h as f,e as d,F as L,s as J,t as c,v as W,A as X,S as G,T as H,W as K,X as O,l as Q}from"./index-CnisIzlN.js";import{N as T}from"./Spin-Dl1eRu5a.js";import{N as Y,a as Z}from"./Table-BnpzIjRn.js";import{u as ee,i as I,a as te,N as ae,b as S}from"./use-message-DYMqPvJU.js";import{N as se,a as x}from"./FormItem-DswOIw46.js";const P={queryPromptTemplates:p=>{const t={...p};return t.page&&(t.page=Number(t.page)),t.pageSize&&(t.pageSize=Number(t.pageSize)),t.status!==void 0&&(t.status=Number(t.status)),N.get("promptlib/list",{params:t})},getPromptTemplate:p=>N.get(`promptlib/${p}`),createPromptTemplate:p=>{const t={...p};return t.status!==void 0&&(t.status=Number(t.status)),N.post("promptlib/create",t)},updatePromptTemplate:p=>{const t={...p};return t.id&&(t.id=Number(t.id)),t.status!==void 0&&(t.status=Number(t.status)),N.post("promptlib/update",t)},deletePromptTemplate:p=>{const t={id:Number(p.id)};return N.post("promptlib/delete",t)}},D=p=>(K("data-v-49f1a7fc"),p=p(),O(),p),le={class:"container"},re=D(()=>d("thead",null,[d("tr",null,[d("th",{style:{width:"80px"}},"ID"),d("th",{style:{width:"150px"}},"提示词标识"),d("th",null,"提示词"),d("th",{style:{width:"150px"}},"模型名称"),d("th",{style:{width:"150px"}},"预设值"),d("th",{style:{width:"180px"}},"创建时间"),d("th",{style:{width:"150px"}},"操作")])],-1)),oe={class:"prompt-cell"},ie={class:"prompt-text"},de={class:"prompt-tooltip"},pe={class:"preset-cell"},ue={class:"prompt-text"},ne={class:"prompt-tooltip"},ce={key:1},me={key:0},fe=D(()=>d("td",{colspan:"6",class:"text-center py-4"},"暂无数据",-1)),ge=[fe],ve={class:"pagination-container"},he={class:"flex justify-end space-x-2"},ye=j({__name:"promptlib",setup(p){const t=z({page:1,pageSize:10,total:0}),V=b(!1),q=z({identifier:"",modelName:"",status:void 0}),g=b([]),n=ee(),m=b(!1),a=z({id:0,identifier:"",prompt:"",modelName:"",status:1,presetValues:""}),k=b(!1),v=b(!1),h=s=>{if(!s)return"";try{return new Date(s).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return String(s)}},y=async()=>{V.value=!0,g.value=[];try{const{page:s,pageSize:l}=t,e=await P.queryPromptTemplates({page:s,pageSize:l,...q});if(console.log("API响应数据:",e),e&&typeof e=="object")if(e.code===200&&e.data&&e.data.items){const u=e.data.items;Array.isArray(u)&&(g.value=u.map(C=>({...C,createdAt:h(C.createdAt),updatedAt:h(C.updatedAt)})),t.total=Number(e.data.total)||0)}else e.items&&Array.isArray(e.items)?(g.value=e.items.map(u=>({...u,createdAt:h(u.createdAt),updatedAt:h(u.updatedAt)})),t.total=Number(e.total)||0):Array.isArray(e)?(g.value=e.map(u=>({...u,createdAt:h(u.createdAt),updatedAt:h(u.updatedAt)})),t.total=e.length):!e.success&&e.message?n.error(e.message):console.warn("未能识别的响应数据格式:",e);else console.warn("响应数据异常:",e)}catch(s){console.error("加载提示词模板失败:",s)}finally{V.value=!1}},U=s=>{t.page=s,y()},R=s=>{t.pageSize=s,t.page=1,y()},B=s=>{k.value=!1,a.id=s.id,a.identifier=s.identifier,a.prompt=s.prompt,a.modelName=s.modelName,a.status=s.status!==void 0?Number(s.status):1,a.presetValues=s.presetValues||"",m.value=!0},F=()=>{k.value=!0,a.id=0,a.identifier="",a.prompt="",a.modelName="",a.status=1,a.presetValues="",m.value=!0},M=async s=>{try{const l=await P.deletePromptTemplate({id:s.id});l&&l.success?(n.success("删除成功"),y()):n.error(l.message||"删除失败")}catch(l){console.error("删除提示词模板失败:",l)}},$=async()=>{if(!a.identifier){n.error("请输入提示词标识");return}if(!a.prompt){n.error("请输入提示词内容");return}if(!a.modelName){n.error("请输入模型名称");return}v.value=!0;try{let s;k.value?(s=await P.createPromptTemplate({identifier:a.identifier,prompt:a.prompt,modelName:a.modelName,status:a.status,presetValues:a.presetValues}),s&&s.success?(n.success("添加成功"),m.value=!1,y()):n.error(s.message||"添加失败")):(s=await P.updatePromptTemplate({id:a.id,identifier:a.identifier,prompt:a.prompt,modelName:a.modelName,status:a.status,presetValues:a.presetValues}),s&&s.success?(n.success("编辑成功"),m.value=!1,y()):n.error(s.message||"编辑失败"))}catch(s){console.error("保存提示词模板失败:",s)}finally{v.value=!1}};return E(()=>{y()}),z({render(s){}}),(s,l)=>(_(),w("div",le,[i(o(G),{title:"提示词模板库",class:"mb-4"},{"header-extra":r(()=>[i(o(A),{type:"primary",onClick:F},{default:r(()=>[f(" 添加提示词模板 ")]),_:1})]),default:r(()=>[i(o(T),{show:V.value},{default:r(()=>[i(o(Y),{striped:""},{default:r(()=>[re,d("tbody",null,[(_(!0),w(L,null,J(g.value,e=>(_(),w("tr",{key:e.id},[d("td",null,c(e.id),1),d("td",null,c(e.identifier),1),d("td",oe,[i(o(I),{trigger:"hover",placement:"top"},{trigger:r(()=>[d("div",ie,c(e.prompt),1)]),default:r(()=>[d("div",de,c(e.prompt.substring(0,500))+c(e.prompt.length>500?"...":""),1)]),_:2},1024)]),d("td",null,c(e.modelName),1),d("td",pe,[e.presetValues?(_(),W(o(I),{key:0,trigger:"hover",placement:"top"},{trigger:r(()=>[d("div",ue,c(e.presetValues),1)]),default:r(()=>[d("div",ne,c(e.presetValues.substring(0,200))+c(e.presetValues.length>200?"...":""),1)]),_:2},1024)):(_(),w("span",ce,"-"))]),d("td",null,c(e.createdAt),1),d("td",null,[i(o(te),null,{default:r(()=>[i(o(A),{size:"small",type:"primary",onClick:u=>B(e)},{default:r(()=>[f("编辑")]),_:2},1032,["onClick"]),i(o(A),{size:"small",type:"error",onClick:u=>M(e)},{default:r(()=>[f("删除")]),_:2},1032,["onClick"])]),_:2},1024)])]))),128)),g.value.length===0?(_(),w("tr",me,ge)):X("",!0)])]),_:1}),d("div",ve,[i(o(ae),{page:t.page,"onUpdate:page":[l[0]||(l[0]=e=>t.page=e),U],"page-size":t.pageSize,"onUpdate:pageSize":[l[1]||(l[1]=e=>t.pageSize=e),R],"item-count":t.total,"page-sizes":[10,20,50,100],"show-size-picker":""},null,8,["page","page-size","item-count"])])]),_:1},8,["show"])]),_:1}),i(o(H),{show:m.value,"onUpdate:show":l[8]||(l[8]=e=>m.value=e),title:k.value?"添加提示词模板":"编辑提示词模板",preset:"card",style:{width:"800px"}},{footer:r(()=>[d("div",he,[i(o(A),{onClick:l[7]||(l[7]=e=>m.value=!1),disabled:v.value},{default:r(()=>[f("取消")]),_:1},8,["disabled"]),i(o(A),{type:"primary",onClick:$,loading:v.value,disabled:v.value},{default:r(()=>[f("保存")]),_:1},8,["loading","disabled"])])]),default:r(()=>[i(o(T),{show:v.value},{default:r(()=>[i(o(se),{"label-placement":"left","label-width":"auto","require-mark-placement":"right-hanging"},{default:r(()=>[i(o(x),{label:"提示词标识",required:""},{default:r(()=>[i(o(S),{value:a.identifier,"onUpdate:value":l[2]||(l[2]=e=>a.identifier=e),placeholder:"请输入提示词标识，如：xhs_title_gen"},null,8,["value"])]),_:1}),i(o(x),{label:"提示词内容",required:""},{default:r(()=>[i(o(S),{value:a.prompt,"onUpdate:value":l[3]||(l[3]=e=>a.prompt=e),type:"textarea",placeholder:"请输入提示词内容，可使用 {{content}} 作为占位符",autosize:{minRows:8,maxRows:16}},null,8,["value"])]),_:1}),i(o(x),{label:"使用的模型",required:""},{default:r(()=>[i(o(S),{value:a.modelName,"onUpdate:value":l[4]||(l[4]=e=>a.modelName=e),placeholder:"请输入模型名称，如：gpt-3.5-turbo, gpt-4, claude-3-opus"},null,8,["value"])]),_:1}),i(o(x),{label:"模板状态"},{default:r(()=>[i(o(Z),{value:a.status,"onUpdate:value":l[5]||(l[5]=e=>a.status=e),"checked-value":1,"unchecked-value":0},{checked:r(()=>[f("启用")]),unchecked:r(()=>[f("禁用")]),_:1},8,["value"])]),_:1}),i(o(x),{label:"API请求预设值"},{default:r(()=>[i(o(S),{value:a.presetValues,"onUpdate:value":l[6]||(l[6]=e=>a.presetValues=e),type:"textarea",placeholder:"请输入API请求预设值，如: 你是一个专业的图像生成助手",autosize:{minRows:3,maxRows:6}},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["show"])]),_:1},8,["show","title"])]))}}),xe=Q(ye,[["__scopeId","data-v-49f1a7fc"]]);export{xe as default};
